RecordAction=function(a){};String.prototype.startsWith||(String.prototype.startsWith=function(a){return!this.indexOf(a)});String.prototype.endsWith||(String.prototype.endsWith=function(a){return-1!==this.indexOf(a,this.length-a.length)});String.prototype.hashCode||(String.prototype.hashCode=function(){var a=0;if(0==this.length)return code;for(var b=0;b<this.length;b++)charac=this.charCodeAt(b),a=31*a+charac,a&=a;return a});String.prototype.trim||(String.prototype.trim=function(){});
var getUrlParameter=function(a){var b=decodeURIComponent(window.location.search.substring(1)).split("&"),c,d;for(d=0;d<b.length;d++)if(c=b[d].split("="),c[0]===a)return void 0===c[1]?!0:c[1]};function isNumber(a){return/^[+-]?[0-9]*[.]?[0-9]*([eE][+-]?[0-9]+)?$/m.test(a)}var decimaleRegexp=/^[+-]?[0-9]*[.][0-9]*([eE][+-]?[0-9]+)?$/m,bibcodeRegexp=RegExp(/^[12][089]\d{2}[A-Za-z][A-Za-z0-9&][A-Za-z0-9&.]{2}[A-Za-z0-9.][0-9.][0-9.BCRU][0-9.]{2}[A-Za-z0-9.][0-9.]{4}[A-Z:.]$/);
String.prototype.xtractFilename||(String.prototype.xtractFilename=function(){var a=this.match(RegExp(/(\w:)?([\/\\].*)*([\/\\](.*))/));return null==a?{path:"",filename:this}:{path:a[1],filename:a[a.length-1]}});
String.prototype.quotedTableName||(String.prototype.quotedTableName=function(){var a;a=this.startsWith(".")?this.substring(1):this;if(0<=a.indexOf('"'))return{qualifiedName:a,tableName:a};var b=a.split("."),c=[];if(1==b.length)c.push(a);else if(2==b.length)b[1].match(/^[0-9].*/)?c.push(a):b[0].match(/^[a-zA-Z_][a-zA-Z0-9_]*$/)?(c.push(b[0]),c.push(b[1])):c.push(a);else if(2<b.length)if(b[0].match(/^[a-zA-Z_][a-zA-Z0-9_]*$/))if(c.push(b[0]),c.push(b[1]),a=b[b.length-1],a.match(/^[a-zA-Z_][a-zA-Z0-9_]*$/)){for(var d=
2;d<b.length-1;d++)c[c.length-1]+="."+b[d];c.push(a)}else for(d=2;d<b.length;d++)c[c.length-1]+="."+b[d];else c.push(a);for(b=0;b<c.length;b++)c[b].match(/^[a-zA-Z0-9][a-zA-Z0-9_]*$/)||(c[b]='"'+c[b]+'"');return{qualifiedName:c.join("."),tableName:c[c.length-1]}});
String.prototype.getTreepath||(String.prototype.getTreepath=function(){var a={schema:"",tableorg:this.valueOf(),table:""},b=this.split(".");if(1==b.length)a.table=this.valueOf();else if(2==b.length)b[1].match(/^[0-9].*/)?a.table=this.valueOf():b[0].match(/^[a-zA-Z_][a-zA-Z0-9_]*$/)?(a.schema=b[0],a.table=b[1]):a.table=this.valueOf();else if(2<b.length)if(b[0].match(/^[a-zA-Z_][a-zA-Z0-9_]*$/))if(a.schema=b[0],a.table=b[1],b[b.length-1].match(/^[a-zA-Z_][a-zA-Z0-9_]*$/))for(var c=2;c<b.length-1;c++)a.table+=
"."+b[c];else for(c=2;c<b.length;c++)a.table+="."+b[c];else a.table=this.valueOf();return a});SkyGeometry=function(){var a=function(a){return a*Math.PI/180},b=function(a){return 180*a/Math.PI},c={};c.toRadians=a;c.toDegrees=b;c.distanceDegrees=function(c,e,f,g){c=a(c);f=a(f);e=a(e);g=a(g);return b(Math.acos(Math.sin(e)*Math.sin(g)+Math.cos(e)*Math.cos(g)*Math.cos(c-f)))};return c}();
var rootUrl="http://"+window.location.hostname+(location.port?":"+location.port:"")+window.location.pathname,zIndexModalinfo=3E3,zIndexProcessing=4E3,previewTypes="text ascii html gif png jpeg jpg pdf".split(" "),imageTypes=["gif","png","jpeg","jpg"];
Modalinfo=function(){function a(a){var b=window.location,c=document.createElement("a");c.href=a;return c.hostname==b.hostname&&c.port==b.port&&c.protocol==b.protocol}var b="#modaldiv",c=function(a){return"<p>"+a.replace(/\n/g,"<BR>")+"</p>"},d=function(a,b){b=b||"";var c="";if(Array.isArray(a)){for(var c=c+"[",e=0;e<a.length;e++)c+=d(a[e],b);c+=b+"]"}else if(null===a)c="NULL";else switch(typeof a){case "undefined":c+="UNDEFINED";break;case "object":var e=!0,f;for(f in a)c=e?c+("\n"+b):"id"!=f&&"$"!=
f?c+b:c+" ",c+="<b>"+f+"</b>: ",c+=d(a[f],b+"  "),"id"!=f&&"$"!=f&&(c+="\n"),e=!1;break;case "boolean":c+=a?"TRUE":"FALSE";break;case "number":c+=a;break;case "string":0===a.lastIndexOf("http",0)&&(a=decodeURIComponent(a));c=a.match(/\s/)?c+('"'+a+'"'):c+a;break;case "function":c+="<FUNCTION>";break;default:c+=a.replace(/</g,"&lt;").replace(/>/g,"&gt;")}return c},e=0,f=function(){e++;return"modal-"+e},g=function(a){var b=$("#"+a).parent(".ui-dialog").zIndex();0==$("#shadow").length?($("body").append('<div id="shadow" pos="'+
a+'"></div>'),$("#shadow").zIndex(b-1)):($("body").append('<div class="shadow" pos="'+a+'"></div>'),$('div[pos="'+a+'"]').zIndex(b-1))},h=function(a,b,c,d,e){void 0==d?$("body").append("<div id='"+a+"' title='"+c+"' class='custom-modal'> </div>"):$("body").append("<div id='"+a+"' title='"+c+"' class='custom-modal'>"+d+"</div>");b?$("#"+a).dialog():void 0!=e?$("#"+a).dialog({resizable:!1,minWidth:e,position:{my:"center",at:"top",of:window}}):$("#"+a).dialog({resizable:!1,width:"auto",height:"auto"})},
l=function(){var a=-1;$("div[id^='modal-']").each(function(){var b=$(this).attr("id").substring(6);b>a&&isNumber(b)&&(a=$(this).attr("id").substring(6))});return-1!=a?"modal-"+a:a=void 0},m=function(a){void 0!=a&&($('div[pos="'+a+'"]').remove(),$("#"+a).remove(),$('div[btndialog="'+a+'"]').remove())},r=function(a){$('div[pos="'+a+'"]').click(function(){m(a)});$("#"+a).prev("div").find("a.ui-dialog-titlebar-close.ui-corner-all").click(function(){m(a)})};$(document).keydown(function(a){27==a.keyCode&&
0!=$("#shadow").length&&m(l())});var p=function(a,b){$("#"+a).prev("div").find("span").prepend(b)},u=function(a,b,c){$("#"+a).prev("div").find("span").append(' <a href="'+c+'" target="_blank" class="'+b+'"></a>')},n=function(a,b){var c=void 0==b?function(){alert("No attached Handler")}:b;$('div[btndialog="'+a+'"]').append($('<a class="btn btn-sm btn-default">Ok</a>').click(function(){m(a);c()}))},q=function(a){$('div[btndialog="'+a+'"]').append($('<a class="btn btn-sm btn-warning">Cancel</a>').click(function(){m(a)}))},
v=function(a,b,c){void 0!=c?$("body").append("<div id='"+a+"' title='"+c+"' class='custom-modal'> </div>"):$("body").append("<div id='"+a+"' title='Preview of "+b+"' class='custom-modal'> </div>");$("#"+a).dialog({resizable:!1});$("#"+a).append('<iframe src="'+b+'" iframeid="'+a+'">Waiting on server response...</iframe>');$("#"+a).dialog("option","height",$(window).height());$("#"+a).dialog("option","width","80%");$("#"+a).dialog("option","position",{my:"center",at:"center",of:window})},w=function(a,
b,c){void 0!=c?$("body").append("<div id='"+a+"' title='"+c+"' class='custom-modal'> </div>"):$("body").append("<div id='"+a+"' title='Preview of "+b+"' class='custom-modal'> </div>");$("#"+a).dialog({resizable:!1});$("#"+a).append('<div id="'+a+'">Waiting on server response...</iframe>');$("#"+a).dialog("option","width","80%");$("#"+a).dialog("option","position",{my:"center",at:"center",of:window});$("#"+a).load(b)},s=function(a,b,c){void 0!=c?$("body").append("<div id='"+a+"' title='"+c+"' class='custom-modal img-panel'> </div>"):
$("body").append("<div id='"+a+"' title='Preview of "+b+"' class='custom-modal img-panel'> </div>");$("#"+a).dialog({resizable:!1});$("#"+a).append('<img imgpanelid="'+a+'" src="'+b+'">');$('img[imgpanelid="'+a+'"]').load(function(){var b=$("#"+a).prop("scrollHeight"),c=$("#"+a).prop("scrollWidth")+30,b=b+60;$("#"+a).dialog("option","height",b);$("#"+a).dialog("option","width",c);$("#"+a).dialog("option","position",{my:"center",at:"center",of:window})})},x=function(a,b){var c=f();if(void 0!=a.url)var d=
a.url,e=a.title;else d=a,e=void 0;void 0!=b&&!0==b?s(c,d,e):v(c,d,e);u(c,"floppy",d);$("#"+c).prev("div").find("span").find(".img-title").click(function(){PageLocation.changeLocation(d)});g(c);r(c)};this.regionEditor=null;region=function(a,b){var c=f();$(document.documentElement).append('<div id="'+c+'" class="aladin-lite-div" style="width: 400px; height: 400px"></div>');this.regionEditor=new RegionEditor_mVc(c,a,b);this.regionEditor.init();$("#"+c).dialog({width:"auto",dialogClass:"d-maxsize",title:"Sky Region Editor (beta)",
zIndex:zIndexModalinfo});g(c);r(c);$(".aladin-box").css("z-index",9999);this.regionEditor.setInitialValue(b)};b=".modalinfodiv";$(document).on("dialogopen",".ui-dialog",function(a,b){C()});$(document).on("dialogclose",".ui-dialog",function(a,b){$(window).off("resize.responsive")});var C=function(){$(".ui-dialog:visible").each(function(){var a=$(this),b=a.find(".ui-dialog-content").data("dialog");b.options.maxWidth&&b.options.width&&(a.css("max-width",b.options.maxWidth),b.option("position",b.options.position));
if(b.options.fluid)$(window).on("resize.responsive",function(){$(window).width()<b.options.maxWidth+50&&a.css("width","90%");b.option("position",b.options.position)})})},D=function(){var a=$(b).parent();a.css("position","absolute");a.css("top",Math.max(0,($(window).height()-a.outerHeight())/2+$(window).scrollTop())+"px");a.css("left",Math.max(0,($(window).width()-a.outerWidth())/2+$(window).scrollLeft())+"px")},y={};y.dump=d;y.dumpAscii=function(a,b){b=b||"";var c="";if(Array.isArray(a)){for(var c=
c+"[",e=0;e<a.length;e++)c+=d(a[e],b);c+=b+"]"}else if(null===a)c="NULL";else switch(typeof a){case "undefined":c+="UNDEFINED";break;case "object":var e=!0,f;for(f in a)c=e?c+("\n"+b):"id"!=f&&"$"!=f?c+b:c+" ",c+=f+": ",c+=d(a[f],b+"  "),"id"!=f&&"$"!=f&&(c+="\n"),e=!1;break;case "boolean":c+=a?"TRUE":"FALSE";break;case "number":c+=a;break;case "string":0===a.lastIndexOf("http",0)&&(a=decodeURIComponent(a));c=a.match(/\s/)?c+('"'+a+'"'):c+a;break;case "function":c+="<FUNCTION>";break;default:c+=a}return c};
y.nextId=f;y.findLastModal=l;y.setShadow=g;y.whenClosed=r;y.setModal=h;y.close=m;y.info=function(a,b){var d=f();h(d,!1,void 0==b?"Information":b,c(a));g(d);r(d)};y.infoObject=function(a,b){var c=f();h(c,!1,void 0==b?"INFO":b,"<pre>"+d(a,"  ").replace(/[\n]+/g,"<br />")+"</pre>");p(c,'<span class="glyphicon glyphicon-info-sign"></span>');g(c);r(c)};y.confirm=function(a,b,d){var e=f();h(e,!1,void 0==d?"Confirmation":d,c(a));p(e,'<span class="glyphicon glyphicon-ok-sign"></span>');$("#"+e).append('<div class="btn-dialog" btndialog="'+
e+'"></div>');n(e,b);q(e);g(e);r(e)};y.error=function(a,b){var e=f();Out.infoTrace(a);jQuery.isPlainObject({})?h(e,!1,void 0==b?"Error":b,d(a,"&nbsp;&nbsp;").replace(/\n[\n\s]*/g,"<br />")):h(e,!1,void 0==b?"Error":b,c(a));p(e,'<span class="glyphicon glyphicon-remove-sign"></span>');g(e);r(e)};y.uploadForm=function(a,b,c,e,w,l,n){var s=f(),u='<form id="upload-form" class="form-horizontal" target="_sblank" action="'+b+'" method="post"enctype="multipart/form-data">';if(null!=l)for(b=0;b<l.length;b++)u+=
"<input type='hidden'  name='"+l[b].name+"'  value='"+l[b].value+"'>";u+='<input type=\'hidden\'  name=\'fileName\'  value=\'\'><div class="align-center"><input class="stdinput custom-file" id="uploadPanel_filename" type="file" name="file"/><p class="overflow info-upload"></p><p id="upload_status"></p><p class="form-description"></p></div><p id="infos"></p><div class="align-center"><input disabled type="submit" value="Upload" class="custom-submit"/></div></form>';h(s,!1,a,u);p(s,'<span class="glyphicon glyphicon-file"></span>');
g(s);r(s);$("#"+s).find(".custom-file").on("dragover drop",function(a){a.preventDefault()}).on("drop",function(a){$("#"+s).find(".custom-file").prop("files",a.originalEvent.dataTransfer.files).closest("form");$("input").prop("disabled",!1)});a=null!=c?c:"";if(null!=n&&0<n.length){a+="<br>Preloaded files: <select id=preloadedFiles ><option/>";for(b=0;b<n.length;b++)a+="<option>_Goodies_"+n[b];a+="</select>"}$("#"+s).find(".form-description").html(a);$("#"+s).find(".custom-file").change(function(){$("#"+
s).find(".custom-file").fadeTo("slow",0.3,function(){}).delay(800).fadeTo("slow",1);$("input[value=Upload]").prop("disabled",!1);var a=this.value.xtractFilename().filename;$("#"+s).find(".info-upload").text(a);$("input[name=fileName]").val(a);$("#preloadedFiles").prop("disabled",!0)});$("#preloadedFiles").change(function(){var a=$(this).val();0<a.length?($("input[value=Upload]").prop("disabled",!1),$("#uploadPanel_filename").prop("disabled",!0)):($("input[value=Upload]").prop("disabled",!0),$("#uploadPanel_filename").prop("disabled",
!1));$("input[name=fileName]").val(a)});$("#"+s).find("#upload-form").ajaxForm({beforeSubmit:function(){null!=w&&w()},success:function(a){if(Processing.jsonError(a,"Upload Position List Failure"))m(s);else{$("#upload_status").html("Uploaded");$("#upload_status").css("color","green");var b=$("#preloadedFiles option:selected").val();if(null==b||0==b.length)b=$("#"+s).find("#uploadPanel_filename").val();obj_retour={retour:a,path:b.xtractFilename()};null!=e?e(obj_retour):(a=d(obj_retour).replace(/\n/g,
"<br />"),a=a.replace(/^<br\s*\/?>|<br\s*\/?>$/g,""),$("#infos").html(a));Modalinfo.close(s)}}})};y.openIframePanel=x;y.openIframeCrossDomainPanel=function(b,c){var d=f();if(void 0!=b.url)var e=b.url,h=b.title;else e=b,h=void 0;a(e)?(void 0!=c&&!0==c?s(d,e,h):w(d,e,h),u(d,"floppy",e),$("#"+d).prev("div").find("span").find(".img-title").click(function(){PageLocation.changeLocation(e)}),g(d),r(d)):PageLocation.changeLocation(e)};y.iframePanel=x;y.simbad=function(a){Processing.show("Waiting on Simbad Response");
$.getJSON("simbadtooltip",{pos:a},function(b){Processing.hide();if(!Processing.jsonError(b,"Simbad Tooltip Failure")){var c;c='<table cellpadding="0" cellspacing="0" border="0"  id="simbadtable" class="display table"></table>';var d=f();h(d,!1,"Simbad Summary for Position "+a+'<a class=simbad target=blank href="http://simbad.u-strasbg.fr/simbad/sim-coo?Radius=1&Coord='+encodeURIComponent(a)+'"></a>',c,1E3);g(d);r(d);$("#"+d).css("overflow","hidden");c={aoColumns:b.aoColumns,aaData:b.aaData,bPaginate:!0,
sPaginationType:"full_numbers",aaSorting:[],bSort:!1,bFilter:!0,bAutoWidth:!0,bDestroy:!0};b=0<b.aaData.length?'<img src="http://alasky.u-strasbg.fr/cgi/simbad-thumbnails/get-thumbnail.py?name='+encodeURIComponent(b.aaData[0][0])+'"/>':'<span class="help">No vignette available</span>';CustomDataTable.create("simbadtable",c,[{name:b,pos:"top-left"},{name:"filter",pos:"top-right"},{name:"information",pos:"bottom-left"},{name:"pagination",pos:"bottom-center"},{name:" ",pos:"bottom-right"}]);$("#"+d).find(".dataTables_filter").css("margin-top",
"34%");$("#"+d).dialog("option","position",{my:"center",at:"center",of:window})}})};y.region=region;y.closeRegion=function(){$('div[pos="'+$(".aladin-lite-div").attr("id")+'"]').remove();$(".aladin-lite-div").remove()};y.dataPanel=function(a,c,d,e){if(0!=$(b).length){$(b).html("");$(b).html(c);$(b).css("background-color",e);var h=null==d?function(a,c){$(b).html("")}:d;$(b).on("dialogclose",h);$('div[pos="'+$(b).attr("id")+'"]').on("click",h);var w=$(b).attr("id"),m=l();$(document).on("keydown",function(a){27==
a.keyCode&&m==w&&h()})}else{var p=9999;0!=$(".modalresult").length&&(p=$(".modalresult").zIndex()+10);var n=f();$(document.documentElement).append('<div id="'+n+'" class="modalinfodiv" style="display: none; width: auto; hight: auto;"></div>');h=null==d?function(a,b){$("#"+n).html("")}:d;null!=e&&$("#"+n).css("background-color",e);$("#"+n).html(c);$("#"+n).dialog({width:"auto",dialogClass:"d-maxsize",title:a,fluid:!0,close:h,resizable:!1});$("#"+n).find("h4").find("#detailhisto").length&&(1E3<=$(window).width()?
($("#"+n).dialog("option","width",1E3),D()):C());$("#"+n).zIndex(p);$('div[pos="'+$(b).attr("id")+'"]').on("click",h);w=$(b).attr("id");m=l();$(document).on("keydown",function(a){27==a.keyCode&&m==w&&h()});g(n);r(n)}};y.closeDataPanel=function(){m($(b).attr("id"))};y.fluidDialog=C;y.getHtml=function(){return $(b).html()};y.center=D;y.addIconTitle=p;return y}();
ModalAladin=function(){var a=null,b,c,d={Vizier:{bg:"green",fg:"white"},Simbad:{bg:"blue",fg:"white"},NED:{bg:"orange",fg:"black"},target:{bg:"red",fg:"white"},service_0:{bg:"#00ffff",fg:"black"},service_1:{bg:"#66ff33",fg:"black"},service_2:{bg:"#ff9966",fg:"black"},service_3:{bg:"yellow",fg:"black"}},e,f=null,g=function(){$("#aladin-lite-sider").css("visibility","hidden")},h=function(a){var b=$("#"+a).parent(".ui-dialog").zIndex();0==$("#shadow").length?($("body").append('<div id="shadow" pos="'+
a+'"></div>'),$("#shadow").zIndex(b-1)):($("body").append('<div class="shadow" pos="'+a+'"></div>'),$('div[pos="'+a+'"]').zIndex(b-1));jqShadow=$('div[pos="aladin-lite-container"]')},l=function(){$("#aladin-lite-catdiv .aladin-popup-container").hide();b.css("visibility","hidden");b.dialog("destroy");jqShadow.remove()},m=function(c){ModalAladin.init();a.removeLayers();$("#aladin-lite-container");b.css("visibility","visible");b.dialog();b.dialog({resizable:!1,width:"auto",title:c,close:function(a,b){l()}});
h("aladin-lite-container");jqShadow.click(function(){l()});b.prev("div").find("a.ui-dialog-titlebar-close.ui-corner-all").click(function(){l()})},r=function(b){m(b.label);jqInfoAladin.text("Click to get source info").attr("rows",6).css("visibility","visible");g();if(null==a.view.imageSurvey||null==a.view.imageSurvey.id)a.setImageSurvey("P/XMM/PN/color"),a.gotoObject(b.target),a.setZoom(b.fov);if(b.url){var c=A.catalogFromURL(b.url,{sourceSize:8,color:"red",onClick:"showTable"});a.addCatalog(c)}else if(b.points){c=
A.catalog({name:"Source List",sourceSize:8});a.addCatalog(c);for(var d=0;d<b.points.length;d++){var e=b.points[d];c.addSources([A.marker(e.ra,e.dec,{popupTitle:e.name,popupDesc:e.description})])}}},p=function(c,g,r,m){for(var p=0;p<g.length;p++){var n="service_"+p;r.append("<p id='"+n+"' title='Show/hide data overlay' class='datahelp' style='cursor: pointer;'>"+g[p].name+"</p>");g[p].color=d["service_"+p];$("#"+n).data(g[p])}$("#aladin-lite-sider p").click(function(){var b=$(this),g=$(this).data();
if("selecteddatahelp"==b.attr("class"))for(b.css("color",""),b.css("background-color","white"),b.attr("class","datahelp"),b=0;b<a.view.catalogs.length;b++){if("Target"==a.view.catalogs[b].name||"Swarm"==a.view.catalogs[b].name||a.view.catalogs[b].name.startsWith(g.name)){a.view.catalogs.splice(b,1);a.view.mustClearCatalog=!0;a.view.requestRedraw();break}}else{var z="service_target"==b.attr("id")?d.target:g.color;b.attr("class","selecteddatahelp");b.css("color",z.fg);b.css("background-color",z.bg);
"service_target"==b.attr("id")?(b.css("color",z.fg),b.css("background-color",z.bg),null!=f?(Processing.showWithTO("Fetching Data",5E3),a.gotoObject(e),b=A.catalogFromURL(c.swarm,{name:"Swarm",sourceSize:8,shape:"plus",color:"red",onClick:"showTable"},function(){Processing.hide()}),a.addCatalog(b)):(b=A.catalog({name:"Target"}),a.gotoObject(e),a.addCatalog(b),b.addSources([A.marker(m[0],m[1],{popupTitle:c.title})]))):"votable"==g.type?(Processing.showWithTO("Fetching Data",5E3),b=A.catalogFromURL(g.url,
{name:g.name,sourceSize:8,shape:"plus",color:g.color.bg,onClick:"showTable"},function(){Processing.hide()}),a.addCatalog(b)):$.getJSON(g.url,function(b){Processing.hide();if(!Processing.jsonError(b,g.url)){var c=A.catalog({name:g.name,sourceSize:8,color:g.color.bg,shape:"plus",onClick:"showTable"});a.addCatalog(c);for(var d=0;d<b.length;d++){var e=b[d];c.addSources([A.source(e.ra,e.dec,{ra:Numbers.toSexagesimal(e.ra/15,7,!1),dec:Numbers.toSexagesimal(e.dec,7,!0),Name:e.name,Description:e.description})])}}})}});
p=g.length;n="service_simbad";r.append("<hr><p id='"+n+"' title='Show/hide Simbad sources' class='datahelp' style='cursor: pointer;' onclick='ModalAladin.displaySimbadCatalog();'>Simbad</p>");$("#"+n).data({name:"Simbad"});p++;n="service_ned";r.append("<p id='"+n+"' title='Show/hide NED sources' class='datahelp' style='cursor: pointer;' onclick='ModalAladin.displayNedCatalog();'>NED</p>");$("#"+n).data({name:"NED"});p++;n="service_vizier";r.append("<p id='"+n+"' title='Show/hide selected catalog sources' class='datahelp' style='cursor: pointer;' onclick='ModalAladin.toggleSelectedVizierCatalog();'>Vizier...</p><div id='AladinHipsCatalogs'></div>");
$("#"+n).data({name:"VizieR"});g=new HipsExplorer_mVc({aladinInstance:a,parentDivId:"AladinHipsCatalogs",formName:"AladinHipsCatalogsExplorer",target:{ra:m[0],dec:m[1],fov:c.fov},productType:"catalog",handler:function(a){var b=$("#itemList");"none"==b.css("display")&&(b.css("display","block"),b.css("z-index","10000"));b.html("<span class=strong>"+a.length+' matching Catalogues</span><a href="#" onclick="$(&quot;#itemList&quot;).css(&quot;display&quot;, &quot;none&quot;);" style="top: 18px;" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a><br>');
for(var c=0;c<a.length;c++)b.append("<br><span class=datahelp style='cursor: pointer' onclick='ModalAladin.displaySelectedVizierCatalog(&quot;"+a[c].obs_id+"&quot);'>"+a[c].obs_title+"</span><br><span class=blackhelp>"+a[c].obs_regime+"</span><br><span class=blackhelp>"+a[c].obs_description+"</span>")}});g.draw();r.append("<hr><p id='service_aladin' title='Change image survey' class='datahelp' style='cursor: pointer;'>Images...</p><div id='AladinHipsImages'></div>");g=new HipsExplorer_mVc({aladinInstance:a,
parentDivId:"AladinHipsImages",formName:"AladinHipsImagesExplorer",target:{ra:m[0],dec:m[1],fov:c.fov},productType:"image",handler:function(a){var b=$("#itemList");"none"==b.css("display")&&(b.css("display","block"),b.css("z-index","10000"));b.html("<span class=strong>"+a.length+' matching Hips images</span>\n<a href="#" onclick="$(&quot;#itemList&quot;).css(&quot;display&quot;, &quot;none&quot;);" style="top: 18px;" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a><br>');
for(var c=0;c<a.length;c++)b.append("<br><span class=datahelp style='cursor: pointer' onclick='ModalAladin.displaySelectedHips(&quot;"+a[c].obs_title+"&quot;, &quot;"+a[c].hips_service_url+"&quot;, &quot;"+a[c].hips_frame+"&quot;, &quot;"+a[c].hips_order+"&quot;, &quot;"+a[c].hips_tile_format+"&quot;)'>"+a[c].obs_title+"</span><br><span class=blackhelp>"+a[c].publisher_did+"</span><br><span class=blackhelp>"+a[c].obs_regime+"</span><br><span class=blackhelp>"+a[c].obs_description+"</span>")}});g.draw();
h("aladin-lite-container");jqShadow.click(function(){l()});b.prev("div").find("a.ui-dialog-titlebar-close.ui-corner-all").click(function(){l()});r="DSS2 optical HEALPix survey, color (R=red[~0.6um]/G=average/B=blue[~0.4um])";g="http://alasky.u-strasbg.fr/DSS/DSSColor";var p="equatorial",n=9,q="jpeg",z;if(z=c.surveyKeyword)z=z.toLowerCase(),"mars"==z?(r="Mars MOLA Shaded Relief / Colorised Elevation",g="http://alasky.u-strasbg.fr/Planets/Mars_MOLA/",p="mars",n=5,q="jpeg"):"moon"==z?(r="Moon Kaguya-Evening-V04-474m",
g="http://alasky.u-strasbg.fr/Planets/CDS_P_Moon_Kaguya-Evening-V04-474m",p="moon",n=3,q="png"):"venus"==z?(r="Venus Magellan C3-MDIR-ClrTopo-6600m-color",g="http://alasky.u-strasbg.fr/Planets/CDS_P_Venus_Magellan_C3-MDIR-ClrTopo-6600m-color",p="venus",n=5,q="jpeg"):"mercury"==z&&(r="Mercury MESSENGER-MDIS-LOI-166m",g="http://alasky.u-strasbg.fr/Planets/CDS_P_Mercury_MESSENGER-MDIS-LOI-166m",p="mercury",n=5,q="jpeg");u(r,g,p,n,q)},u=function(b,c,d,e,f){var g=$("#service_aladin");$("#itemList").css("display",
"none");g.html(b);g="";g=0<=f.indexOf("png")?"png":"jpg";""!=g?a.setImageSurvey(a.createImageSurvey(b,b,c,d,e,{imgFormat:g})):a.setImageSurvey(a.createImageSurvey(b,b,c,d,e))},n=function(b){if(void 0==b||""==b||b.startsWith("Vizier...")){Modalinfo.info("you must first select a catalogue");var c=$("#service_vizier");c.css("color","");c.css("background-color","white")}else{for(var c=$("#service_vizier"),e=0;e<a.view.catalogs.length;e++)if(a.view.catalogs[e].name.startsWith("VizieR")){a.view.catalogs.splice(e,
1);a.view.mustClearCatalog=!0;a.view.requestRedraw();break}$("#itemList").css("display","none");c.attr("class","selecteddatahelp");c.css("color",d.Vizier.fg);c.css("background-color",d.Vizier.bg);c.html(b);c=q();Processing.show("Fetching Vizier data");a.addCatalog(A.catalogFromVizieR(b,a.getRaDec()[0]+" "+a.getRaDec()[1],c,{onClick:"showTable",color:d.Vizier.bg},function(){Processing.hide()}))}},q=function(){var b=a.getFov()[0];0.5<b&&(Modalinfo.info("Search radius limted to 1/4deg","Warning"),b=
0.25);return b},v={init:function(){null==a&&($("body").append("<div id=aladin-lite-container style='visibility: hidden;'><div  id=aladin-lite-sider style='display: block;float: left;width: 200px; height: 100%; padding-right: 5px;'></div><div style='position: relative; display: block;float:left;width: 400px'>   <div id='aladin-lite-catdiv' style='width: 400px; height: 400px'></div>   <div id='itemList' style='background-color: #f2f2f2; border-radius: 5px; padding: 5px; margin: 5px; display: none; overflow:auto;position: absolute; left: 0px; top: 0px; width: 390px; height: 90%;'></div></div></div>"),
a=A.aladin("#aladin-lite-catdiv",{showLayersControl:!0,showGotoControl:!0,showZoomControl:!0,showFullscreenControl:!1,showReticle:!0,showFrame:!0,cooFrame:"ICRS"}),b=$("#aladin-lite-container"),c=$("#"+c),jqInfoAladin=$("#aladin-lite-catdiv-info"))}};v.showSourcesInAladinLite=r;v.showSourceInAladinLite=function(a){r({target:a.ra+" "+a.dec,label:a.name,fov:a.fov?patrams.fov:0.5,points:[{ra:a.ra,dec:a.dec,name:a.name,description:a.description}]});jqInfoAladin.text("").attr("rows",1).css("visibility",
"hidden");g()};v.showAsyncSourcesInAladinLite=function(a){Processing.show("Fetching data");$.getJSON(a.url,function(b){Processing.hide();Processing.jsonError(b,a.url)||r({label:a.label,target:a.target,fov:a.fov,points:b})})};v.showSTCRegion=function(b){ModalAladin.init();m("STC Region Viewer");a.setImageSurvey("P/DSS2/color");a.gotoObject(b.raCenter+" "+b.decCenter);a.setZoom(2*b.size);var c=b.stcString;c instanceof Object?jqInfoAladin.text(Modalinfo.dumpAscii(c,"   ")):jqInfoAladin.text(c);c=A.graphicOverlay({color:"red",
lineWidth:2});a.addOverlay(c);c.addFootprints(A.polygon(b.points))};v.aladinExplorer=function(c,g){f=null;if(void 0==c||null!=c.swarm&&-1!=c.swarm.indexOf("localhost"))Modalinfo.info("Aladin Lite cannot operate services running on localhost<br>It can only work with services accessible from the CDS server","Access denied");else{if(null!=g)for(var h=0;h<g.length;h++)if(-1!=g[h].url.indexOf("localhost")){Modalinfo.info("Aladin Lite cannot operate services running on localhost<br>It can only work with services accessible from the CDS server",
"Access denied");return}ModalAladin.init();$("#aladin-lite-sider").css("visibility","visible");a.removeLayers();$("#aladin-lite-container");var r=$("#aladin-lite-sider");r.html("");b.css("visibility","visible");b.dialog();b.dialog({resizable:!1,width:"auto",title:c.title?c.title:"Aladin Explorer",close:function(a,b){l()}});var m;r.html("");r.append("<p id='service_target' title='Show&center/hide the target' class='datahelp' style='cursor: pointer;'>Target</p>");void 0!=c.target?(a.gotoObject(c.target),
a.setZoom(c.fov),e=c.target,initialFov=c.fov,m=a.getRaDec(),p(c,g,r,m)):void 0!=c.region?(6<c.region.points.length?(a.gotoObject(c.region.raCenter+" "+c.region.decCenter),a.setZoom(0==c.region.size?0.016:2*c.region.size),h=A.graphicOverlay({color:"red",lineWidth:2}),a.addOverlay(h),h.addFootprints(A.polygon(c.region.points))):(c.target=c.region.raCenter+" "+c.region.decCenter,a.gotoObject(c.target),a.setZoom(c.fov),e=c.target,initialFov=c.fov,c.fov=0==c.region.size?0.016:2*c.region.size),m=a.getRaDec(),
p(c,g,r,m)):void 0!=c.swarm&&(Processing.showWithTO("Fetching Data",5E3),h=A.catalogFromURL(c.swarm,{name:"Swarm",sourceSize:8,shape:"plus",color:"red",onClick:"showTable"},function(b){var d=1E3;raMax=-1;var z=90;decMax=-90;for(var h=0;h<b.length;h++)source=b[h],source.ra>raMax&&(raMax=source.ra),source.ra<d&&(d=source.ra),source.dec>decMax&&(decMax=source.dec),source.dec<z&&(z=source.dec);b=decMax-z;z=(decMax+z)/2;h=Math.abs(d-raMax);180<h&&(h=360-h);d=(raMax+d)/2;90<Math.abs(raMax-d)&&(d+=180);
360<d&&(d-=360);b=b>h?b:h;a.gotoRaDec(d,z);a.setZoom(b);m=a.getRaDec();e=0<z?d+" +"+z:d+" -"+z;initialFov=b;f=c.swarm;Processing.hide();p(c,g,r,m)}),a.addCatalog(h),h=$("#service_target"),h.attr("class","selecteddatahelp"),h.css("color",d.target.fg),h.css("background-color",d.target.bg))}};v.displaySelectedHips=u;v.displaySelectedVizierCatalog=n;v.toggleSelectedVizierCatalog=function(){var b=$("#service_vizier");$("#itemList").css("display","none");if("selecteddatahelp"==b.attr("class"))for(b.css("color",
""),b.css("background-color","white"),b.attr("class","datahelp"),b=0;b<a.view.catalogs.length;b++){if(a.view.catalogs[b].name.startsWith("VizieR")){a.view.catalogs.splice(b,1);a.view.mustClearCatalog=!0;a.view.requestRedraw();break}}else b.attr("class","selecteddatahelp"),n($("#service_vizier").html())};v.displaySimbadCatalog=function(){var b=$("#service_simbad");if("selecteddatahelp"==b.attr("class"))for(b.css("color",""),b.css("background-color","white"),b.attr("class","datahelp"),b=0;b<a.view.catalogs.length;b++){if(a.view.catalogs[b].name.startsWith("Simbad")){a.view.catalogs.splice(b,
1);a.view.mustClearCatalog=!0;a.view.requestRedraw();break}}else{var c=q();b.attr("class","selecteddatahelp");b.css("color",d.Simbad.fg);b.css("background-color",d.Simbad.bg);Processing.show("Fetching Simbad data");a.addCatalog(A.catalogFromSimbad(a.getRaDec()[0]+" "+a.getRaDec()[1],c,{onClick:"showTable",color:d.Simbad.bg},function(){Processing.hide()}))}};v.displayNedCatalog=function(){var b=$("#service_ned");if("selecteddatahelp"==b.attr("class"))for(b.css("color",""),b.css("background-color",
"white"),b.attr("class","datahelp"),b=0;b<a.view.catalogs.length;b++){if(a.view.catalogs[b].name.startsWith("NED")){a.view.catalogs.splice(b,1);a.view.mustClearCatalog=!0;a.view.requestRedraw();break}}else b.attr("class","selecteddatahelp"),b.css("color",d.NED.fg),b.css("background-color",d.NED.bg),b=q(),Processing.show("Fetching Ned data"),a.addCatalog(A.catalogFromNED(a.getRaDec()[0]+" "+a.getRaDec()[1],b,{onClick:"showTable",color:d.NED.bg},function(){Processing.hide()}))};return v}();
ModalResult=function(){function a(a){var b=$("#"+a+"").find("img").attr("src");"images/tdown.png"==b?$("#"+a+"").find("img").attr("src","images/tright.png"):"images/tright.png"==b&&$("#"+a+"").find("img").attr("src","images/tdown.png")}var b=[],c={},d=0,e=function(a){var b="";return b=void 0!=a.title?void 0!=a.icon?b+('<div class="col-xs-11">'+a.title.label+'</div><div class="col-xs-1"><a onclick="'+a.icon.handler+'" class='+a.icon.classIcon+"></a></div>"):b+('<div class="col-xs-12">'+a.title.label+
"</div>"):void 0!=a.icon?b+('<div class="col-xs-11">Details</div><div class="col-xs-1"><a onclick="'+a.icon.handler+'" class='+a.icon.classIcon+"></a></div>"):b+'<div class="col-xs-12">Details</div>'},f=function(a){$("#"+a).prev("div").find("span.ui-dialog-title").prepend('<a id="qhistoleft" href="javascript:void(0);" onclick="ModalResult.prevHisto()" class=greyhistoleft></a><span class="nbpages"></span><a id="qhistoright" href="javascript:void(0);" onclick="ModalResult.nextHisto()" class=greyhistoright></a>')},
g=function(a,b){for(i=0;i<b.chapters.length;i++){$(a).append('<p class="chapter" id="'+b.chapters[i].id+'"><img src="images/tright.png">'+b.chapters[i].label+'</p><div class="detaildata"></div>');var c=b.chapters[i];$("#"+b.chapters[i].id).click({content_click:c},function(a){h(a.data.content_click)})}},h=function(b){var c=$("#"+b.id).next(".detaildata");0==c.length?Out.info("Can't open chapter "+b):0<c.html().length?(c.slideToggle(500),a(b.id)):null!=b.url?(Processing.show("Fetching data"),$.getJSON(b.url,
b.params,function(c){Processing.hide();Processing.jsonError(c,b.url)||(l(b.id,c,b.searchable),a(b.id),Modalinfo.center())})):void 0!=b.data&&null!=b.data&&(l(b.id,b.data,b.searchable),a(b.id),ModalResult.center())},l=function(a,b,c){if(void 0!=b.length)for(var d=$("#"+a).next(".detaildata"),e=c?'<"top"f>rt':"rt",f=0;f<b.length;f++){var g="detail"+f+a+"table";d.append("<table id="+g+'  width=100% cellpadding="0" cellspacing="0" border="0"  class="display"></table>');var h={aoColumns:b[f].aoColumns,
aaData:b[f].aaData,sDom:e,bPaginate:!1,aaSorting:[],bSort:!1,bFilter:c},z=[{name:"filter",pos:"top-left"}];CustomDataTable.create(g,h,z);void 0!=b[f].label&&$("#"+a).next(".detaildata").append(b[f].label)}else g="detail"+a+"table",d=$("#"+a).next(".detaildata"),e=c?'<"top"f>rt':"rt",d.html("<table id="+g+'  width=100% cellpadding="0" cellspacing="0" border="0"  class="display"></table>'),h={aoColumns:b.aoColumns,aaData:b.aaData,sDom:e,bPaginate:!1,aaSorting:[],bSort:!1,bFilter:c},z=[{name:"filter",
pos:"top-left"}],CustomDataTable.create(g,h,z),void 0!=b.label&&$("#"+a).next(".detaildata").append(b.label);d.slideToggle(0)},m=function(a){$('input[aria-controls="'+a+'"]').parent("label").each(function(){$(this).prepend('<div class="form-group no-mg-btm">');$(this).find(".form-group").append('<div class="input-group">');$(this).find(".input-group").append('<div class="input-group-addon input-sm"><span class="glyphicon glyphicon-search"></span></div>');$(this).find("input").appendTo($(this).find(".input-group"));
$(this).find("input").addClass("form-control filter-result input-sm");$(this).find("input").attr("placeholder","Search")})},r=function(a,e){0==b.length?(b.push({place:d,id:e,content:a}),c={place:d,id:e,content:a},d++):b[b.length-1].id!=e&&(b.push({place:d,id:e,content:a}),c={place:d,id:e,content:a},d++)},p=function(){var a=c.place+1+"/"+b.length;$("#qhistoleft").next("span").html(a)},u=function(a,b,c,d){if(0!=$(".modalresult").length){$(".modalresult").html("");null!=c&&$("#"+l).css("background-color",
c);var h=null==b?function(a,b){$(".modalresult").html("")}:b;$(".modalresult").on("dialogclose",function(a,b){a.originalEvent&&h()});$('div[pos="'+$(".modalresult").attr("id")+'"]').on("click",h);$(".modalresult").append('<h4><div id="detailhisto" class="row">'+e(a.header)+"</div></h4>");g(".modalresult",a);d&&r(a,a.chapters[0].params.oid);void 0!=a.header.histo&&(f(l,a.header.histo.prev,a.header.histo.next),p());a.chapters.forEach(function(a){m(a.id)});jQuery(".detaildata").each(function(a){$(this).hide()})}else{var l=
Modalinfo.nextId();$(document.documentElement).append('<div id="'+l+'" class="modalresult" style="display: none; width: auto; hight: auto;"></div>');h=null==b?function(a,b){$("#"+l).html("")}:b;null!=c&&$("#"+l).css("background-color",c);$("#"+l).append('<h4><div id="detailhisto" class="row">'+e(a.header)+"</div></h4>");g("#"+l,a);$("#"+l).dialog({width:"auto",dialogClass:"d-maxsize",resizable:!1,closeOnEscape:!0,close:function(a,b){a.originalEvent&&(h(),Modalinfo.close(Modalinfo.findLastModal()))},
width:"auto",maxWidth:1E3,fluid:!0,open:function(b,c){r(a,a.chapters[0].params.oid);Modalinfo.fluidDialog()}});jQuery(".detaildata").each(function(a){$(this).hide()});void 0!=a.header.histo&&(f(l,a.header.histo.prev,a.header.histo.next),p());a.chapters.forEach(function(a){m(a.id)});$("#"+l).find("h4").find("#detailhisto").length&&(1E3<=$(window).width()?($("#"+l).dialog("option","width",1E3),n()):Modalinfo.fluidDialog());$('div[pos="'+$(".modalresult").attr("id")+'"]').on("click",h);Modalinfo.setShadow(l);
Modalinfo.whenClosed(l)}},n=function(){var a=$(".modalresult").parent();a.css("position","absolute");a.css("top",Math.max(0,($(window).height()-a.outerHeight())/3+$(window).scrollTop())+"px");a.css("left",Math.max(0,($(window).width()-a.outerWidth())/2+$(window).scrollLeft())+"px")},q={prevHisto:function(){c=0>=c.place?b[b.length-1]:b[c.place-1];u(c.content,null,"white");p()},nextHisto:function(){c=c.place>=b.length-1?b[0]:b[c.place+1];u(c.content,null,"white");p()}};q.changeFilter=m;q.resultPanel=
u;q.getHtml=function(){return $(".modalresult").html()};q.center=n;q.openChapterPanel=h;return q}();
Modalcommand=function(){var a=function(){0!=$("#modalcommanddiv").length&&$("#modalcommanddiv").remove();$(document.documentElement).append("<div id=modalcommanddiv style='display: none; width: auto; hight: auto;'></div>")};return{commandPanel:function(b,c,d){a();d=null==d?function(a,b){}:d;$("#modalcommanddiv").html(c);$("#modalcommanddiv").dialog({resizable:!1,width:"auto",title:b,zIndex:zIndexModalinfo-1,close:d})},commandPanelAsync:function(b,c,d,e){a();e=null==e?function(a,b){}:e;d=null==d?function(a,
b){}:d;$("#modalcommanddiv").html(c);$("#modalcommanddiv").dialog({resizable:!1,width:"auto",title:b,zIndex:zIndexModalinfo-1,close:e,open:d})},setDivToggling:function(a){$("#modalcommanddiv fieldset legend").click(function(){$(this).parent().find("div").first().toggle(a)})},collapseDiv:function(a){$("#modalcommanddiv fieldset legend").each(function(){$(this).parent().find("div").first().toggle(a)})}}}();
Processing=function(){var a=-1,b=function(b){b=b.replace(/"/g,"");Out.info("PROCESSSING "+b);stillToBeOpen=!0;0==$("#saadaworking").length&&$(document.body).append('<div id="saadaworking" style="margin: auto;padding: 5px; display: none;z-index: '+zIndexProcessing+';opacity: 0.5;top: 0; right: 0; bottom: 0; left: 0;background-color: black;position: fixed;"></div><div id="saadaworkingContent" style="position:absolute; top:50%;margin-top:-22px; width: 300px;  margin-left: -150px; left: 50%; background-color: white; opacity: 1;z-index: '+
(zIndexProcessing+1)+'; border:5px solid #DDD; border-radius: 5px"></div>');$("#saadaworkingContent").html("<div class=progresslogo></div><div id=saadaworkingContentText class=help style='margin-top: 8px; display: inline; width: 240px; float:left; padding: 5px;font-size: small;'>"+b+"</div>");$("#saadaworking").css("display","inline");$("#saadaworkingContent").css("display","inline");a=(new Date).getTime()},c={};c.show=b;c.hide=function(){Out.debug("close processing");var b=$("#saadaworkingContentText").text();
700>(new Date).getTime()-a?setTimeout('Processing.closeIfNoChange("'+b+'" )',700):($("#saadaworking").css("display","none"),$("#saadaworkingContent").css("display","none"))};c.closeIfNoChange=function(a){$("#saadaworkingContentText").text()==a?($("#saadaworking").css("display","none"),$("#saadaworkingContent").css("display","none")):Out.debug("The content of the progress dialog has changed: not closing it")};c.jsonError=function(a,b,c){return void 0==a||null==a?(Modalinfo.error("JSON ERROR: "+b+": no data returned"),
!0):null!=a.errormsg?(void 0==c?Modalinfo.error(a.errormsg,b):Modalinfo.error(c),!0):!1};c.showWithTO=function(a,c){Out.debug("PROCESSSING (show and hide) "+a);b(a+" (automatically closed after "+c/1E3+"s)");setTimeout('$("#saadaworking").css("display", "none");$("#saadaworkingContent").css("display", "none");',c)};c.showAndHide=function(a){Out.debug("PROCESSSING (show and hide) "+a);b(a);setTimeout('$("#saadaworking").css("display", "none");$("#saadaworkingContent").css("display", "none");',500)};
return c}();
Out=function(){var a=!1,b=!1,c=!1,d=function(a,b,d){if(!c){var h=Error("dummy"),l;console.log(a+": "+b);if(d&&null!=(l=h.stack))for(a=l.split("\n"),b=3;b<a.length&&(console.log(a[b]),!(3<b)||d);b++);}};return{debugMsg:function(b){a&&d("DEBUG",b,!1)},debugTrace:function(b){a&&d("DEBUG",b,!0)},infoMsg:function(a){d(" INFO",a,!1)},infoTrace:function(a){d(" INFO",a,!0)},info:function(a){d(" INFO",a,b)},debugModeOn:function(){c=!1;a=!0},debugModeOff:function(){a=!1},debug:function(c){a&&d("DEBUG",c,b)},
traceOn:function(){c=!1;b=!0},traceOff:function(){b=!1},setPackedMode:function(){a=!1;traceModeOff();c=!0},setdebugModeFromUrl:function(){var c=(/debug=(.+?)(&|$)/.exec(location.search)||[,null])[1];b=a=!1;null!=c&&("on"==c?(Out.info("Set debug on and trace off"),Out.debugModeOn(),Out.traceOff()):"withtrace"==c?(Out.info("Set debug on and trace on"),Out.debugModeOn(),Out.traceOn()):"traceonly"==c?(Out.info("Set debug off and trace on"),Out.debugModeOff(),Out.traceOn()):Modalinfo.info("debug parameter must be either on, withtrace or traceonly. It is ignored for this session."))}}}();
Printer=function(){return{getPrintButton:function(a){return"<a href='#' onclick='Printer.printDiv(\""+a+"\");' class='printer'></a>"},getSmallPrintButton:function(a){return"<a href='#' onclick='Printer.printDiv(\""+a+"\");' class='dlprinter'></a>"},insertPrintButton:function(a,b){$("#"+b).append(printer.getPrintButton(a))},printDiv:function(a){var b=$("#"+a);b?(Out.infoMsg(b),b.print()):Modalinfo.error("PRINT: the element "+a+" doesn't exist")}}}();
PageLocation=function(){var a=this,b=function(){Out.info("Prompt user before to leave");window.onbeforeunload=function(){if(a.authOK)a.authOK=!1;else return WebSamp_mVc.fireIsConnected()&&WebSamp_mVc.fireUnregister(),"WARNING: Reloading or leaving this page will lost the current session"}},c={download:function(a){authOK=!0;a.startsWith("http")||(a=window.location.protocol+"//"+window.location.hostname+(location.port?":"+location.port:"")+window.location.pathname+"/"+a);Out.info("Download "+a);$(document.body).append('<iframe id="downloadIframe" src="'+
a+'" style="display: hiddden;">Waitng for server response...</iframe>');this.downloadIframe=$("#downloadIframe")},changeLocation:function(a,b){Out.info("changeLocation to "+a);authOK=!0;window.open(a,b?b:"_blank")}};c.confirmBeforeUnlaod=b;c.confirmBeforeUnload=b;return c}();console.log("=============== >  basics.js ");
var supportedUnits=[{id:"none",text:"none"},{id:"Power_erg/s",text:"erg/s"},{id:"Power_W",text:"W"},{id:"Flux_erg/s/cm2",text:"erg/s/cm2"},{id:"Flux_Jy",text:"Jy"},{id:"Flux_mJy",text:"mJy"},{id:"Flux_mJy",text:"mJy"},{id:"Angle_deg",text:"deg"},{id:"Angle_arcmin",text:"arcmin"},{id:"Angle_arcsec",text:"arcsec"},{id:"Angle_h:m:s",text:"h:m:s"},{id:"Velocity_m/s",text:"m/s"},{id:"Velocity_km/s",text:"km/s"},{id:"Velocity_km/h",text:"km/h"},{id:"Velocity_mas/yr",text:"mas/yr"},{id:"Length_kpc",text:"kpc"},
{id:"Length_pc",text:"pc"},{id:"Length_AU",text:"AU"},{id:"Length_km",text:"km"},{id:"Length_m",text:"m"},{id:"Length_cm",text:"cm"},{id:"Length_mm",text:"mm"},{id:"Length_um",text:"um"},{id:"Length_nm",text:"nm"},{id:"Length_Angstroem",text:"Angstroem"},{id:"Energy_erg",text:"erg"},{id:"Energy_eV",text:"eV"},{id:"Energy_keV",text:"keV"},{id:"Energy_MeV",text:"MeV"},{id:"Energy_GeV",text:"GeV"},{id:"Energy_TeV",text:"TeV"},{id:"Energy_J",text:"J"},{id:"Energy_ryd",text:"ryd"},{id:"Frequency_Hz",text:"Hz"},
{id:"Frequency_KHz",text:"KHz"},{id:"Frequency_MHz",text:"MHz"},{id:"Frequency_GHz",text:"GHz"},{id:"Frequency_THz",text:"THz"},{id:"Time_y",text:"y"},{id:"Time_d",text:"d"},{id:"Time_h",text:"h"},{id:"Time_mn",text:"mn"},{id:"Time_sec",text:"sec"},{id:"Time_msec",text:"msec"},{id:"Time_nsec",text:"nsec"}];function STCRegion(a){this.stcString=a;this.decCenter=this.raCenter=this.size=0;this.points=[];this.init()}
STCRegion.prototype={init:function(){for(var a=this.stcString.split(" "),b=[],c=0;c<a.length;c++)isNumber(a[c])&&b.push(parseFloat(a[c]));if(b.length%2)Modalinfo.error("STC Region "+this.stcString+" is not valid");else{for(var a=360,d=0,e=90,f=-90,c=0;c<b.length/2;c++){var g=b[2*c],h=b[2*c+1];g>d&&(d=g);g<a&&(a=g);h>f&&(f=h);h<e&&(e=h)}c=Math.abs(a-d);f=Math.abs(e-f);this.size=c>f?c:f;this.raCenter=a+c/2;360<this.raCenter&&(this.raCenter-=360);this.decCenter=e+f/2;90<this.decCenter&&(this.decCenter-=
90);for(c=0;c<b.length/2;c++)this.points.push([b[2*c],b[2*c+1]]);this.points.push([b[0],b[1]])}},getAladinScript:function(a){return this.stcString+";sync; "+this.raCenter.toFixed(6)+" "+this.decCenter.toFixed(6)+";sync; zoom "+2*this.size+" deg;"}};
function DataTreePath(a){this.tableorg=this.table=this.schema=this.nodekey="notset";this.jobid="";this.key="notset";"signature"in a?(a=a.signature.split("."),this.nodekey=a[0],1<a.length&&(this.schema=a[1],2<a.length&&(this.table=a[2],this.tableorg=a[2],3<a.length&&(this.jobid=a[3])))):("jobid"in a&&(this.jobid=a.jobid),"nodekey"in a&&(this.nodekey=a.nodekey),"schema"in a&&(this.schema=a.schema),"table"in a&&(this.table=a.table),"tableorg"in a&&(this.tableorg=a.tableorg),"notset"==this.table&&"notset"!=
this.tableorg?this.table=this.tableorg:"notset"!=this.table&&"notset"==this.tableorg&&(this.tableorg=this.table));this.key=this.nodekey+"."+this.schema+"."+this.tableorg+(this.jobid?"."+this.jobid:"")}
MetadataSource=function(){var a=null,b=null,c={};return{ahMap:function(a){return c?c[a.key].hamap:null},relations:function(a){return c?c[a.key].relation:null},joinedTables:function(a){return c?c[a.key].targets:null},init:function(c){"getMetaTable"in c&&(a=c.getMetaTable);"getJoinedTables"in c&&(b=c.getJoinedTables)},getTableAtt:function(d,e){key=d.key;if(void 0==c[key]){var f={};f.dataTreePath=d;f.hamap=[];f.relations=[];f.classes=[];f.targets=[];if(null!=a){Out.info("Connect new node  "+key);var g=
{jsessionid:this.sessionID,nodekey:f.dataTreePath.nodekey,schema:f.dataTreePath.schema,table:f.dataTreePath.table};Processing.show("Get column description of table "+JSON.stringify(d));$.ajax({url:a,dataType:"json",async:!1,data:g,success:function(a){Processing.hide();if(!Processing.jsonError(a)){var b=[];if(a.attributes)for(var d=0;d<a.attributes.length;d++){var e=a.attributes[d];!e.nameattr&&e.column_name?e.nameattr=e.column_name:e.nameattr&&!e.column_name&&(e.column_name=e.nameattr);!e.nameattr&&
e.nameorg?(e.nameattr=e.nameorg,e.column_name=e.nameorg):e.nameorg||(e.nameorg=e.nameattr);b.push(e)}f.hamap=b;f.relations=void 0!=a.relations?a.relations:[];f.classes=void 0!=a.classes?a.classes:[];c[key]=f}}});null!=b?(Processing.show("Waiting on join keys "+b),$.ajax({url:b,dataType:"json",async:!1,data:g,success:function(a){Processing.hide();if(a&&!a.errormsg){a=a.targets;for(var b=0;b<a.length;b++){var g=a[b],r=g.target_table.split("."),p;1<r.length?(p=r[0],r=r[1]):(p=d.schema,r=r[0]);p=new DataTreePath({nodekey:d.nodekey,
schema:p,table:r});f.targets.push({target_datatreepath:p,target_column:g.target_column,source_column:g.source_column})}}else Out.info(null==a?"Empty data":a.errormsg);c[key]=f;null!=e&&e(c[key])}})):null!=e&&e(c[key])}}else Out.info("get stored node  "+JSON.stringify(d)+" length = "+c[key].hamap.length),null!=e?e(c[key]):Out.info("No handler");return c[key]},getRelations:function(a){void 0==c[a.key]&&this.getTableAtt(a);return c[a.key].relations},getClasses:function(a){void 0==c[a.key]&&this.getTableAtt(a);
return c[a.key].classes},getJoinedTables:function(){},getUserGoodie:function(){},setJobColumns:function(){},test:function(){MetadataSource.init({getMetaTable:"gettableatt",getJoinedTables:"gettablejoin",getUserGoodie:null});var a=new DataTreePath({nodekey:"node",schema:"schema",table:"table",tableorg:"schema.table"});MetadataSource.getTableAtt(a,function(){console.log("ahMap "+JSON.stringify(MetadataSource.ahMap(a)));console.log("joinedTables "+JSON.stringify(MetadataSource.joinedTables(a)))});MetadataSource.getTableAtt(a,
function(){console.log("ahMap "+JSON.stringify(MetadataSource.ahMap(a)));console.log("joinedTables "+JSON.stringify(MetadataSource.joinedTables(a)))})}}}();Modalinfo.regionEditor=null;
Modalinfo.regionForAMDebugging=function(a,b){$(document.documentElement).append('<div id="aladin-lite-div" style="width: 400px; height: 400px"></div>');this.regionEditor=new RegionEditor_mVc("aladin-lite-div",a,b);this.regionEditor.init();$("#aladin-lite-div").dialog({modal:!0,width:"auto",dialogClass:"d-maxsize",title:"title",zIndex:zIndexModalinfo});$(".aladin-box").css("z-index",zIndexModalinfo+2);this.regionEditor.setInitialValue(b)};
QueryConstraintEditor=function(){return{nativeConstraintEditor:function(a){if($("#"+a.parentDivId).length)return a=new ConstQEditor_mVc(a),new ConstQEditor_mvC(a,new ConstQEditor_Mvc),a.draw(),a;Modalinfo.error("Div #"+a.parentDivId+" not found")},ucdConstraintEditor:function(a){if($("#"+a.parentDivId).length){a=new UcdQEditor_mVc(a);var b=new UcdQEditor_Mvc;new ConstQEditor_mvC(a,b);a.draw();return a}Modalinfo.error("Div #"+a.parentDivId+" not found")},ucdPatternEditor:function(a){if($("#"+a.parentDivId).length){var b=
new UcdPatternEditor_mVc(a);a=new UcdPatternEditor_Mvc(a.relationName);new ConstQEditor_mvC(b,a);b.draw();return b}Modalinfo.error("Div #"+a.parentDivId+" not found")},FitPatternEditor:function(a){if($("#"+a.parentDivId).length){var b=new FitPatternEditor_mVc(a);a=new FitPatternEditor_Mvc(a.relationName,a.className);new ConstQEditor_mvC(b,a);b.draw();return b}Modalinfo.error("Div #"+a.parentDivId+" not found")},FitAttachedPatternsEditor:function(a){if($("#"+a.parentDivId).length)return a=new FitAttachedPatterns_mVc(a),
a.draw(),a;Modalinfo.error("Div #"+a.parentDivId+" not found")},FitBestModelAttachedPatternEditor:function(a){if($("#"+a.parentDivId).length)return a=new FitBestModelAttachedPattern_mVc(a),a.draw(),a;Modalinfo.error("Div #"+a.parentDivId+" not found")},FitBetterModelAttachedPatternEditor:function(a){if($("#"+a.parentDivId).length)return a=new FitBetterModelAttachedPattern_mVc(a),a.draw(),a;Modalinfo.error("Div #"+a.parentDivId+" not found")},FitOrderModelAttachedPatternEditor:function(a){if($("#"+
a.parentDivId).length)return a=new FitOrderModelAttachedPattern_mVc(a),a.draw(),a;Modalinfo.error("Div #"+a.parentDivId+" not found")},matchPatternEditor:function(a){a=new Pattern_mVc(a);a.draw();return a},posConstraintEditor:function(a){if($("#"+a.parentDivId).length){a=new PosQEditor_mVc(a);var b=new PosQEditor_Mvc;new ConstQEditor_mvC(a,b);a.draw();return a}Modalinfo.error("Div #"+a.parentDivId+" not found")},simplePosConstraintEditor:function(a){if($("#"+a.parentDivId).length)return a=new SimplePos_mVc(a),
a.draw(),a;Modalinfo.error("Div #"+a.parentDivId+" not found")},attachedDataEditor:function(a){if($("#"+a.parentDivId).length)return a=new AttachedData_mVc(a),a.draw(),a;Modalinfo.error("Div #"+a.parentDivId+" not found")},attachedPatternEditor:function(a){if($("#"+a.parentDivId).length)return a=new AttachedPattern_mVc(a),a.draw(),a;Modalinfo.error("Div #"+a.parentDivId+" not found")},attachedPatternsEditor:function(a){if($("#"+a.parentDivId).length)return a=new AttachedPatterns_mVc(a),a.draw(),a;
Modalinfo.error("Div #"+a.parentDivId+" not found")},attachedMatchEditor:function(a){if($("#"+a.parentDivId).length)return a=new AttachedMatch_mVc(a),a.draw(),a;Modalinfo.error("Div #"+a.parentDivId+" not found")},vizierKeywordsEditor:function(a){if($("#"+a.parentDivId).length)return a=new VizierKeywords_mVc(a),a.draw(),a;Modalinfo.error("Div #"+a.parentDivId+" not found")},catalogueConstraintEditor:function(a){if($("#"+a.parentDivId).length){var b=new CatalogueQEditor_mVc(a);a=new CatalogueQEditor_Mvc(a);
new ConstQEditor_mvC(b,a);b.draw();return b}Modalinfo.error("Div #"+a.parentDivId+" not found")},crossidConstraintEditor:function(a){if($("#"+a.parentDivId).length){var b=new CatalogueQEditor_mVc(a);a=new CrossidQEditor_Mvc(a);new ConstQEditor_mvC(b,a);b.draw();return b}Modalinfo.error("Div #"+a.parentDivId+" not found")},tapConstraintEditor:function(a){if($("#"+a.parentDivId).length)return a=new tapQEditor_mVc(a),new ConstQEditor_mvC(a,new tapQEditor_Mvc),a.draw(),a;Modalinfo.error("Div #"+a.parentDivId+
" not found")},tapColumnSelector:function(a){if($("#"+a.parentDivId).length)return a=new tapColSelector_mVc(a),new ConstQEditor_mvC(a,new tapColSelector_Mvc),a.draw(),a;Modalinfo.error("Div #"+a.parentDivId+" not found")},tapPosSelector:function(a){if($("#"+a.parentDivId).length)return a=new tapPosQEditor_mVc(a),new ConstQEditor_mvC(a,new tapPosQEditor_Mvc),a.draw(),a;Modalinfo.error("Div #"+a.parentDivId+" not found")},tapCrossMatchSelector:function(a){if($("#"+a.parentDivId).length)return a=new tapCrossMatchQEditor_mVc(a),
new ConstQEditor_mvC(a,new tapPosQEditor_Mvc),a.draw(),a;Modalinfo.error("Div #"+a.parentDivId+" not found")},queryTextEditor:function(a){if($("#"+a.parentDivId).length){a=new QueryTextEditor_mVc(a);var b=new QueryTextEditor_Mvc;new QueryTextEditor_mvC(a,b);a.draw();return a}Modalinfo.error("Div #"+a.parentDivId+" not found")},adqlTextEditor:function(a){if($("#"+a.parentDivId).length){a=new QueryTextEditor_mVc(a);var b=new ADQLTextEditor_Mvc;new QueryTextEditor_mvC(a,b);a.draw();return a}Modalinfo.error("Div #"+
a.parentDivId+" not found")}}}();DataLinkBrowser=function(){return{startBrowser:function(a,b){var c=new DataLink_mVc({baseurl:a,forwardurl:b}),d=new DataLink_Mvc;new DataLink_mvC(c,d);c.draw();return c},startCompliantBrowser:function(a,b,c){a=new CompliantDataLink_mVc({baseurl:a,forwardurl:b,dataobject:c});b=new DataLink_Mvc;new DataLink_mvC(a,b);a.draw();return a}}}();
CustomDataTable=function(){var a=0,b=[],c=function(a,b,c){a[b]=c;return a},d=function(a){var b="",c=[],d=[],m=[],r=[],p=[],u=[];a.forEach(function(a){switch(a.pos){case "top-left":c.push(e(a.name));break;case "top-center":d.push(e(a.name));break;case "top-right":m.push(e(a.name));break;case "bottom-left":r.push(e(a.name));break;case "bottom-center":p.push(e(a.name));break;case "bottom-right":u.push(e(a.name))}});a=0;0<c.length&&a++;0<d.length&&a++;0<m.length&&a++;a=Math.floor(12/a);var n=0;0<r.length&&
n++;0<p.length&&n++;0<u.length&&n++;n=Math.floor(12/n);0<a&&(b+='<"row"');0<c.length&&(b+='<"txt-left col-xs-'+a+'"',c.forEach(function(a){b+='<"side-div"'+a+">"}),b+=">");0<d.length&&(b+='<"txt-center col-xs-'+a+'"',d.forEach(function(a){b+='<"side-div"'+a+">"}),b+=">");0<m.length&&(b+='<"txt-right col-xs-'+a+'"',m.forEach(function(a){b+='<"side-div"'+a+">"}),b+=">");0<a&&(b+=">");b+='<"custom-dt" rt>';0<n&&(b+='<"row"');0<r.length&&(b+='<"txt-left col-xs-'+n+'"',r.forEach(function(a){b+='<"side-div"'+
a+">"}),b+=">");0<p.length&&(b+='<"txt-center col-xs-'+n+'"',p.forEach(function(a){b+='<"side-div"'+a+">"}),b+=">");0<u.length&&(b+='<"txt-right col-xs-'+n+'"',u.forEach(function(a){b+='<"side-div"'+a+">"}),b+=">");0<n&&(b+=">");return b},e=function(c){var d;switch(c){case "filter":d="f";break;case "pagination":d="p";break;case "information":d="i";break;case "length":d="l";break;case "processing":d="r";break;default:d='<"custom'+a+'">',b.push({content:c,pos:a}),a++}return d};return{create:function(a,
e,h){void 0!=e.sPaginationType?"full_numbers"===e.sPaginationType&&(e=c(e,"oLanguage",{sSearch:""})):e=c(e,"oLanguage",{sSearch:"",oPaginate:{sNext:"",sPrevious:""}});void 0!=h&&(e=c(e,"sDom",d(h)));e=$("#"+a).dataTable(e);void 0!=h&&(b.forEach(function(a){$("div.custom"+a.pos).html(a.content)}),ModalResult.changeFilter(a));$("#"+a+"_wrapper").css("overflow","inherit");return e}}}();
Modalinfo.plot=function(a){$.get(a,function(a){function c(a,b){return a[0]-b[0]}var d=Modalinfo.nextId();Modalinfo.setModal(d,!1,"Detection Plots");Modalinfo.addIconTitle(d,'<span class="fi-graph-trend"></span>');$("#"+d).dialog("option","height",$(window).height());$("#"+d).dialog("option","width","80%");$("#"+d).dialog("option","position",{my:"center",at:"center",of:window});Modalinfo.setShadow(d);Modalinfo.whenClosed(d);plotsuccess=new PlotSuccess;a=JSON.parse(a.replace(/NaN/g,'"NaN"'));for(var e=
0;e<a.data.length;e++)for(var f=0;f<a.data[e].data.length;f++)for(var g=0;g<a.data[e].data[f].data.length;g++){for(var h=0;h<a.data[e].data[f].data[g].data.length;h++)-1<a.data[e].data[f].data[g].data[h].indexOf("NaN")&&(a.data[e].data[f].data[g].data.splice(h,1),h-=1);0==a.data[e].data[f].data[g].data.length&&(a.data[e].data[f].data.splice(g,1),g-=1)}for(e=0;2>e;e++)for(f=0;f<a.data[e].data.length;f++)for(g=0;g<a.data[e].data[f].data.length;g++)a.data[e].data[f].data[g].data.sort(c);plotsuccess.plotAll(d,
a);$("#ongletsgraphs").tabs()}).fail(function(){Modalinfo.error("JSON ERROR","Error")})};console.log("=============== >  domain.js ");
WebSamp_Mvc=function(a,b,c){var d=null,e={"samp.name":a,"samp.description":c,"samp.icon.url":b},f=null;TYPE_STRING="string";TYPE_LIST="list";TYPE_MAP="map";var g=!0,h=function(a){if("string"===typeof a)return TYPE_STRING;if(a instanceof Array)return TYPE_LIST;if(a instanceof Object&&null!==a)return TYPE_MAP;throw Error("Not legal SAMP object type: "+a);},l=function(a,b){var c=a.childNodes,d,e=[],f;for(f=0;f<c.length;f++)if(d=c[f],1===d.nodeType){if(b&&d.tagName!==b)throw Error("Child <"+c[f].tagName+
"> of <"+a.tagName+"> is not a <"+b+">");e.push(d)}return e},m=function(a,b){var c=l(a,b);if(1===c.length)return c[0];throw Error("No sole child of <"+a.tagName+">");},r=function(a){var b="",c,d;for(c=0;c<a.childNodes.length;c++){d=a.childNodes[c];if(1===d.nodeType)throw Error("Element found in text content");if(3===d.nodeType||4===d.nodeType)b+=d.nodeValue}return b},p={escapeXml:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},checkParams:function(a,b){var c;
for(c=0;c<b.length;c++)if(b[c]!==TYPE_STRING&&b[c]!==TYPE_LIST&&b[c]!==TYPE_MAP)throw Error("Unknown type "+b[c]+" in check list");var d=a.length,e=[],f=!0;for(c=0;c<d;c++)e.push(h(a[c]));f=f&&b.length===d;for(c=0;f&&c<d;c++)f=f&&b[c]===e[c];if(!f)throw Error("Param type list mismatch: ["+b+"] != ["+e+"]");},valueToXml:function B(a,b){b=b||"";var c,d;d=h(a);if(d===TYPE_STRING)return b+"<value><string>"+p.escapeXml(a)+"</string></value>";if(d===TYPE_LIST){d=[];d.push(b+"<value>",b+"  <array>",b+"    <data>");
for(c=0;c<a.length;c++)d.push(B(a[c],b+"      "));d.push(b+"    </data>",b+"  </array>",b+"</value>");return d.join("\n")}if(d===TYPE_MAP){d=[];d.push(b+"<value>");d.push(b+"  <struct>");for(c in a)d.push(b+"    <member>"),d.push(b+"      <name>"+p.escapeXml(c)+"</name>"),d.push(B(a[c],b+"      ")),d.push(b+"    </member>");d.push(b+"  </struct>");d.push(b+"</value>");return d.join("\n")}throw Error("bad type");},xmlToValue:function z(a,b){var c=l(a),d;if(0===c.length)return r(a);if(1===c.length){c=
c[0];d=c.tagName;if("string"===d)return r(c);if("array"===d){d=l(m(c,"data"),"value");for(var e=[],c=0;c<d.length;c++)e.push(z(d[c],b));return e}if("struct"===d){for(var e=l(c,"member"),f={},g,h,p,c=0;c<e.length;c++){h=g=void 0;for(d=0;d<e[c].childNodes.length;d++)p=e[c].childNodes[d],1==p.nodeType&&("name"===p.tagName?g=r(p):"value"===p.tagName&&(h=z(p,b)));if(void 0!==g&&void 0!==h)f[g]=h;else throw Error("No <name> and/or <value> in <member>?");}return f}if(!b||"int"!==d&&"i4"!==d)throw Error("Non SAMP-friendly value content: <"+
d+">");return r(c)}throw Error("Bad XML-RPC <value> content - multiple elements");},decodeParams:function(a){a=l(a,"param");var b,c=[];for(b=0;b<a.length;b++)c.push(p.xmlToValue(m(a[b],"value")));return c},decodeFault:function(a){a=p.xmlToValue(m(a,"value"),!0);return new p.Fault(a.faultString,a.faultCode)},decodeResponse:function(a){a=a.documentElement;if("methodResponse"!==a.tagName)throw Error("Response element is not <methodResponse>");a=m(a);if("fault"===a.tagName)return p.decodeFault(a);if("params"===
a.tagName)return p.decodeParams(a)[0];throw Error("Bad XML-RPC response - unknown element <"+a.tagName+">");},Fault:function(a,b){this.faultString=a;this.faultCode=b}};p.Fault.prototype.toString=function(){return"XML-RPC Fault ("+this.faultCode+"): "+this.faultString};var u=function(a,b){this.methodName=a;this.params=b||[]};u.prototype.toString=function(){return this.methodName+"("+("undefined"===typeof JSON?"...":JSON.stringify(this.params))+")"};u.prototype.addParam=function(a){this.params.push(a);
return this};u.prototype.addParams=function(a){var b;for(b=0;b<a.length;b++)this.params.push(a[b]);return this};u.prototype.checkParams=function(a){p.checkParams(this.params,a)};u.prototype.toXml=function(){var a=[];a.push("<?xml version='1.0'?>","<methodCall>","  <methodName>"+this.methodName+"</methodName>","  <params>");for(var b=0;b<this.params.length;b++)a.push("    <param>",p.valueToXml(this.params[b],"      "),"    </param>");a.push("  </params>","</methodCall>");return a.join("\n")};var n=
function(a){this.endpoint=a||"http://localhost:21012/"};n.createXHR=function(){var a=function(a){this.xhr=a;a.onreadystatechange=function(b){return function(){if(4===a.readyState&&!b.completed&&200===+a.status&&(b.completed=!0,b.responseText=a.responseText,b.responseXML=a.responseXML,b.onload))b.onload()}}(this);a.onerror=function(a){return function(b){D("XmlRpcClient.create  xhr.onerror No hub?");a.completed||(a.completed=!0);a.onerror&&(b?b.toString=function(){return"No hub?"}:b="No hub?",a.onerror(b))}}(this);
a.ontimeout=function(a){return function(b){if(!a.completed&&(a.completed=!0,a.onerror))a.onerror("timeout")}}(this)};a.prototype.open=function(a,b){this.xhr.open(a,b)};a.prototype.send=function(a){this.xhr.send(a)};a.prototype.abort=function(){this.xhr.abort()};a.prototype.setContentType=function(a){"setRequestHeader"in this.xhr&&this.xhr.setRequestHeader("Content-Type",a)};var b=function(a){this.xdr=a;a.onload=function(b){return function(){b.responseText=a.responseText;if("text/xml"===a.contentType||
"application/xml"===a.contentType||/\/x-/.test(a.contentType))try{var c=new ActiveXObject("Microsoft.XMLDOM");c.loadXML(a.responseText);b.responseXML=c}catch(d){b.responseXML=d}if(b.onload)b.onload()}}(this);a.onerror=function(a){return function(b){if(a.onerror)a.onerror(b)}}(this);a.ontimeout=function(a){return function(b){if(a.onerror)a.onerror(b)}}(this)};b.prototype.open=function(a,b){this.xdr.open(a,b)};b.prototype.send=function(a){this.xdr.send(a)};b.prototype.abort=function(){this.xdr.abort()};
b.prototype.setContentType=function(a){};if("undefined"!==typeof XMLHttpRequest){var c=new XMLHttpRequest;if("withCredentials"in c)return new a(c)}if("undefined"!==typeof XDomainRequest)return new b(new XDomainRequest);if("undefined"!==typeof flensed.flXHR)return new a(new flensed.flXHR({instancePooling:!0}));throw Error("no cross-origin mechanism available");};n.prototype.execute=function(a,b,c){(function(d){var e;try{e=n.createXHR(),e.open("POST",d.endpoint),e.setContentType("text/xml")}catch(f){throw c(f),
f;}e.onload=function(){var a=e.responseXML,d;if(a){try{d=p.decodeResponse(a)}catch(f){D("XmlRpcClient.prototype.execute wrong XML response");c&&c(f);return}d instanceof p.Fault?(D("XmlRpcClient.prototype.execute  XmlRpc.Fault"),c&&c(d)):(g=!1,Out.debug("noHub = false XmlRpcClient.prototype.execute"),b&&b(d))}else D("XmlRpcClient.prototype.execute no XML response"),c&&c("no XML response")};e.onerror=function(a){a?a.toString=function(){return"No hub?"}:a="No hub";c&&c(a)};e.send(a.toXml());return e})(this)};
var q=function(a){this.regInfo=a;this.privateKey=a["samp.private-key"];if("string"===!typeof this.privateKey)throw Error("Bad registration object");this.xClient=new n};(function(){var a={call:[TYPE_STRING,TYPE_STRING,TYPE_MAP],callAll:[TYPE_STRING,TYPE_MAP],callAndWait:[TYPE_STRING,TYPE_MAP,TYPE_STRING],declareMetadata:[TYPE_MAP],declareSubscriptions:[TYPE_MAP],getMetadata:[TYPE_STRING],getRegisteredClients:[],getSubscribedClients:[TYPE_STRING],getSubscriptions:[TYPE_STRING],notify:[TYPE_STRING,TYPE_MAP],
notifyAll:[TYPE_MAP],ping:[],reply:[TYPE_STRING,TYPE_MAP]},b;for(b in a)(function(a,b){q.prototype[a]=function(c,d,e){var f=function(a){return function(){a.close()}}(this);e=e||f;p.checkParams(c,b);f=new u("samp.webhub."+a);f.addParam(this.privateKey);f.addParams(c);return this.xClient.execute(f,d,e)}})(b,a[b])})();q.prototype.unregister=function(){if(this.callbackRequest)try{this.callbackRequest.abort()}catch(a){}var b=new u("samp.webhub.unregister");b.addParam(this.privateKey);try{this.xClient.execute(b)}catch(c){}delete this.regInfo;
delete this.privateKey};q.prototype.close=function(){if(!this.closed){this.closed=!0;try{this.regInfo&&this.unregister()}catch(a){}if(this.onclose){oc=this.onclose;delete this.onclose;try{oc()}catch(b){}}}};q.prototype.setCallable=function(a,b){if(this.callbackRequest)try{this.callbackRequest.abort()}catch(c){}finally{delete this.callbackRequest}if(a||this.regInfo){var d=new u("samp.webhub.allowReverseCallbacks");d.addParam(this.privateKey);d.addParam(a?"1":"0");var e=function(a){return function(){a.close()}}(this);
a?function(c){var f,g=function(b){if(h(b)!=TYPE_LIST)m(Error("pullCallbacks result not List"));else{var c;for(c=0;c<b.length;c++)try{var d=b[c],e=d["samp.methodName"],f=d["samp.params"],g=void 0;"receiveNotification"===e?g=a.receiveNotification:"receiveCall"===e?g=a.receiveCall:"receiveResponse"===e&&(g=a.receiveResponse);g&&g.apply(a,f)}catch(p){}r()}},m=function(a){1E3>(new Date).getTime()-f?c.close():r()},r=function(){if(c.regInfo){var a=new u("samp.webhub.pullCallbacks");a.addParam(c.privateKey);
a.addParam("600");f=(new Date).getTime();c.callbackRequest=c.xClient.execute(a,g,m)}};c.xClient.execute(d,function(){r();b()},e)}(this):this.xClient.execute(d,b,e)}};q.prototype.translateUrl=function(a){return(this.regInfo["samp.url-translator"]||"")+a};q.Action=function(a,b,c){this.actName=a;this.actArgs=b;this.resultKey=c};a=function(a){this.callHandler={};this.replyHandler={}};a.prototype.init=function(a){};a.prototype.receiveNotification=function(a,b){var c=b["samp.mtype"],d=!1;if(c in this.callHandler){try{this.callHandler[c](a,
b,!1)}catch(e){}d=!0}return d};a.prototype.receiveCall=function(a,b,c){var d=c["samp.mtype"],e=!1,f,g;if(d in this.callHandler)try{g=this.callHandler[d](a,c,!0)||{},f={"samp.status":"samp.ok","samp.result":g},e=!0}catch(h){f={"samp.status":"samp.error","samp.error":{"samp.errortxt":h.toString()}}}else f={"samp.status":"samp.warning","samp.result":{},"samp.error":{"samp.errortxt":"no action"}};this.connection.reply([b,f]);return e};a.prototype.receiveResponse=function(a,b,c){var d=!1;if(b in this.replyHandler)try{this.replyHandler[b](a,
b,c),d=!0}catch(e){}return d};a.prototype.calculateSubscriptions=function(){var a={},b;for(b in this.callHandler)a[b]={};return a};b=function(){var a=this;this.ids={};this.metas={};this.subs={};this.replyHandler={};this.callHandler={"samp.hub.event.shutdown":function(b,c){a.connection.close()},"samp.hub.disconnect":function(b,c){a.connection.close()},"samp.hub.event.register":function(b,c){var d=c["samp.params"].id;a.ids[d]=!0;a.changed(d,"register",null)},"samp.hub.event.unregister":function(b,c){var d=
c["samp.params"].id;delete a.ids[d];delete a.metas[d];delete a.subs[d];a.changed(d,"unregister",null)},"samp.hub.event.metadata":function(b,c){var d=c["samp.params"].id,e=c["samp.params"].metadata;a.metas[d]=e;a.changed(d,"meta",e)},"samp.hub.event.subscriptions":function(b,c){var d=c["samp.params"].id,e=c["samp.params"].subscriptions;a.subs[d]=e;a.changed(d,"subs",e)}}};b.prototype=function(a){function b(){}b.prototype=a;return new b}(a.prototype);b.prototype.changed=function(a,b,c){if(this.onchange)this.onchange(a,
b,c)};b.prototype.init=function(a){var b=this;this.connection=a;var c=function(c,d,e,f){a[e]([c],function(a){f[c]=a;b.changed(c,d,a)})};a.getRegisteredClients([],function(a){var d,e;b.ids={};for(d=0;d<a.length;d++)e=a[d],b.ids[e]=!0,c(e,"meta","getMetadata",b.metas),c(e,"subs","getSubscriptions",b.subs);b.changed(null,"ids",null)})};b.prototype.getName=function(a){var b=this.metas[a];return b&&b["samp.name"]?b["samp.name"]:"["+a+"]"};c=function(a,b,c,d){this.name=a;this.meta=b;this.callableClient=
c;this.subs=d;this.regTextNodes=[];this.whenRegs=[];this.whenUnregs=[];this.onunreg=this.onreg=this.connection=void 0};var v=function(a,b){Out.info(b);var c,d=a.regTextNodes,e;for(c=0;c<d.length;c++)e=d[c],e.innerHTML="",e.appendChild(document.createTextNode(b))};c.prototype.setConnection=function(a){var b=this;if(this.connection&&(this.connection.close(),this.onunreg))try{this.onunreg()}catch(c){}if(this.connection=a)if(a.onclose=function(){b.connection=null;if(b.onunreg)try{b.onunreg()}catch(a){}b.update()},
this.meta&&a.declareMetadata([this.meta]),this.callableClient&&(this.callableClient.init&&this.callableClient.init(a),a.setCallable(this.callableClient,function(){a.declareSubscriptions([b.subs])})),this.onreg)try{this.onreg(a)}catch(d){}this.update()};c.prototype.register=function(){var a=this;w(this.name,function(b){a.setConnection(b);v(a,b?"Yes":"No");Out.debug("noHub = false Connector.prototype.register");g=!1},function(b){v(a,"no ("+b.toString()+")");D("Connector: no ("+b.toString()+")")})};
c.prototype.unregister=function(){this.connection&&(this.connection.unregister([]),this.setConnection(null))};c.prototype.createRegButtons=function(){var a=this,b=document.createElement("button");b.setAttribute("type","button");b.appendChild(document.createTextNode("Register"));b.onclick=function(){a.register()};this.whenUnregs.push(b);var c=document.createElement("button");c.setAttribute("type","button");c.appendChild(document.createTextNode("Unregister"));c.onclick=function(){a.unregister()};this.whenRegs.push(c);
var d=document.createElement("span");this.regTextNodes.push(d);var e=document.createDocumentFragment();e.appendChild(b);e.appendChild(document.createTextNode(" "));e.appendChild(c);b=document.createElement("span");b.innerHTML=" <strong>Registered: </strong>";e.appendChild(b);e.appendChild(d);this.update();return e};c.prototype.update=function(){var a,b=(a=!!this.connection)?this.whenRegs:this.whenUnregs,c=a?this.whenUnregs:this.whenRegs;for(a=0;a<b.length;a++)b[a].removeAttribute("disabled");for(a=
0;a<c.length;a++)c[a].setAttribute("disabled","disabled");v(this,"No")};c.prototype.runWithConnection=function(a,b){var c=this,d=function(b){c.setConnection(b);a(b)},e=function(a){c.setConnection(void 0);b(a)},f=function(b){a(c.connection)},g=function(a){w(this.name,d,e)};this.connection?this.connection.getRegisteredClients([],f,g):w(this.name,d,e)};c.prototype.onHubAvailability=function(a,b){samp.ping(a);return setInterval(function(){samp.ping(a)},b)};var w=function(a,b,c){var d=new n,e=new u("samp.webhub.register");
e.addParam({"samp.name":a});e.checkParams([TYPE_MAP]);g=!1;d.execute(e,function(a){var d;try{d=new q(a,1E3)}catch(e){c(e);return}b(d)},c)},s=new b;s.callHandler["samp.app.ping"]=function(a,b,c){if(c)return{text:"ping to you, "+s.getName(a)}};s.onchange=function(a,b,c){C(a,b,c)};f=s.calculateSubscriptions();logCc={receiveNotification:function(a,b){var c=s.receiveNotification(a,b);logCallback("notification: "+b["samp.mtype"]+" from "+s.getName(a),c)},receiveCall:function(a,b,c){b=s.receiveCall(a,b,
c);logCallback("call: "+c["samp.mtype"]+" from "+s.getName(a),b)},receiveResponse:function(a,b,c){c=s.receiveResponse(a,b,c);logCallback("response: "+b+" from "+s.getName(a),c)},init:function(a){s.init(a)}};var x=new c(e["samp.name"],e,logCc,f);x.onunreg=function(){document.getElementById("clientList").innerHTML=""};var C=function(a,b,c){d.controlTrackerReply(a,b,c)},D=function(a){g=!0;Out.debug("notifyHubError :"+a);d.controlHubError(a)},e={};e.XmlRpcRequest=u;e.XmlRpcClient=n;e.Message=function(a,
b){this["samp.mtype"]=a;this["samp.params"]=b};e.TYPE_STRING=TYPE_STRING;e.TYPE_LIST=TYPE_LIST;e.TYPE_MAP=TYPE_MAP;e.connector=x;e.isSubscribed=function(a,b){for(var c in a){var d;a:if(d=b,c==d||"*"===c)d=!0;else{var e=void 0;if(e=/^(.*)\.\*$/.exec(c))if(e=e[1],e===d.substring(0,e.length)){d=!0;break a}d=!1}if(d)return!0}return!1};e.Connector=c;e.CallableClient=a;e.ClientTracker=b;e.addListener=function(a){d=a};e.registerToHub=function(){x.connection?Out.info("Attempt to connect, but already connected"):
g&&x.register();return{HubRunning:!g}};e.unregisterToHub=function(){x.unregister();setTimeout(function(){g=!0},2E3)};e.isConnected=function(){return x.connection?!0:!1};e.notifyTrackerReply=C;e.notifyHubError=D;e.sendMessageToClient=function(a,b){null==a||a.match(/any/i)?x.connection.notifyAll([b]):x.connection.notify([a,b])};return e};console.log("=============== >  WebSamp_m.js ");
WebSamp_mVc=function(){Out.debugModeOn();var a=null,b="http://"+window.location.hostname+(location.port?":"+location.port:"")+"/"+window.location.pathname.split("/")[1]+"/",c={},d=[];d.topcat={webStartUrl:"http://www.star.bris.ac.uk/~mbt/topcat/topcat-full.jnlp",iconUrl:"http://www.star.bris.ac.uk/~mbt/topcat/images/tc_sok.png",webUrl:"http://www.star.bris.ac.uk/~mbt/topcat/",description:"Tool for Operations on Catalogues And Tables"};d.aladin={webStartUrl:"http://aladin.u-strasbg.fr/java/nph-aladin.pl?frame=get&id=aladin.jnlp",
iconUrl:"http://aladin.u-strasbg.fr/aladin_large.gif",webUrl:"http://aladin.u-strasbg.fr/",description:"The Aladin sky atlas and VO Portal"};d.cassis={webStartUrl:"http://cassis.irap.omp.eu/online/cassis.jnlp",iconUrl:"http://saada.unistra.fr/taphandle/images/cassis.png",webUrl:"http://cassis.irap.omp.eu/",description:"CASSIS is able to retrieve some useful informations for the modeling or identification from databases"};var e=!1,f=!1,g={},h=0,l=Date.now(),m=RegExp(/no\s+hub/i),r=function(a){return $("#sampModalIdContainer #sampModalId"+
a)},p=function(a){r("ItemList").append("<li>"+a+"</li>")},u=function(){!1==f&&(f=!0);0!=h&&Modalinfo.dataPanel("Samp Info",r("").html(),function(){WebSamp_mVc.fireCloseModal()})},n=function(){$("#sampIndicator").attr("class","sampOff")},q=function(){$("#sampIndicator").attr("class","sampOn")},v=function(a){Out.debug("showClientList");Processing.hide();r("Title ").text("Available SAMP Clients");r("Help").html("Below is the list of SAMP clients accepting data<br>\n- Click on the icon of the client you want to send data.<BR>- Click on the broadcast icon if you want your data to be sent to all clients.");
r("PostHelp").html("");r("ItemList").empty();a="oid"==g.type?"WebSamp_mVc.fireSendFileToClient":"voreport"==g.type?"WebSamp_mVc.fireSendUrlToClient":"skyat"==g.type?"WebSamp_mVc.fireSendSkyatToClient":"script"==g.type?"WebSamp_mVc.fireSendAladinScript":"";var b=!1;for(ident in c)if(b=!0,c[ident].meta&&c[ident].subs){var d=c[ident].meta,e=""==a?"Modalinfo.info(&quot;No message to send&quot;);":a+'("'+ident+'");';"Cassis"==d["samp.name"]?(d["samp.icon.url"]="http://saada.unistra.fr/taphandle/images/cassis.png",
d["home.page"]="http://cassis.irap.omp.eu/"):"splat"==d["samp.name"]&&(d["home.page"]="http://star-www.dur.ac.uk/~pdraper/splat/index.html");p("<img class=clickableicon align=bottom style='height: 32px; border: 0px;' src='"+d["samp.icon.url"]+"' onclick='"+e+"'><span class=help> <b>"+d["samp.name"]+"</b> "+d["samp.description.text"]+" </span><a style='font-color: blue; font-size: small; font-style: italic;' target=_blank href='"+d["home.page"]+"'>read more...</a>")}b?(p("<a class=sampOn  onclick='"+
a+"(null);'></a><span class=help> <b>Broadcast</b> to any client"),u()):(s(),Modalinfo.info("No SAMP Clients Available: Is your Hub still running?"),y()&&n())},w=function(){e=!a.controlRegisterToHub().HubRunning},s=function(){f&&(e=f=!1,h=0,Modalinfo.close())},x=function(c){h=2;var d;d=g.param;d=d.match(/https?:\/\//)?d:b+"/"+g.param;var e={},f;f=null==g.name?g.param.match(/.*\.fit.*/i)?"table.load.fits":"table.load.votable":g.name;e["samp.mtype"]=null==g.mtype?"table.load.votable":g.mtype;e["samp.params"]=
{"table-id":f,url:d,name:f};Processing.showAndHide("URL sent to SAMP "+JSON.stringify(e).replace(/,/g,",<br>"));a.controlSendUrlToClient(c,e);s()},C=function(b){h=2;Out.info("Send SkyAt to Client "+b);var c={"samp.mtype":"coord.pointAt.sky"};c["samp.params"]={ra:String(g.param.ra),dec:String(g.param.dec)};Processing.showAndHide("Sky position sent to SAMP");a.controlSkyatToClient(b,c);s()},D=function(){y()?(Out.debug("unregister"),a.controlUnregisterToHub(),n()):Modalinfo.info("Not registered")},y=
function(){var b=a.controlIsConnected();b?q():n();return b},B={init:function(a,b,c){$(document.body).append('<div id=sampModalIdContainer><div id=sampModalId style=\'width: 99%; display: none;\'><a id="sampModalIdIcon" class="ivoalogo"></a><span id=sampModalIdTitle style="display: inline; font-size: 1.5em;font-weight: bold;"> TITLE</span><BR><div><ul id=sampClientListItems></ul></div><span id=sampModalIdHelp class=help></span><ul id=sampModalIdItemList></ul><span id=sampModalIdPostHelp class=help></span></div></div>');
new WebSamp_mvC(WebSamp_mVc,new WebSamp_Mvc(a,b,c))}};B.fireCloseModal=s;B.fireSendOid=function(a,b,d){Out.info("Send OID "+a);h=2;g={type:"oid",param:a};if(y()){for(ident in c){v();return}v()}else w()};B.fireSendFileToClient=function(c){h=2;var d=g.param,e=b+"download?oid="+d,f="getproductinfo?url="+encodeURIComponent(e);$.getJSON(f,function(b){var f=b.ContentType,g=b.ContentDisposition,g=/.*filename=(.*)$/.exec(b.ContentDisposition),g=null==g?"3XMMDataFile":g[1].replace(/"/g,""),f=f.match(/fits/i)?
"table.load.fits":"table.load.votable";b={};b["samp.mtype"]=f;b["samp.params"]={"table-id":d,url:e,name:g};Processing.showAndHide("File sent to SAMP "+JSON.stringify(b));a.controlSendFileToClient(c,b);s()})};B.fireSendVoreport=function(a,b,d){h=2;g={type:"voreport",param:a,mtype:null==b?null:b,name:null==d?null:d};Out.info("Send report"+JSON.stringify(g));if(y()){a=0;for(ident in c)a++;1<a?v():x(null)}else w()};B.fireSendUrlToClient=x;B.fireSendAladinScript=function(b){if(y()){g={type:"script",param:b};
h=2;var c={"samp.mtype":"script.aladin.send"};c["samp.params"]={script:b};Processing.showAndHide("Script sent to Aladin "+JSON.stringify(c));a.controlSendFileToClient(null,c);s()}else w()};B.fireSendSkyat=function(a,b){h=2;Out.info("Send SkyAt "+a+" "+b);g={type:"skyat",param:{ra:a,dec:b}};if(y()){var d=0;for(ident in c)d++;1<d?v():C(null)}else w()};B.fireSendSkyatToClient=C;B.fireRegisterToHubAttempt=function(){var a=Date.now();2E3>a-l||(0!=h&&e&&f?(Out.debug("attempt "+e),w(),l=a,setTimeout("WebSamp_mVc.fireRegisterToHubAttempt();",
2E3)):(e=!1,1==h&&s()))};B.fireUnregister=D;B.fireJustConnect=function(){h=1;y()?D():w()};B.fireIsConnected=y;B.fireIsHubRunning=function(){a.controlIsHubRunning()};B.showTrackerReply=function(a,b,d){Out.debugModeOn();Out.debug("showTrackerReply "+a+" "+b);Out.debug("data : "+JSON.stringify(d));e=!1;q();var f="",g="";a&&!a.match(/hub/i)&&("unregister"==b?c[a]&&(delete c[a],f=a):(c[a]||(Out.debug("new client, id : "+a),c[a]={}),"meta"==b?c[a].meta=d:"subs"==b&&(Out.debug("try to sub client "+d["samp.name"]),
d["table.load.fits"]&&d["table.load.votable"]?(c[a].subs=d,Out.debug("sub successful")):(delete c[a],Out.debug("sub fail"))),c[a]&&c[a].meta&&c[a].subs&&(g=a)),2!=h||""==f&&""==g||v())};B.showHubError=function(a){Out.debug("showHubError "+a+" "+m.test(a));if(!1!=m.test(a)){e=!0;n();Processing.hide();Out.debug("showHupLauncher");Processing.hide();r("Title ").text("No running SAMP hub detected");r("Help").html('You need to start a hub before to export data towards VO clients<br> \nYou can either run it by hand or by clicking on one icon below.<br>If the applcation doesn\'t start, make sure that Java <a target="_blank" href="http://www.java.com/fr/download/faq/java_webstart.xml">Web Start</a> is properly installed on your machine.');
r("PostHelp").html('IMPORTANT: Once the hub is running, click on the <span style="diplay: inline-block;width: 23px"><a href="#" class="dlivoalogo"></a>icon</span>  again to send data\n');r("ItemList").empty();for(var b in d)a=d[b],p("<a href='#' onclick=WebSamp_mVc.fireLaunchHub('"+b+"','"+a.webStartUrl+"');><img class=clickableicon align=middle style='height: 32px; border: 0ps;' src='"+a.iconUrl+"'></a><span class=help> <b>"+b+"</b> "+a.description+" </span><a style='font-color: blue; font-size: small; font-style: italic;' target=_blank href='"+
a.webUrl+"'>read more...</a>");u();setTimeout(WebSamp_mVc.fireRegisterToHubAttempt,2E3)}};B.fireLaunchHub=function(a,b){Processing.show("Talking with the HUB");PageLocation.changeLocation(b);Processing.hide()};B.addListener=function(b){a=b};return B}();console.log("=============== >  WebSamp_v.js ");
WebSamp_mvC=function(a,b){a.addListener({controlIsConnected:function(){return b.isConnected()},controlRegisterToHub:function(){return b.registerToHub()},controlUnregisterToHub:function(){return b.unregisterToHub()},controlIsHubRunning:function(){b.isHubRunning()},controlSendFileToClient:function(a,d){b.sendMessageToClient(a,d)},controlSendUrlToClient:function(a,d){b.sendMessageToClient(a,d)},controlSkyatToClient:function(a,d){b.sendMessageToClient(a,d)}});b.addListener({controlTrackerReply:function(b,
d,e){a.showTrackerReply(b,d,e)},controlHubError:function(b){a.showHubError(b)},isInit:function(b){a.displayTable(b)}})};console.log("=============== >  WebSamp_c.js ");function KWSimpleConstraint_Mvc(a){this.listener=null;this.operators=[];this.range={type:"not set",values:[]};this.andors=[];this.attributeHandler=a.attributeHandler;this.editorModel=a.editorModel;this.defaultValue=a.defValue;this.isFirst=a.isFirst;this.andor=this.operand=this.operator="";this.booleansupported=!1}
KWSimpleConstraint_Mvc.prototype={addListener:function(a){this.listener=a},processEnterEvent:function(){null!=this.editorModel&&this.editorModel.updateQuery()},processRemoveConstRef:function(a){null!=this.editorModel&&this.editorModel.processRemoveConstRef(a)},removeAndOr:function(){this.andor=""},notifyInitDone:function(){this.listener.isInit(this.attributeHandler,this.operators,this.andors,this.range,this.defaultValue)},notifyTypoMsg:function(a,b){this.fault=a;this.listener.notifyFault(a);null!=
this.editorModel&&this.editorModel.notifyTypoMsg(a,b)},notifyRunQuery:function(){null!=this.editorModel&&this.editorModel.notifyRunQuery()},getADQL:function(a){return this.listener.controlAhName(this.attributeHandler)},getAttributeHandler:function(){return this.attributeHandler},processRemoveFirstAndOr:function(a){void 0!=this.attributeHandle&&"orderby"==this.attributeHandler.type||null==this.editorModel||this.editorModel.processRemoveFirstAndOr(a)},isString:function(){return null!=this.attributeHandler.type?
this.attributeHandler.type.match(/(string)|(text)|(varchar)|char/i):!1}};function TapKWSimpleConstraint_Mvc(a){KWSimpleConstraint_Mvc.call(this,a)}TapKWSimpleConstraint_Mvc.prototype=Object.create(KWSimpleConstraint_Mvc.prototype,{getADQL:{value:function(){return this.listener.controlAhName(this.attributeHandler).quotedTableName().qualifiedName}}});
function KWConstraint_Mvc(a){KWSimpleConstraint_Mvc.call(this,a);this.fault=0;null!=this.attributeHandler.nameattr&&("Cardinality"==this.attributeHandler.nameattr||this.attributeHandler.nameattr.startsWith("Qualifier ")||this.attributeHandler.nameorg.startsWith("Qualifier "))?(this.operators="= != > < ][ ]=[ [] [=]".split(" "),this.andors=[]):"Select"==this.attributeHandler.type?(this.operators=[],this.andors=[]):("ADQLPos"==this.attributeHandler.type?this.operators=["inCircle","inBox"]:"boolean"==
this.attributeHandler.type?this.operators=["=","IS NOT NULL","IS NULL"]:this.isString()?this.operators="=;!=;LIKE;NOT LIKE;IS NOT NULL;IS NULL".split(";"):this.operators="=;!=;>;<;between;IS NOT NULL;IS NULL".split(";"),this.andors=["AND","OR"]);!0==this.isFirst&&(this.andors=[]);"orderby"==this.attributeHandler.type&&(this.operators=[],this.andors=[]);if(null!=this.attributeHandler.range)if(this.range.type="list",void 0!=this.attributeHandler.range.values)if(0<this.attributeHandler.range.values.length)for(a=
0;a<this.attributeHandler.range.values.length;a++){var b={value:this.attributeHandler.range.values[a]};this.range.values[this.range.values.length]=b}else b={value:this.attributeHandler.range.values},this.range.values[this.range.values.length]=b;else this.range.type="range",void 0!=this.attributeHandler.range.min&&(b={value:"min "+this.attributeHandler.range.min},this.range.values[this.range.values.length]=b),void 0!=this.attributeHandler.range.max&&(b={value:"max "+this.attributeHandler.range.max},
this.range.values[this.range.values.length]=b)}
KWConstraint_Mvc.prototype=Object.create(KWSimpleConstraint_Mvc.prototype,{processEnterEvent:{value:function(a,b,c,d){this.andor=a;if("orderby"!=this.attributeHandler.type){if(this.isString()){if(!this.checkAndFormatString(b,c)){this.editorModel.updateQuery();return}}else if("boolean"==this.attributeHandler.type){if(!this.checkAndFormatString(b,c)){this.editorModel.updateQuery();return}}else if(!this.checkAndFormatNum(b,c)){this.editorModel.updateQuery();return}this.notifyTypoMsg(0,this.operator+
" "+this.operand);0==this.andors.length&&this.processRemoveFirstAndOr()}this.editorModel.updateQuery()}},checkAndFormatNum:{value:function(a,b){if(null==a||0==a.length)return this.operand=this.operator="",1;if("IS NULL"==a)return this.operator="IS NULL",this.operand="",1;if(/^\s*$/.test(b)){if("Cardinality"==this.attributeHandler.nameattr||this.attributeHandler.nameattr.startsWith("Qualifier ")||this.attributeHandler.nameorg.startsWith("Qualifier "))return this.notifyTypoMsg(1,"Numeric operand required"),
0;this.operator="IS NOT NULL";this.operand="";return 1}if("between"==a){var c=b.split(" ");if(3!=c.length||!/and/i.test(c[1])||0==c[0].length||0==c[2].length||isNaN(c[0])||isNaN(c[2]))return this.notifyTypoMsg(1,'Operator "'+a+'" requires an operand of form "num1 and num2"'),0;this.operator=a;this.operand=c[0]+" AND "+c[2];return 1}if("inCircle"==a||"inBox"==a){c=null;if(this.attributeHandler.nameattr.startsWith("POSLIST:"))var c=b.split(","),d=this.attributeHandler.nameattr.replace("POSLIST:","TAP_UPLOAD."),
c=[d+".pos_ra_csa",d+".pos_dec_csa",c[c.length-1]];else if(c=b.split(","),3!=c.length||isNaN(c[0])||isNaN(c[1]))return this.notifyTypoMsg(1,'Search area must be like :alpha,delta,size"'),0;if(isNaN(c[2]))return this.notifyTypoMsg(1,'Search area must be like :alpha,delta,size"'),0;this.operator="inCircle"==a?"CIRCLE('ICRS', "+c[0]+", "+c[1]+", "+c[2]/60+")":"BOX('ICRS', "+c[0]+", "+c[1]+", "+c[2]+", "+c[2]/60+")";this.operand="";return 1}if(isNaN(b)&&"boolean"!=this.attributeHandler.type)return this.notifyTypoMsg(1,
'Operator "'+a+'" requires a single numeric operand'),0;this.operator=a;this.operand=b;return 1}},checkAndFormatString:{value:function(a,b){"IS NULL"==a?(this.operator="IS NULL",this.operand=""):/^\s*$/.test(b)?(this.operator="IS NOT NULL",this.operand=""):(/^\s*'.*'\s*$/.test(b)?this.operand=b:this.operand="'"+b+"'",this.operator=a);return 1}},processRemoveConstRef:{value:function(a){this.editorModel.processRemoveConstRef(a)}},removeAndOr:{value:function(){this.andor=""}},getADQL:{value:function(a){if(this.fault)return null;
if(this.attributeHandler.nameattr.startsWith("Qualifier "))return"Qualifier{ "+this.attributeHandler.nameattr.split(" ")[1]+this.operator+" "+this.operand+"}";if(this.operator.startsWith("CIRCLE")||this.operator.startsWith("BOX")){a=this.attributeHandler.description.split(" ");var b=this.booleansupported?"'true'":"1";return this.andor+" CONTAINS(POINT('ICRS', "+a[0].quotedTableName().qualifiedName+", "+a[1].quotedTableName().qualifiedName+"), "+this.operator+") = "+b}return a?this.andor+' "'+this.listener.controlAhName(this.attributeHandler)+
'" '+this.operator+" "+this.operand:this.andor+" "+this.listener.controlAhName(this.attributeHandler)+" "+this.operator+" "+this.operand}}});function TapKWConstraint_Mvc(a){KWConstraint_Mvc.call(this,a)}
TapKWConstraint_Mvc.prototype=Object.create(KWConstraint_Mvc.prototype,{getADQL:{value:function(a){if(this.fault)return null;if(this.operator.startsWith("CIRCLE")||this.operator.startsWith("BOX")){a=this.attributeHandler.description.split(" ");var b=this.booleansupported?"'true'":"1";return this.andor+" CONTAINS(POINT('ICRS', "+a[0].quotedTableName().qualifiedName+", "+a[1].quotedTableName().qualifiedName+"), "+this.operator+") = "+b}return a?this.andor+' "'+this.listener.controlAhName(this.attributeHandler).quotedTableName().qualifiedName+
'" '+this.operator+" "+this.operand:this.andor+" "+this.listener.controlAhName(this.attributeHandler).quotedTableName().qualifiedName+" "+this.operator+" "+this.operand}}});function UCDConstraint_Mvc(a){KWConstraint_Mvc.call(this,a);this.operators="= != > < ][ ]=[ [] [=]".split(" ");this.unit=""}
UCDConstraint_Mvc.prototype=Object.create(KWConstraint_Mvc.prototype,{getADQL:{value:function(a){return this.fault?null:"["+this.attributeHandler.ucd+"] "+this.operator+" "+this.operand+" "+this.unit}},processEnterEvent:{value:function(a,b,c,d){this.andor="AND";this.unit=null==d||""==d?"":"["+d+"]";if(""==c)this.notifyTypoMsg(1,"Operand is required with UCDs");else{if("]["==b||"]=["==b||"[]"==b||"[=]"==b)if(this.operator=b,a=c.match(/^((?:[^\s]+)|(?:'.*'))\s+and\s+((?:[^\s]+)|(?:'.*'))$/),null!=a)b=
a[1],a=a[2],b=isNaN(b)&&!/^\s*'.*'\s*$/.test(b)?"'"+b+"'":b,a=isNaN(a)&&!/^\s*'.*'\s*$/.test(a)?"'"+a+"'":a,this.operand="("+b+" , "+a+")";else{this.notifyTypoMsg(1,"The operator "+b+' requires an operand like "num1 and num2"');this.editorModel.updateQuery();return}else this.operator=b,this.operand=b=isNaN(c)&&!/^\s*'.*'\s*$/.test(c)?"'"+c+"'":c;this.notifyTypoMsg(0,this.operator+" "+this.operand+" ["+d+"]");0==this.andors.length&&this.processRemoveFirstAndOr()}this.editorModel.updateQuery()}}});
function PosConstraint_Mvc(a){KWConstraint_Mvc.call(this,a);this.operators=[]}
PosConstraint_Mvc.prototype=Object.create(KWConstraint_Mvc.prototype,{processEnterEvent:{value:function(a,b,c){this.andor="AND";if(""==c)this.operator="IS NOT NULL";else if("]["==b||"]=["==b||"[]"==b||"[=]"==b)if(this.operator=b,a=c.match(/^((?:[^\s]+)|(?:'.*'))\s+and\s+((?:[^\s]+)|(?:'.*'))$/),null!=a)b=a[1],a=a[2],b=isNaN(b)&&!/^\s*'.*'\s*$/.test(b)?"'"+b+"'":b,a=isNaN(a)&&!/^\s*'.*'\s*$/.test(a)?"'"+a+"'":a,this.operand="("+b+" , "+a+")";else{this.notifyTypoMsg(1,"Operator "+b+' requires an operand like "num1 and num2"');
this.editorModel.updateQuery();return}else this.operator=b,this.operand=b=isNaN(c)&&!/^\s*'.*'\s*$/.test(c)?"'"+c+"'":c;b=this.getADQL();b=48<b.length?b.substring(0,47)+"...":b;this.notifyTypoMsg(0,b);0==this.andors.length&&this.processRemoveFirstAndOr();this.editorModel.updateQuery()}},getADQL:{value:function(){return this.fault?null:"region"==this.attributeHandler.nameattr?'isInRegion("'+this.attributeHandler.value+'", 0, '+("FK5"==this.attributeHandler.frame?"J2000":"FK4"==this.attributeHandler.frame?
"J1950":"-")+", "+this.attributeHandler.frame+")":'isInCircle("'+this.attributeHandler.nameorg+'", '+this.attributeHandler.radius+", "+("FK5"==this.attributeHandler.frame?"J2000":"FK4"==this.attributeHandler.frame?"J1950":"-")+", "+this.attributeHandler.frame+")"}}});function CatalogueConstraint_Mvc(a){KWConstraint_Mvc.call(this,a);this.qualifier=a.qualifier;this.operators=[">","<","][","[]"]}
CatalogueConstraint_Mvc.prototype=Object.create(KWConstraint_Mvc.prototype,{getADQL:{value:function(a){if(this.fault)return null;a="   AssObjClass{"+this.attributeHandler.CLASSNAME+"}";""!=this.operand&&(a+=", Qualifier{"+this.qualifier+" "+this.operator+" "+this.operand+"}");return a}},processEnterEvent:{value:function(a,b,c,d){void 0==a&&void 0==b&&void 0==c&&this.editorModel.updateQuery();this.andor="AND";this.unit=null==d||""==d?"":"["+d+"]";if(""==c)this.notifyTypoMsg(0,"at any distance");else if("]["==
b||"[]"==b)if(this.operator=b,a=c.match(/^\s*([^\s]+)\s+and\s+([^\s]+)\s*$/),null!=a){b=a[1];a=a[2];if(isNaN(b)||isNaN(b)){this.notifyTypoMsg(1,"Distance requires a single operands");return}this.operand="("+b+" , "+a+")";this.notifyTypoMsg(0,this.operator+" "+this.operand)}else{this.notifyTypoMsg(1,"The operator "+b+' requires an operand like "num1 and num2"');return}else{if(isNaN(c)){this.notifyTypoMsg(1,"Distance requires a single numeric operand");return}this.operator=b;this.operand=c;this.notifyTypoMsg(0,
this.operator+" "+this.operand)}this.editorModel.updateQuery()}}});function CrossidConstraint_Mvc(a){CatalogueConstraint_Mvc.call(this,a)}
CrossidConstraint_Mvc.prototype=Object.create(CatalogueConstraint_Mvc.prototype,{processEnterEvent:{value:function(a,b,c,d){void 0==a&&void 0==b&&void 0==c&&this.editorModel.updateQuery();this.andor="AND";this.unit=null==d||""==d?"":"["+d+"]";if(""==c)this.notifyTypoMsg(0,"with any probality");else if("]["==b||"[]"==b)if(this.operator=b,a=c.match(/^\s*([^\s]+)\s+and\s+([^\s]+)\s*$/),null!=a){b=a[1];a=a[2];if(isNaN(b)||isNaN(b)){this.notifyTypoMsg(1,"Distance requires a single operands");return}if(0>
b||1<b||0>a||1<a){this.notifyTypoMsg(1,"Probability must be between 0 and 1");return}this.operand="("+b+" , "+a+")";this.notifyTypoMsg(0,this.operator+" "+this.operand)}else{this.notifyTypoMsg(1,"The operator "+b+' requires an operand like "num1 and num2"');return}else{if(isNaN(c)){this.notifyTypoMsg(1,"Probability requires a single numeric operand between 0 and 1");return}if(0>c||1<c){this.notifyTypoMsg(1,"Probability must be between 0 and 1");return}this.operator=b;this.operand=c;this.notifyTypoMsg(0,
this.operator+" "+this.operand)}this.editorModel.updateQuery()}}});console.log("=============== >  KWConstraint_m.js ");function KWSimpleConstraint_mVc(a){this.rootId=a.divId;this.constListId=a.constListId;this.treePath=a.treePath;this.fieldName="";this.defValue=a.defValue;this.name=a.name;void 0==this.name&&void 0!=a.attributeHandler&&(this.name=a.attributeHandler.nameattr);this.listener=null;new KWConstraint_mvC(new KWSimpleConstraint_Mvc(a),this)}
KWSimpleConstraint_mVc.prototype={addListener:function(a){this.listener=a},fireInit:function(){this.initForm()},initForm:function(a,b,c,d,e){var f=this;$("#"+this.constListId).append("<div class='kwConstraint' id="+this.rootId+" style='overflow: hidden;'>");var g=$("#"+this.constListId+' div[id="'+this.rootId+'"]');g.append('&nbsp;<a id="'+this.rootId+'_close" href="javascript:void(0);" class=closekw title="Remove this Constraint"></a>&nbsp;');g.append('<span style="cursor: pointer;" id="'+this.rootId+
'_name" style="float: left;">'+this.name+"</span>&nbsp;");$("#"+this.rootId+" span").click(function(){Modalinfo.info(f.defValue,"Pattern statement")});(this.rootId.endsWith("_rafield")||this.rootId.endsWith("_decfield"))&&$(".kwConstraint#"+this.rootId).css("display","inline");$("#"+this.constListId).append("</div>");$("#"+this.constListId+' a[id="'+this.rootId+'_close"]').click(function(){g.remove();f.fireRemoveFirstAndOr(this.rootId);f.fireEnterEvent()});this.fireEnterEvent(null,null,null)},fireGetADQL:function(a){return this.listener.controlGetADQL(a)},
fireEnterEvent:function(a,b,c,d){var e=$("#"+this.constListId+' input[id="'+this.rootId+'_val"]');this.listener.controlEnterEvent(a,b,c,d);e.parents(".constdiv:first").find("span").each(function(){$(this).css("font-weight","normal")});e.prevAll("span[id$='_name']").css("font-weight","bold");"rgb(0, 128, 0)"===$("#"+this.constListId).closest("fieldset").next("div").find("span:last").css("color")&&$("#"+this.constListId).closest("fieldset").next("div").find("span:last").prepend(e.prevAll("span[id$='_name']").text()+
" ")},fireRemoveAndOr:function(){$("#"+this.rootId+"_andor").remove();this.listener.controlRemoveAndOr(this.rootId)},fireRemoveFirstAndOr:function(){this.listener.controlRemoveFirstAndOr(this.rootId)},getAttributeHandler:function(){return this.listener.controlGetAttributeHandler()},getAhName:function(a){var b="";return this.fieldName=b=void 0==this.treePath||a.nameattr.startsWith("POSLIST")?a.nameattr:this.treePath.schema+"."+this.treePath.table+"."+a.nameorg}};
function TapKWSimpleConstraint_mVc(a){KWSimpleConstraint_mVc.call(this,a);new KWConstraint_mvC(new TapKWSimpleConstraint_Mvc(a),this)}TapKWSimpleConstraint_mVc.prototype=Object.create(KWSimpleConstraint_mVc.prototype,{});function KWConstraint_mVc(a){KWSimpleConstraint_mVc.call(this,a);new KWConstraint_mvC(new KWConstraint_Mvc(a),this)}
KWConstraint_mVc.prototype=Object.create(KWSimpleConstraint_mVc.prototype,{fireInit:{value:function(){this.listener.controlInit()}},initForm:{value:function(a,b,c,d,e){var f=this;$("#"+this.constListId).append("<div class='kwConstraint' id="+this.rootId+" style='float: none;'>");var g=$("#"+this.constListId+' div[id="'+this.rootId+'"]');g.append('&nbsp;<a id="'+this.rootId+'_close" href="javascript:void(0);" class=closekw title="Remove this Constraint"></a>&nbsp;');if(0<c.length){for(var h='<select id="'+
this.rootId+'_andor" style="font-size: small;font-family: courier;">',l=0;l<c.length;l++)var m=c[l],h=h+("<option value="+m+">"+m+"</option>");g.append(h+"</select>&nbsp;")}g.append('<span id="'+this.rootId+'_name">'+this.getAhName(a)+"</span>&nbsp;");if(0<b.length){h='<select id="'+this.rootId+'_op" style="font-size: small;font-family: courier;">';for(l=0;l<b.length;l++)m=b[l],c="",">"==m?(m="&gt;","Cardinality"==a.nameattr&&(c="selected")):"<"==m&&(m="&lt;"),h+='<option value="'+m+'" '+c+">"+m+
"</option>";if(void 0!=d&&"list"==d.type)for(b=0;b<d.values.length;b++)l="String"==a.type?"'"+d.values[b].value+"'":d.values[b].value,h+='<option value="= '+l+'">= '+l+"</option>";h+="</select>";g.append(h);g.append('<input type=text id="'+this.rootId+'_val" class="inputvalue form-control input-sm" style="display: inline-block; height: 21px; width:100px; font-size: small;font-family: courier;" value="'+e+'">');void 0!=d&&0<d.values.length&&this.loadRange("#"+this.constListId+' input[id="'+this.rootId+
'_val"]',d)}$("#"+this.constListId).append("</div>");var r="#"+this.constListId+' select[id="'+this.rootId+'_op"] option:selected';d=$("#"+this.constListId+' select[id="'+this.rootId+'_op"]');e=$("#"+this.constListId+' select[id="'+this.rootId+'_andor"]');var p=$("#"+this.constListId+' select[id="'+this.rootId+'_andor"] option:selected'),u=$("#"+this.constListId+' input[id="'+this.rootId+'_val"]');$("#"+this.constListId+' a[id="'+this.rootId+'_close"]').click(function(){g.remove();$("#"+this.id);
f.fireRemoveFirstAndOr(this.rootId);(a.nameattr.startsWith("Qualifier ")||a.nameorg.startsWith("Qualifier ")||a.nameattr.startsWith("Cardinality"))&&f.fireRemoveConstRef(a.nameattr);a.nameattr.startsWith("POSLIST:")&&($("#"+$("#tapwhereposition_constposcont input:text")[0].id).val(""),$("span#uploadresult").text(""));f.fireEnterEvent();f.fireTypoMsg(!1,"")});d.change(function(){var a=/=\s+(.+)/.exec(this.value);a&&($("#"+f.constListId+' select[id="'+f.rootId+'_op"] option[value="="]').prop("selected",
!0),u.val(a[1]));a=0<p.length?p.text():"";f.fireEnterEvent(a,this.value,u.val())});e.change(function(){f.fireEnterEvent(this.value,$(r).text(),u.val())});u.keyup(function(a){"13"==a.which?f.isConstraintOK()?f.fireRunQuery():Modalinfo.error("Current contraint is not valid: cannot run the query"):f.fireEnterEvent(f.getAndOr(),$(r).text(),this.value)});u.click(function(a){f.fireEnterEvent(f.getAndOr(),$(r).text(),this.value)});u.on("input",function(a){f.fireEnterEvent(f.getAndOr(),$(r).text(),this.value)});
this.fireEnterEvent(this.getAndOr(),$(r).text(),u.val())}},fireGetADQL:function(a){return this.listener.controlGetADQL(a)},getAndOr:{value:function(){var a;return 0<(a=$("#"+this.constListId+' select[id="'+this.rootId+'_andor"] option:selected')).length?a.text():""}},isConstraintOK:{value:function(){return 0!=$("#"+this.constListId).parent().find("span.typomsg_ok:first").length}},loadRange:{value:function(a,b){var c=this;$(a).autocomplete({source:b.values,minLength:0,select:function(a,b){var f=/(?:(?:min)|(?:max))\s+(.+)/.exec(b.item.value);
f&&(b.item.value=f[1]);c.fireEnterEvent($("#"+c.constListId+' select[id="'+c.rootId+'_andor"] option:selected').text(),$("#"+c.constListId+' select[id="'+c.rootId+'_op"] option:selected').text(),b.item.value)}})}},drawFault:{value:function(a){var b=$("#"+this.constListId+' div[id="'+this.rootId+'"]');a?b.addClass("background-error"):b.removeClass("background-error")}},fireRemoveConstRef:{value:function(a){this.listener.controlRemoveConstRef(a)}},fireGetADQL:{value:function(a){return this.listener.controlGetADQL(a)}},
fireTypoMsg:{value:function(a,b){this.listener.controlTypoMsg(a,b)}},fireRunQuery:{value:function(){this.listener.controlRunQuery()}}});function UCDConstraint_mVc(a){KWConstraint_mVc.call(this,a);new KWConstraint_mvC(new UCDConstraint_Mvc(a),this)}
UCDConstraint_mVc.prototype=Object.create(KWConstraint_mVc.prototype,{initForm:{value:function(a,b,c,d,e){if(null==a)Modalinfo.error("Attempt to init a UCDConstraitn with a attribute handler null");else{var f=this;$("#"+this.constListId).append("<div class='kwConstraint' id='"+this.rootId+"' style='float: none;'>");var g="#"+this.constListId+' div[id="'+this.rootId+'"]';c="#"+this.constListId+' input[id="'+this.rootId+'_val"]';var h=$(g);h.append('&nbsp;<a id="'+this.rootId+'_close" href="javascript:void(0);" class=closekw title="Remove this Constraint"></a>&nbsp;');
h.append("<span id="+this.rootId+"_name>"+a.ucd+"</span><br>");for(var l='<select id="'+this.rootId+'_op" style="font-size: small;font-family: courier;">',m=0;m<b.length;m++){var r=b[m];">"==r?r="&gt;":"<"==r&&(r="&lt;");l+='<option value="'+r+'" >'+r+"</option>"}if(void 0!=d&&"list"==d.type)for(m=0;m<d.values.length;m++)b="String"==a.type?"'"+d.values[m].value+"'":d.values[m].value,l+='<option value="= '+b+'">= '+b+"</option>";h.append(l+"</select>");h.append('<input type=text id="'+this.rootId+
'_val" class="inputvalue form-control input-sm" style="width:140px; display: inline-block; height: 21px; font-size: small;font-family: courier;" value="'+e+'">');void 0!=d&&0<d.values.length&&this.loadRange(c,d);h.append('<input title="units" style="width:100px; margin:2px; display: inline-block; height: 21px;" type=text id="'+this.rootId+'_unit" class="inputvalue form-control input-sm"  style="font-size: small; font-family: courier;" value="'+supportedUnits[0].text+'">');var p="#"+this.constListId+
' select[id="'+this.rootId+'_op"] option:selected';a=$("#"+this.constListId+' select[id="'+this.rootId+'_op"]');var u=$("#"+this.constListId+' input[id="'+this.rootId+'_unit"]');d=$("#"+this.constListId+' a[id="'+this.rootId+'_close"]');var n=$(c);c=[];for(m=0;m<supportedUnits.length;m++)c[c.length]=supportedUnits[m].text;u.autocomplete({source:c,minLength:0,focus:function(a,b){f.fireEnterEvent("AND",$(p).text(),n.val(),b.item.value)}});$("#"+this.constListId).append("</div>");d.click(function(){$(g).remove();
f.fireRemoveFirstAndOr(this.rootId);f.fireEnterEvent();f.fireTypoMsg(!1,"")});a.change(function(){var a=/=\s+(.+)/.exec(this.value);a&&($("#"+f.constListId+' select[id="'+f.rootId+'_op"] option[value="="]').prop("selected",!0),n.val(a[1]));f.fireEnterEvent("AND",this.value,n.val(),u.val())});n.keyup(function(a){"13"==a.which?f.isConstraintOK()?f.fireRunQuery():Modalinfo.error("Current contraint is not valid: can not run the query"):f.fireEnterEvent("AND",$(p).text(),this.value,u.val())});n.click(function(a){f.fireEnterEvent("AND",
$(p).text(),this.value,u.val())});n.on("input",function(a){f.fireEnterEvent("AND",$(p).text(),this.value,u.val())});u.keyup(function(a){f.fireEnterEvent("AND",$(p).text(),n.val(),this.value)});this.fireEnterEvent("AND",$(p).text(),n.val(),u.val())}}}});function PosConstraint_mVc(a){KWConstraint_mVc.call(this,a);new KWConstraint_mvC(new PosConstraint_Mvc(a),this)}
PosConstraint_mVc.prototype=Object.create(KWConstraint_mVc.prototype,{initForm:{value:function(a,b,c,d,e){var f=this;$("#"+this.constListId).append("<div class='kwConstraint' id="+this.rootId+" style='float: none;'>");a=$("#"+this.constListId+" #"+this.rootId);b=this.fireGetADQL();b=48<b.length?b.substring(0,47)+"...":b;a.append("&nbsp;<a id="+this.rootId+'_close href="javascript:void(0);" class=closekw title="Remove this Constraint"></a>');a.append("<span id="+this.rootId+"_name>"+b+"</span>");$("#"+
this.constListId).append("</div>");$("#"+this.constListId+" #"+this.rootId+"_close").click(function(){f.drop()});this.fireEnterEvent($("#"+this.constListId+" #"+this.rootId+"_andor option:selected").text(),$("#"+this.constListId+" #"+this.rootId+"_op option:selected").text(),$("#"+this.constListId+" #"+this.rootId+"_val").val())}},drop:{value:function(){$("#"+this.constListId+" #"+this.rootId).remove();this.fireRemoveFirstAndOr(this.rootId);this.fireEnterEvent();this.fireTypoMsg(0,"")}}});
function CatalogueConstraint_mVc(a){KWConstraint_mVc.call(this,a);new KWConstraint_mvC(new CatalogueConstraint_Mvc(a),this)}
CatalogueConstraint_mVc.prototype=Object.create(KWConstraint_mVc.prototype,{initForm:{value:function(a,b,c,d,e){var f=this;$("#"+this.constListId).append("<div class='kwConstraint' id="+this.rootId+" style='float: none;'>");var g=$("#"+this.constListId+' div[id="'+this.rootId+'"]');g.append('&nbsp;<a id="'+this.rootId+'_close" href="javascript:void(0);" class=closekw title="Remove this Constraint"></a>&nbsp;');g.append('<span id="'+this.rootId+'_name">'+a.ACDS_CATACRO+"</span>&nbsp;<span>at</span>&nbsp;");
if(0<b.length){a='<select id="'+this.rootId+'_op" style="font-size: small;font-family: courier;">';for(c=0;c<b.length;c++){d=b[c];var h="";">"==d?d="&gt;":"<"==d&&(d="&lt;",h="selected");a+='<option value="'+d+'" '+h+">"+d+"</option>"}g.append(a+"</select>");g.append('<input type=text id="'+this.rootId+'_val" class="inputvalue form-control input-sm" style="width:100px; font-size: small;font-family: courier; display: inline-block; height: 21px;" value="'+e+'"> <span>arcsec</span>')}$("#"+this.constListId).append("</div>");
var l="#"+this.constListId+' select[id="'+this.rootId+'_op"] option:selected';b=$("#"+this.constListId+' select[id="'+this.rootId+'_op"]');var m=$("#"+this.constListId+' input[id="'+this.rootId+'_val"]');$("#"+this.constListId+' a[id="'+this.rootId+'_close"]').click(function(){g.remove();f.fireRemoveFirstAndOr(this.rootId);f.fireEnterEvent();f.fireTypoMsg(!1,"")});b.change(function(){f.fireEnterEvent("AND",this.value,m.val())});m.keyup(function(a){f.fireEnterEvent("AND",$(l).text(),this.value)});
m.click(function(a){f.fireEnterEvent("AND",$(l).text(),this.value)});m.on("input",function(a){f.fireEnterEvent("AND",$(l).text(),this.value)});this.fireEnterEvent("AND",$(l).text(),m.val())}}});function CrossidConstraint_mVc(a){CatalogueConstraint_mVc.call(this,a);new KWConstraint_mvC(new CrossidConstraint_Mvc(a),this)}
CrossidConstraint_mVc.prototype=Object.create(CatalogueConstraint_mVc.prototype,{initForm:{value:function(a,b,c,d,e){var f=this;$("#"+this.constListId).append("<div class='kwConstraint' id="+this.rootId+" style='float: none;'>");var g=$("#"+this.constListId+' div[id="'+this.rootId+'"]');g.append('&nbsp;<a id="'+this.rootId+'_close" href="javascript:void(0);" class=closekw title="Remove this Constraint"></a>&nbsp;');g.append('<span id="'+this.rootId+'_name">'+a.ACDS_CATACRO+"</span>&nbsp;<span>identfied with a proba</span>&nbsp;");
if(0<b.length){a='<select id="'+this.rootId+'_op" style="font-size: small;font-family: courier;">';for(c=0;c<b.length;c++){d=b[c];var h="";">"==d?(d="&gt;",h="selected"):"<"==d&&(d="&lt;");a+='<option value="'+d+'" '+h+">"+d+"</option>"}g.append(a+"</select>");g.append('<input type=text id="'+this.rootId+'_val" class="inputvalue form-control input-sm" style="display: inline-block; height: 21px; width: 80px; font-size: small;font-family: courier;" value="'+e+'"> <span>%</span>')}$("#"+this.constListId).append("</div>");
var l="#"+this.constListId+' select[id="'+this.rootId+'_op"] option:selected';b=$("#"+this.constListId+' select[id="'+this.rootId+'_op"]');var m=$("#"+this.constListId+' input[id="'+this.rootId+'_val"]');$("#"+this.constListId+' a[id="'+this.rootId+'_close"]').click(function(){g.remove();f.fireRemoveFirstAndOr(this.rootId);f.fireEnterEvent();f.fireTypoMsg(!1,"")});b.change(function(){f.fireEnterEvent("AND",this.value,m.val())});m.keyup(function(a){f.fireEnterEvent("AND",$(l).text(),this.value)});
m.click(function(a){f.fireEnterEvent("AND",$(l).text(),this.value)});m.on("input",function(a){f.fireEnterEvent("AND",$(l).text(),this.value)});this.fireEnterEvent("AND",$(l).text(),m.val())}}});function TapKWConstraint_mVc(a){KWConstraint_mVc.call(this,a);new KWConstraint_mvC(new TapKWConstraint_Mvc(a),this)}TapKWConstraint_mVc.prototype=Object.create(KWConstraint_mVc.prototype,{});console.log("=============== >  KWConstraint_v.js ");
KWConstraint_mvC=function(a,b){b.addListener({controlEnterEvent:function(b,d,e,f){a.processEnterEvent(b,d,e,f)},controlRemoveConstRef:function(b,d){a.processRemoveConstRef(b,d)},controlRemoveFirstAndOr:function(b){a.processRemoveFirstAndOr(b)},controlRemoveAndOr:function(b){a.removeAndOr(b)},controlGetADQL:function(b){return a.getADQL(b)},controlGetAttributeHandler:function(){return a.getAttributeHandler()},controlInit:function(){return a.notifyInitDone()},controlTypoMsg:function(b,d){return a.notifyTypoMsg(b,
d)},controlRunQuery:function(){return a.notifyRunQuery()}});a.addListener({isInit:function(a,d,e,f,g){b.initForm(a,d,e,f,g)},notifyFault:function(a){b.drawFault(a)},controlAhName:function(a){return b.getAhName(a)}})};console.log("=============== >  KWConstraint_c.js ");function AttachedData_mVc(a){this.queryView=a.queryView;this.parentDivId=a.parentDivId;this.title=a.title;this.formName=a.formName;this.products=a.products;this.productListId=this.formName+"_ProductList"}
AttachedData_mVc.prototype={draw:function(){var a=this,b='<fieldset style="display inline-block; width: 100%;" >\n  <legend>'+this.title+'</legend>\n    <div id="'+this.productListId+'" style="display: inline; float: left; width: 50%">\n\t   </div>\n\t   <div style="display: inline; float: left; margin-left: 30px;"class="spanhelp">\n\t\tone click on the check button for with,<br> two click on the\n\t\tcheck button for without,<br> three click on the check button\n\t\tfor nothing ...\n\t   </div>\n</fieldset>\n';
$("#"+this.parentDivId).html(b);this.drawItems();$("#"+this.productListId+" input").click(function(b){b=$(this).val();$(this).attr("id");0==b?($(this).attr("class","withdata").attr("value",1),$(this).next(".tt").text("With")):1==b?($(this).attr("class","withoutdata").attr("value",2),$(this).next(".tt").text("Without")):2==b&&($(this).attr("class","anydata").attr("value",0),$(this).next(".tt").text("Whatever"));a.updateQuery()})},drawItems:function(){for(var a=0;a<this.products.length;a++){var b="<div id="+
this.products[a].relation+' style="width: 100%;display: block; float: left">\n  <input id='+this.products[a].relation+' class="anydata" type="button" value="0" />\n  <span id='+this.products[a].relation+' class="tt">Whatever</span>\n  <span class="tt">'+this.products[a].label+"</span>\n</div><br>\n";$("#"+this.productListId).append(b)}},updateQuery:function(a){var b="",c="";$("#"+this.productListId+" input").each(function(){var a=$(this).attr("class"),e=$(this).attr("id");"withdata"==a?(b+=c+"    matchPattern{ "+
e+"}",c="\n"):"withoutdata"==a&&(b+=c+"    matchPattern{ "+e+", Cardinality = 0}",c="\n")});null!=this.queryView?this.queryView.fireAddConstraint(this.formName,"relation",b):Out.info("Add pattern "+b+" no query view")},fireClearAllConst:function(){$("#"+this.productListId+" input").attr("class","anydata").attr("value",0);$("#"+this.productListId+" .tt[id]").text("Whatever");this.updateQuery()}};
function AttachedPattern_mVc(a){AttachedData_mVc.call(this,a);this.patterns={};for(var b=0;b<a.products.length;b++){var c=this.products[b].label.replace(/ /g,"_");this.patterns[c]={pattern:a.products[b].pattern,relation:a.products[b].relation}}}
AttachedPattern_mVc.prototype=Object.create(AttachedData_mVc.prototype,{drawItems:{value:function(){for(var a in this.patterns){var b="<div id="+a+' style="width: 100%;display: block; float: left">\n  <input id='+a+' class="anydata" type="button" value="0" />\n  <span id='+a+' class="tt">Whatever</span>\n  <span class="tt">'+a+"</span>\n</div><br>\n";$("#"+this.productListId).append(b)}}},updateQuery:{value:function(a){var b="",c="",d=this;$("#"+this.productListId+" input").each(function(){var a=
$(this).attr("class"),f=$(this).attr("id");"withdata"==a?(b+=c+"    matchPattern{\n      "+d.patterns[f].relation+"\n      "+d.patterns[f].pattern+"\n      }",c="\n"):"withoutdata"==a&&(b+=c+"    matchPattern{\n      "+d.patterns[f].relation+"\n      , Cardinality = 0,\n      "+d.patterns[f].pattern+"\n      }",c="\n")});null!=this.queryView?this.queryView.fireAddConstraint(this.formName,"relation",b):Out.info("Add pattern "+b+" no query view")}}});
function AttachedPatterns_mVc(a){AttachedPattern_mVc.call(this,a);this.patterns={};for(var b=0;b<a.products.length;b++){var c=this.products[b].label.replace(/ /g,"_");this.patterns[c]={patternWith:a.products[b].patternWith,patternWithout:a.products[b].patternWithout,relation:a.products[b].relation}}}
AttachedPatterns_mVc.prototype=Object.create(AttachedPattern_mVc.prototype,{updateQuery:{value:function(a){var b="",c="",d=this;$("#"+this.productListId+" input").each(function(){var a=$(this).attr("class"),f=$(this).attr("id");"withdata"==a?(b+=c+"    matchPattern{\n      "+d.patterns[f].relation+"\n      "+d.patterns[f].patternWith+"\n      }",c="\n"):"withoutdata"==a&&(b+=c+"    matchPattern{\n      "+d.patterns[f].relation+"\n      "+d.patterns[f].patternWithout+"\n      }",c="\n")});null!=this.queryView?
this.queryView.fireAddConstraint(this.formName,"relation",b):Out.info("Add pattern "+b+" no query view")}}});function AttachedMatch_mVc(a){AttachedPattern_mVc.call(this,a);this.relation=a.relation;this.pattern=a.pattern;this.conditions={};for(var b=0;b<a.products.length;b++){var c=this.products[b].label.replace(/ /g,"_");this.conditions[c]=a.products[b].condition}}
AttachedMatch_mVc.prototype=Object.create(AttachedPattern_mVc.prototype,{updateQuery:{value:function(a){a="    matchPattern{\n      "+this.relation+"\n      "+this.pattern+"\n      }";var b="",c=this;$("#"+this.productListId+" input").each(function(){var a=$(this).attr("class"),e=$(this).attr("id");"withdata"==a?(""!=b&&(b+=" AND "),b+=c.conditions[e].yes):"withoutdata"==a&&(""!=b&&(b+=" AND "),b+=c.conditions[e].no)});""!=b?null!=this.queryView?this.queryView.fireAddConstraint(this.formName,"relation",
a.replace("{}","{"+b+"}")):Out.info("Add pattern "+a+" no query view"):this.queryView.fireAddConstraint(this.formName,"relation","")}}});console.log("=============== >  AttachedData_v.js ");
function VizierKeywords_mVc(a){this.queryView=a.queryView;this.parentDivId=a.parentDivId;this.title=a.title;this.formName=a.formName;this.getMetaUrl=a.getMetaUrl;this.productListId=this.formName+"_ProductList";this.testData=[{setName:"set1",keywords:["set1_kw1","set1_kw2","set1_kw3"]},{setName:"set2",keywords:["set2_kw1","set2_kw2","set2_kw3"]},{setName:"set3",keywords:["set3_kw1","set1_kw2","set3_kw3"]}]}
VizierKeywords_mVc.prototype={draw:function(){var a=this;null!=this.getMetaUrl?$.getJSON(this.getMetaUrl,function(b){a.drawKeywordsSelectors(b)}):this.drawKeywordsSelectors(this.testData)},drawKeywordsSelectors:function(a){for(var b=this,c='<div style="display inline-block; width: 100%;" >\n',d=0;d<a.length;d++){for(var e=a[d].setName,f=a[d].keywords,c=c+('<fieldset  style="float: left;">\n  <legend style="margin-bottom: 0px; border-bottom: 0px;">'+e+'&nbsp;<a name="'+e+'" class=closekw  href="javascript:void(0);" title="Unselect all items"></a></legend>\n'),
c=c+('<select name="'+e+'"  style="background-color: white;" multiple="multiple" size="7" width="100%" class="form-control">'),g=0;g<f.length;g++)c+='<option title="'+e+'" value="'+f[g]+'">'+f[g]+"</option>";c+="</select>\n</fieldset>\n"}c+='\t   <div style="width: 270px;display: inline; float: left; margin-left: 10px;"class="spanhelp">\n\t\t- The keywords proposed here are the same as those used by Vizier to tag catalogues<br>\n\t\t- Constraint on keywords filter X-ray sources correlated with at least one source of a catalogue \n\t\tmatching all the selected keywords<br>\n\t\t- Shift click to achieve multiple selections<br>\n       - The constraint on one keyword can be reversed by a ! set before the keyword in the text of the query\t   </div>\n</div>';
$("#"+this.parentDivId).append(c);$("#"+this.parentDivId+" select").change(function(){b.updateQuery()});$("#"+this.parentDivId+" a.closekw").click(function(){$("#"+b.parentDivId+' option[title="'+this.name+'"]').removeAttr("selected");b.updateQuery()})},updateQuery:function(){var a=[];$("#"+this.parentDivId+" option:selected").each(function(){var b=a[this.title];null==b&&(b=a[this.title]=[]);b.push(this.value)});var b=[];for(k in a)b.push('    "'+k+"="+a[k].join(",")+'"');this.queryView.fireAddConstraint(this.formName,
"kwconst",b.join("\n"))},fireClearAllConst:function(){$("#"+this.parentDivId+" option").removeAttr("selected");this.updateQuery()}};console.log("=============== >  VizierKeywords_v.js ");
OrderBy_mVc=function(a,b,c,d){var e=a+"_orderdesc",f=a+"_orderasc",g=a+"_orderdrop",h=a+"_orderby";this.draw=function(){$("#"+c).append("<div class=orderby><input id="+h+' class="orderby form-control" style="display: inline-block;" type="text" value="Order By" disabled="disabled"><label> desc <input id='+e+' type="radio" name="OrderBy" value="desc"> </label><label>asc <input id='+f+' type="radio" name="OrderBy" value="asc" checked> </label><a href="javascript:void(0);" id='+g+' class=closekw title="Reset OrderBy"></a></div>');
$("#"+g).click(function(){$(".orderby").val("Order By");$(".orderby").css("font-style","italic");$(".orderby").css("color","darkgray");d("OrderBy")});$("#"+f).click(function(){d($("#"+h).val())});$("#"+e).click(function(){d($("#"+h).val())})};this.setOrderBy=function(a){$(".orderby").css("font-style","");$(".orderby").css("color","black");$(".orderby").val(a)};this.getOrderBy=function(){return $("#"+h).val()};this.isDesc=function(){return $("#"+e).attr("checked")?!0:!1};this.setDesc=function(){$("#"+
e).attr("checked","true")};this.setAsc=function(){$("#"+f).attr("checked","true")};this.isAsc=function(){return $("#"+f).attr("checked")?!0:!1};this.fireClearAllConst=function(){$(".orderby").val("");$("#"+e).attr("checked","true")}};console.log("=============== >  OrderBy_v.js ");
function ConeSearch_mVc(a){this.editor=a.editor;this.parentDivId=a.parentDivId;this.formName=a.formName;this.frames=a.frames;this.sesameURL=a.urls.sesameURL;this.uploadURL=a.urls.uploadURL;this.preloadedGetter=a.preloadedGetter;this.cooFieldId=this.formName+"_CScoofield";this.radiusFieldId=this.formName+"_CSradiusfield";this.frameSelectId=this.formName+"_CSframeselect";this.uploadId=this.formName+"_CSupload";this.sesameId=this.formName+"_CSsesame";this.stackId=this.formName+"_CSstack";this.regionId=
this.formName+"_CSregion";parentId=this.parentDivId}
ConeSearch_mVc.prototype={draw:function(){if(null==this.frames||0==this.frames.length)this.frames=["ICRS"];var a='<fieldset class="fieldiv col-sm-6" style="width:320px;">  <legend> Cone Search Setup </legend>     <form style="background: transparent;" class="form-horizontal">\t\t  <div class="form-group">         <label class="col-sm-4 control-label">Coord/Name</label>         <div class="col-sm-6" style="padding-right: 5px;">           <input type=text id="'+this.cooFieldId+'" class="inputvalue form-control input-sm"/>\t\t    </div>\t\t    <div class="col-sm-2" style="padding-left: 1px;">           <a href="javascript:void(0);" id="'+
this.sesameId+'" title="Invoke the CDS name resolver" class="sesame-small"></a>       </div>\t\t  <div class="form-group" style="margin-bottom: 0px;">         <label class="col-sm-12 control-label" style="padding-top: 0px;"><span class="help">12.5 +45.8 - 14:03:01.01+54:23:41.6 - M33 </span></label>       </div>    </div>\t\t  <div class="form-group">         <label class="col-sm-4 control-label">Radius(arcmin)</label>         <div class="col-sm-8">           <input type=text id="'+this.radiusFieldId+
'" class="inputvalue form-control input-sm" value="1" />       </div></div>\t\t  <div class="form-group" style="margin-bottom: 5px;">         <label class="col-sm-4 control-label">System</label> \t    <div class="col-sm-8">        \t  <select id="'+this.frameSelectId+'" class="form-control input-sm">      \t  </select>       </div></div>       <div><span id='+this.regionId+' class="action activehover" style="margin-right: 10px; float:none;">Draw a Search Region</span>       <span id="'+this.uploadId+
'" class="action activehover" style="float:none;">Upload Position List</span></div>       <div style="display: inline; float: right;"><span class=help id="uploadresult"></span></div>       </div></fieldset>';$("#"+this.parentDivId).append(a);for(var a=$("#"+this.frameSelectId),b=0;b<this.frames.length;b++)a.append("<option value="+this.frames[b]+">"+this.frames[b]+"</option>");this.setUploadForm();this.setSesameForm()},setRegionForm:function(a){var b=this;$("#"+this.regionId).click(function(){var c=
null;b.editor&&(c=b.editor.getDefaultValue());null==c?Modalinfo.info("Please, define first a search position before to edit a region","No Target Defined"):Modalinfo.region(a,c)})},setUploadForm:function(){var a=this,b=null!=this.uploadURL?function(){Modalinfo.uploadForm("Upload a list of position",a.uploadURL,"Upload a CSV position list<br>Search radius (optional) are in arcmin",function(b){var d;d=void 0!=b.retour.name&&void 0!=b.retour.size?" File "+b.retour.name+" uploaded<br>"+b.retour.positions+
" positions":JSON.stringify(b.retour);$("span#uploadresult").html(d);a.editor.firePoslistUpload(b.path.filename,$("#"+a.radiusFieldId).val());Modalinfo.close()},function(){$("span#uploadresult").text("")})}:function(){Modalinfo.info("Upload not implemented yet")};$("#"+this.uploadId).click(b)},setSesameForm:function(){var a=this,b=$("#"+this.cooFieldId),c=null!=this.sesameURL?function(){Processing.show("Waiting on SESAME response");$.getJSON("sesame",{object:b.val()},function(c){Processing.hide();
Processing.jsonError(c,"Sesame failure","Name "+b.val()+" cannot be resolved")||(b.val(c.alpha+" "+c.delta),void 0!=a.editor&&(a.editor.listener.controlAttributeEvent(a.editor.fieldListView.getSearchParameters(),a.editor.constListId),$("#"+a.editor.constListId+" span.help").attr("style","display:none;"),a.editor.fieldListView.resetPosition()))})}:function(){Modalinfo.info("name resolver not implemented yet")};$("#"+this.sesameId).click(c)},hasSearchParameters:function(){var a=$("#"+this.cooFieldId).val(),
b=$("#"+this.radiusFieldId).val();return""==a.trim()||isNaN(b)?!1:!0},getSearchParameters:function(){var a=$("#"+this.cooFieldId).val(),b=$("#"+this.radiusFieldId).val(),c=$("#"+this.frameSelectId+"  option:selected").text();return""==a.trim()?(Modalinfo.error("No coordinates given"),null):isNaN(b)?(Modalinfo.error("Radius field requires a numerical value"),null):{type:"cone",position:a,radius:b,frame:c}},resetPosition:function(){$("#"+this.cooFieldId).val("")},fireClearAllConst:function(){$("#"+
this.cooFieldId).val("")}};function SimplePos_mVc(a){ConeSearch_mVc.call(this,a);this.queryView=a.queryView}
SimplePos_mVc.prototype=Object.create(ConeSearch_mVc.prototype,{draw:{value:function(){var a=this;if(null==this.frames||0==this.frames.length)this.frames=["ICRS"];var b='<div style="background: transparent;"  class="form-inline">\t\t  <div class="form-group">         <label style="margin-left:7px;">Coord/Name</span>         <input type=text id="'+this.cooFieldId+'" class="inputvalue form-control input-sm"/>       \t<a href="javascript:void(0);" id="'+this.sesameId+'" title="Invoke the CDS name resolver" class="sesame-small"></a><br><span class="help">12.5 +45.8 - 14:03:01.01+54:23:41.6 - M33 </span>       </div>\t\t  <div class="form-group">         <label style="margin-right: 7px;">Radius(arcmin)</label>         <input type=text id="'+
this.radiusFieldId+'" class="inputvalue form-control input-sm" style="width: 40px;" value="1" />       </div>\t\t  <div class="form-group">         <label style="margin-right: 7px;">System</label>'+(null!=this.frames?'      <select class="form-control input-sm" id="'+this.frameSelectId+'" >':"")+'         </select>       </div>       <div class="form-group" style="margin-top: 6px;">\t\t\t<span id='+this.regionId+' class="datafield activehover" style="float: none;margin-left: 10px;">Draw a Search Region</span>         <span class="datafield activehover help-block" id="'+
this.uploadId+'" style="float: none;margin-left: 10px;">Upload Position List</span>       </div></div>      <div style="overflow: hidden; float:right;">         <span class=help id="uploadresult"></span>      </div>';$("#"+this.parentDivId).append(b);for(var b=$("#"+this.frameSelectId),c=0;c<this.frames.length;c++)b.append("<option value="+this.frames[c]+">"+this.frames[c]+"</option>");this.setUploadForm();this.setSesameForm();a.setRegionForm(function(b){if(b.userAction)if(5<b.region.size.x||5<b.region.size.y)Modalinfo.error("The region size can't exceeded 5 deg. \nIts actual size is "+
JSON.stringify(b.region.size));else if(b&&b.userAction&&b.isReady){var c="";if("array2dim"==b.region.format)for(var c="",f=0;f<b.region.points.length-1;f++)0<f&&(c+=" "),c+=b.region.points[f][0]+" "+b.region.points[f][1];else if("array"==b.region.format)for(c="",f=0;f<b.region.points.length;f++)0<f&&(c+=" "),c+=b.region.points[f];else Modalinfo.error(b.region.format+" not supported region format");""!=c&&(b=$("#"+a.radiusFieldId).val(),f=$("#"+a.frameSelectId+"  option:selected").text(),a.updateQueryRegion(c,
b,f),Modalinfo.closeRegion())}});$("#"+this.cooFieldId).keyup(function(b){13==b.which?b.preventDefault():a.readAndUpdate()});$("#"+this.cooFieldId).click(function(b){a.readAndUpdate()});$("#"+this.cooFieldId).bind("input propertychange",function(b){a.readAndUpdate()});$("#"+this.radiusFieldId).keyup(function(b){13==b.which?b.preventDefault():a.readAndUpdate()});$("#"+this.radiusFieldId).click(function(b){a.readAndUpdate()});$("#"+this.radiusFieldId).bind("input propertychange",function(b){a.readAndUpdate()});
$("#"+this.frameSelectId).change(function(b){a.readAndUpdate()})}},readAndUpdate:{value:function(){var a=$("#"+this.cooFieldId).val(),b=$("#"+this.radiusFieldId).val(),c=$("#"+this.frameSelectId+"  option:selected").text();this.updateQuery(a,b,c)}},setUploadForm:{value:function(){var a=this,b=null!=this.uploadURL?function(){Modalinfo.uploadForm("Upload a list of position",a.uploadURL,"Upload a CSV position list<br>Search radius (optional) are in arcmin",function(b){var d;d=void 0!=b.retour.name&&
void 0!=b.retour.size?b.retour.name+" uploaded, "+b.retour.positions+" positions":JSON.stringify(b.retour);$("#"+a.parentDivId+" span#uploadresult").html(d);$("#"+a.cooFieldId).val("poslist:"+b.retour.name);a.readAndUpdate()},function(){$("span#uploadresult").text("")})}:function(){Modalinfo.info("Upload not implemented yet")};$("#"+this.uploadId).click(b)}},setSesameForm:{value:function(){var a=this,b=$("#"+this.cooFieldId),c=null!=this.sesameURL?function(){Processing.show("Waiting on SESAME response");
$.getJSON("sesame",{object:b.val()},function(c){Processing.hide();Processing.jsonError(c,"Sesame failure")?a.updateQuery("","",null):(b.val(c.alpha+" "+c.delta),a.readAndUpdate())})}:function(){Modalinfo.info("name resolver not implemented yet")};$("#"+this.sesameId).click(c)}},updateQuery:{value:function(a,b,c){null!=this.queryView?(this.queryView.fireDelConstraint(this.formName,"position"),""!=a&&""!=b&&this.queryView.fireAddConstraint(this.formName,"position",'    isInCircle("'+a+'", '+b+", "+
("FK5"==c?"J2000":"FK4"==c?"J1950":"-")+", "+c+")")):Out.info("No query view")}},updateQueryRegion:{value:function(a,b,c){null!=this.queryView?(this.queryView.fireDelConstraint(this.formName,"position"),""!=a&&""!=b&&this.queryView.fireAddConstraint(this.formName,"position",'    isInRegion("'+a+'", '+b+", "+("FK5"==c?"J2000":"FK4"==c?"J1950":"-")+", "+c+")")):Out.info("No query view")}},fireClearAllConst:{value:function(){$("#"+this.cooFieldId).val("");this.readAndUpdate()}}});
function TapSimplePos_mVc(a){SimplePos_mVc.call(this,a);this.handler=this.editor.fireInputCoordEvent;this.postUploadHandler=a.postUploadHandler;this.uploadedFile=""}
TapSimplePos_mVc.prototype=Object.create(SimplePos_mVc.prototype,{draw:{value:function(){var a=this;if(null==this.frames||0==this.frames.length)this.frames=["ICRS"];var b='<div> <div class="tapPos">       <span class=help style="display: inline-block; width: 7em; margin-right: 0px;">Coord/Name</span>       <input type=text id="'+this.cooFieldId+'" class=inputvalue  size=18 />       <a href="javascript:void(0);" id="'+this.sesameId+'" title="Invoke the CDS name resolver" class="sesame-small"></a><br><span class="help">12.5 +45.8 - 14:03:01.01+54:23:41.6 - M33 </span>       <span class=help >System</span>'+
(null!=this.frames?'      <select id="'+this.frameSelectId+'" >':"")+'      </select> </div> <div class="tapPos">       <span class=help style="margin-right:3px;">Radius(arcmin)</span>       <input type=text id="'+this.radiusFieldId+'" class=inputvalue style="width: 40px;" value="1" />       <input class=stackconstbutton id="'+this.stackId+'" type="button"/>       <input type=button id="'+this.uploadId+'" value="Upload Position List" title="Active for services supporting uploads" disabled=true /></div>       <div>            <span class=help id="uploadresult"></span>       </div> </div>';
$("#"+this.parentDivId).append(b);for(var b=$("#"+this.frameSelectId),c=0;c<this.frames.length;c++)b.append("<option value="+this.frames[c]+">"+this.frames[c]+"</option>");this.setUploadForm();this.setSesameForm();$("#"+this.stackId).click(function(){a.readAndUpdate()});$("#"+this.cooFieldId).keyup(function(b){13==b.which&&a.readAndUpdate()});$("#"+this.radiusFieldId).keyup(function(b){13==b.which&&a.readAndUpdate()});$("#"+this.frameSelectId).change(function(b){a.readAndUpdate()})}},readAndUpdate:{value:function(){this.uploadedFile=
"";var a=$("#"+this.cooFieldId).val(),b=$("#"+this.radiusFieldId).val(),c=$("#"+this.frameSelectId+"  option:selected").text();if(0==a.length)Modalinfo.error("No coordinates given","input error");else if(0==b.length)Modalinfo.error("No radius given","input error");else if($.isNumeric(b)){var d=a.split(/\s+/);a.startsWith("poslist:")?(this.uploadedFile=a.replace("poslist:",""),this.editor.fireInputCoordEvent(a,null,b,c)):2!=d.length?Modalinfo.error("Coordinates must be separated with a blank","input error"):
$.isNumeric(d[0])&&$.isNumeric(d[1])?this.editor.fireInputCoordEvent(d[0],d[1],b,c):Modalinfo.error("Radius must be numeric","input error")}else Modalinfo.error("Radius must be numeric","input error")}},supportUpload:{value:function(a){var b=$("#"+this.uploadId);b.prop("disabled",!a);a?b.prop("title","Upload supported by the current node"):b.prop("title","Upload not supported by the current node")}},setUploadForm:{value:function(){var a=this,b=null!=this.uploadURL?function(){var b=$("#"+a.radiusFieldId).val();
if(""==b)Modalinfo.error("Radius must be set");else if(a.editor.isReadyToUpload()){var d=null!=a.preloadedGetter?a.preloadedGetter():[];Modalinfo.uploadForm("Upload a list of position",a.uploadURL,"Upload a CSV position list (ra dec or object name)",function(b){var c;void 0!=b.retour.nameVot&&void 0!=b.retour.positions?($("#"+parentId.split("_")[0]+"_delconstlist").click(),c=b.retour.nameVot+" uploaded, "+b.retour.positions+" positions",$("#"+a.cooFieldId).val("poslist:"+b.retour.nameVot),$("#"+a.parentDivId+
" span#uploadresult").html(c),a.readAndUpdate(),null!=a.postUploadHandler&&a.postUploadHandler(b.retour),Modalinfo.close()):Modalinfo.error(b,"Upload Failure")},function(){$("span#uploadresult").text("")},[{name:"radius",value:b},{name:"jsessionid",value:sessionID}],d)}}:function(){Modalinfo.info("Upload not implemented yet")};$("#"+this.uploadId).click(b)}},setSesameForm:{value:function(){var a=this,b=$("#"+this.cooFieldId),c=null!=this.sesameURL?function(){Processing.show("Waiting on SESAME response");
$.getJSON("sesame",{object:b.val()},function(c){Processing.hide();Processing.jsonError(c,"Sesame failure")?a.updateQuery("","",null):(b.val(c.alpha+" "+c.delta),a.readAndUpdate())})}:function(){Modalinfo.info("name resolver not implemented yet")};$("#"+this.sesameId).click(c)}},updateQuery:{value:function(a,b,c){null!=this.queryView?(this.queryView.fireDelConstraint(this.formName,"position"),""!=a&&""!=b&&this.queryView.fireAddConstraint(this.formName,"position",'    isInCircle("'+a+'", '+b+", "+
("FK5"==c?"J2000":"FK4"==c?"J1950":"-")+", "+c+")")):Out.info("No query view")}},fireClearAllConst:{value:function(){$("#"+this.cooFieldId).val("");this.readAndUpdate()}}});console.log("=============== >  ConeSearch_v.js ");
ConstList_mVc=function(a,b,c,d){var e=a+"_constlist",f=a+"_delconstlist",g=a+"_typoMsgId";this.draw=function(b,l){if(void 0!=b&&null!=b)var m=b.fieldset,r=b.div;else m="185px",r="150px";var p=void 0!=l&&l?"100%":"450px";$("#"+c).append('<div class=constdiv style="width: '+p+'">    <fieldset style=" height:'+m+';">        <legend style="border-bottom: 0px; " class=help>List of Active Constraints <a href="javascript:void(0);" id='+f+' class=closekw style="float: none;" title="Remove all constraints"></a></legend>        <div  style="overflow: auto; height:'+
r+'; background-color: #f2f2f2; width: 100%" id="'+e+'"><span class=help>Click on a <input class="stackconstbutton" type="button"> button to append,<br>the constraint to the list</span></div>    </fieldset>    <div>      <span class="ql">QL stmt </span><span style="height: 18;" class=typomsg_ok id='+g+"></span>    </div></div>");b&&$("#div-"+a).appendTo($("#"+g).parent());$("#"+f).click(function(){d()});return e};this.printTypoMsg=function(a,b){$("#"+g).each(function(){a?$(this).attr("class","typomsg_ko"):
$(this).attr("class","typomsg_ok");$(this).text(b)})};this.isTypoGreen=function(){return"typomsg_ok"==$("#"+g).first().attr("class")};this.fireClearAllConst=function(){0!=$("#"+a+"_constposcont input:text").length&&$("#"+$("#"+a+"_constposcont input:text")[0].id).val("");$("span#uploadresult").text("");$("#"+e+" div.kwConstraint").each(function(){$(this).remove()})};this.fireClearConst=function(a){$("#"+e+" div.kwConstraint").each(function(){$(this).attr("id").match(a)&&$(this).remove()})};this.fireRemoveAllHandler=
function(){d()}};console.log("=============== >  ConstList_v.js ");function BasicFieldList_mVc(a,b,c){this.parentDiv=$("#"+a);this.fieldListId=a+"_fieldlist";this.fieldTableId=a+"_fieldtable";this.attributesHandlers=[];this.filterPattern=null;this.formName=b;this.dataTreePath=null;this.stackHandler=c.stackHandler;this.orderByHandler=c.orderByHandler;this.raHandler=c.raHandler;this.decHandler=c.decHandler;this.stackTooltip="Click to constrain this field"}
BasicFieldList_mVc.prototype={draw:function(){this.attributesHandlers=[];this.parentDiv.html('<div class=fielddiv><div class="fieldlist" id="'+this.fieldListId+'"></div>');$("#"+this.fieldListId).closest(".fielddiv").css("padding","3px")},setStackTooltip:function(a){this.stackTooltip=a},setDataTreePath:function(a){this.dataTreePath=a;this.displayFields()},getAttributeTitle:function(a){return a.nameorg+" - database name; "+a.nameattr+" - description: "+a.description+(a.ucd?" - UCD: "+a.ucd:"")+(a.unit?
" - Unit: "+a.unit:"")+(a.type?" - Type: "+a.type:"")+(a.range?" - Range: "+JSON.stringify(a.range).replace(/'/g,"&#39;"):"")},displayField:function(a){var b=this,c=this.formName+"_"+a.nameattr,d=this.getAttributeTitle(a),d="<tr class=attlist id="+a.nameattr+"><td class=attlist><span title='"+d+"'>"+a.nameorg+"</span></td><td class='attlist help'>"+a.type+"</td><td class='attlist help'>"+(void 0!=a.unit?a.unit:"")+"</td>";null!=this.orderByHandler&&(d+="<td class='attlist attlistcmd'><input id=order_"+
c+' title="Click to order the query result by this field" class="orderbybutton" type="button" ></input></td>');null!=this.stackHandler&&(d+="<td class='attlist attlistcmd'><input id=stack_"+c+' title="'+this.stackTooltip+'"  class="stackconstbutton" type="button"></input></td>');null!=this.raHandler&&(d+="<td class='attlist attlistcmd'><input id=tora_"+c+' title="Click to use this field as RA coordinate"  class="raconstbutton" type="button"></input></td>');null!=this.decHandler&&(d+="<td class='attlist attlistcmd'><input id=todec_"+
c+' title="Click to use this field as DEC coordinate"  class="decconstbutton" type="button"></input></td>');d+="</tr>";$("#"+this.fieldTableId).append(d);c=this.formName+"_"+a.nameattr;null!=this.orderByHandler&&$("#"+this.fieldListId+' input[id="order_'+c+'"]').click(function(){b.orderByHandler($(this).closest("tr").attr("id"))});null!=this.stackHandler&&$("#"+this.fieldListId+' input[id="stack_'+c+'"]').click(function(){b.stackHandler($(this).closest("tr").attr("id"))});null!=this.raHandler&&$("#"+
this.fieldListId+' input[id="tora_'+c+'"]').click(function(){b.raHandler($(this).closest("tr").attr("id"))});null!=this.decHandler&&$("#"+this.fieldListId+' input[id="todec_'+c+'"]').click(function(){b.decHandler($(this).closest("tr").attr("id"))});$("#"+this.fieldTableId+" tr#"+a.nameattr+" span").tooltip({track:!0,delay:0,showURL:!1,opacity:1,fixPNG:!0,showBody:" - ",top:-15,left:5})},displayFields:function(){var a=this;this.attributesHandlers=[];null!=this.dataTreePath&&MetadataSource.getTableAtt(this.dataTreePath,
function(){var b=MetadataSource.ahMap(a.dataTreePath);a.displayAttributeHandlers(b)})},displayAttributeHandlers:function(a){var b="<table id="+this.fieldTableId+" class='table' style='width: 100%; border-spacing: 0px; border-collapse:collapse'></table>";$("#"+this.fieldListId).html(b);for(b=0;b<a.length;b++){var c=a[b];this.attributesHandlers[c.nameattr]=c;this.addPresetValues(c);this.displayField(c)}},addPresetValues:function(a){"dataproduct_type"==a.nameattr?a.range={type:"list",values:"'image' 'spectrum' 'cube' 'timeseries' 'visibility' 'eventlist'".split(" ")}:
"calib_level"==a.nameattr?a.range={type:"list",values:[0,1,2,3]}:"access_format"==a.nameattr&&(a.range={type:"list",values:"'text/html' 'text/xml' 'text/plain' 'application/fits' 'application/x-votable+xml' 'application/pdf' 'image/png' 'image/jpeg' 'image/gif' 'image/bmp'".split(" ")})},getAttributeHandler:function(a){return this.attributesHandlers[a]}};function FieldList_mVc(a,b,c){BasicFieldList_mVc.call(this,a,b,c);this.fieldFilterId=a+"_fieldfilter"}
FieldList_mVc.prototype=Object.create(BasicFieldList_mVc.prototype,{draw:{value:function(){var a=this;this.attributesHandlers=[];this.parentDiv.html('<div class=fielddiv><div class="fieldlist" id="'+this.fieldListId+'"></div> <div class="form-group" style="width:347px; margin-bottom:8px; margin-top:8px;"><div class="input-group"><div class="input-group-addon input-sm"><span class="glyphicon glyphicon-search"></span></div> <input id="'+this.fieldFilterId+'" class="form-control input-sm" type="text" placeholder="Search"/></div></div>');
$("#"+this.fieldListId).closest(".fielddiv").css("padding","3px");$("#"+this.fieldFilterId).keyup(function(){a.filterPattern=RegExp($(this).val(),"i");a.fireFilter()});$("#"+this.fieldFilterId).one("click",function(){$(this).css("color","black");$(this).css("font-style","");$(this).attr("value","")})}},fireFilter:{value:function(){$("#"+this.fieldTableId).html("");for(var a in this.attributesHandlers){var b=this.attributesHandlers[a];(this.filterPattern.test(b.nameorg)||this.filterPattern.test(b.nameattr)||
this.filterPattern.test(b.ucd)||this.filterPattern.test(b.comment))&&this.displayField(b)}}}});function UcdFieldList_mVc(a,b,c){FieldList_mVc.call(this,a,b,c)}
UcdFieldList_mVc.prototype=Object.create(FieldList_mVc.prototype,{displayField:{value:function(a){var b=this,c="stack_"+(this.formName+"_"+a.ucd),d="<tr class=attlist id='"+a.ucd+"'><td class=attlist><span title='"+(a.ucd+" - description: "+a.comment)+"'>"+a.ucd+"</span></td>";null!=this.stackHandler&&(d+="<td class='attlist attlistcmd'><input id="+c+' title="Click to constrain fields with this UCD"  class="stackconstbutton" type="button"></input></td>');d+="</tr>";$("#"+this.fieldTableId).append(d);
null!=this.stackHandler&&$("#"+this.fieldTableId+' input[id="'+c+'"]').click(function(){b.stackHandler($(this).closest("tr").attr("id"))});$("#"+this.fieldTableId+' tr[id="'+a.ucd+'"] span').tooltip({track:!0,delay:0,showURL:!1,opacity:1,fixPNG:!0,showBody:" - ",top:-15,left:5})}},displayFields:{value:function(){var a=this;this.attributesHandlers=[];MetadataSource.getTableAtt(this.dataTreePath,function(){var b=MetadataSource.ahMap(a.dataTreePath),c="<table id="+a.fieldTableId+" style='width: 100%; border-spacing: 0px; border-collapse:collapse' class='table'></table>";
$("#"+a.fieldListId).html(c);for(c=0;c<b.length;c++){var d=b[c];a.attributesHandlers[d.ucd]=d;a.displayField(d)}})}}});function CatalogueList_mVc(a,b,c){FieldList_mVc.call(this,a,b,c)}
CatalogueList_mVc.prototype=Object.create(FieldList_mVc.prototype,{draw:{value:function(){var a=this;this.attributesHandlers=[];this.parentDiv.html('<div class=fielddiv><div class="fieldlist" id="'+this.fieldListId+'"></div> <div class="form-group" style="width:347px; margin-bottom:8px; margin-top:8px;"><div class="input-group"><div class="input-group-addon input-sm"><span class="glyphicon glyphicon-search"></span></div> <input id="'+this.fieldFilterId+'" class="form-control input-sm" type="text" placeholder="Search"/></div></div>');
$("#"+this.fieldListId).closest(".fielddiv").css("padding","3px");$("#"+this.fieldFilterId).keyup(function(){a.filterPattern=RegExp($(this).val(),"i");a.fireFilter()});$("#"+this.fieldFilterId).one("click",function(){$(this).css("color","black");$(this).css("font-style","");$(this).attr("value","")})}},displayField:{value:function(a){var b=this,c=this.formName+"_"+a.CLASSNAME,d="<tr class=attlist id='"+a.CLASSNAME+"'><td class=attlist style='width: 25%; overflow: hidden'><span title='"+(a.ACDS_CATNAME+
" - ACDS_CATACRO "+a.ACDS_CATACRO+" - ACDS_CATCDSTB: "+a.ACDS_CATCDSTB+" - ACDS_CATCONF: "+a.ACDS_CATCONF+" - ACDS_CATINTNB: "+a.ACDS_CATINTNB+" - ACDS_CATNAME: "+a.ACDS_CATNAME+" - ACDS_CDSCAT: "+a.ACDS_CDSCAT+" - VIZIER_KW: "+a.VIZIER_KW+" - CLASSNAME: "+a.CLASSNAME)+"'>"+a.ACDS_CATACRO+"</span></td><td class='attlist help'>"+a.ACDS_CATNAME+"</td>";null!=this.stackHandler&&(d+="<td class='attlist attlistcmd' style='width: 16px;'><input id=stack_"+c+' title="Click to constrain this field"  class="stackconstbutton" type="button"></input></td>');
d+="</tr>";$("#"+this.fieldTableId).css("table-layout","auto");$("#"+this.fieldTableId).append(d);null!=this.stackHandler&&$("#stack_"+c).click(function(){b.stackHandler($(this).closest("tr").attr("id"))});$("#"+this.fieldTableId+' tr[id="'+a.CLASSNAME+'"] span').tooltip({track:!0,delay:0,showURL:!1,opacity:1,fixPNG:!0,showBody:" - ",top:-15,left:5})}},displayFields:{value:function(a){this.attributesHandlers=[];for(var b=0;b<a.length;b++){var c=a[b];this.attributesHandlers[c.CLASSNAME]=c}a="<table id="+
this.fieldTableId+" style='width: 100%; border-spacing: 0px; border-collapse:collapse' class='table'></table>";$("#"+this.fieldListId).html(a);for(b in this.attributesHandlers)this.displayField(this.attributesHandlers[b])}},getAttributeHandlerByName:{value:function(a){for(var b in this.attributesHandlers){var c=this.attributesHandlers[b];if(c.nameaatr==a)return c}return nul}},fireFilter:{value:function(){$("#"+this.fieldTableId).html("");for(var a in this.attributesHandlers){var b=this.attributesHandlers[a];
(this.filterPattern.test(b.ACDS_CATACRO)||this.filterPattern.test(b.ACDS_CATCDSTB)||this.filterPattern.test(b.ACDS_CATCONF)||this.filterPattern.test(b.ACDS_CATINTNB)||this.filterPattern.test(b.ACDS_CATNAME)||this.filterPattern.test(b.ACDS_CDSCAT)||this.filterPattern.test(b.VIZIER_KW)||this.filterPattern.test(b.CLASSNAME))&&this.displayField(b)}}}});function TapColList_mVc(a,b,c,d){FieldList_mVc.call(this,a,b,c);this.tableselectid=a+"_tableSelect";this.joinedTableLoaded=!1}
TapColList_mVc.prototype=Object.create(FieldList_mVc.prototype,{draw:{value:function(){var a=this;this.attributesHandlers=[];this.joinedTableLoaded=!1;this.parentDiv.html('<div class="fielddiv"><div class="fieldlist" id="'+this.fieldListId+'" style="height: 175px"></div> <div class="form-group" style="width:347px; margin-bottom:8px; margin-top:8px;"><div class="input-group"><div class="input-group-addon input-sm"><span class="glyphicon glyphicon-search"></span></div> <input id="'+this.fieldFilterId+
'" class="form-control input-sm" type="text" placeholder="Search"/></div></div>  <div  style="width: 350px; margin: 3px;">\t\t   <div class="form-group form-inline"><label for="tapColEditor_tableSelect">Join with table:</label>        <select id="'+this.tableselectid+'"  class="table_filter form-control input-sm"  style="width: 250px">        </select></div> </div>  </div>');$("#"+this.fieldFilterId).keyup(function(){a.filterPattern=RegExp($(this).val(),"i");a.fireFilter()});$("#"+this.fieldFilterId).one("click",
function(){$(this).css("color","black");$(this).css("font-style","");$(this).attr("value","")});this.setChangeTableHandler()}},setChangeTableHandler:{value:function(){var a=this;$("#"+this.tableselectid).change(function(){var b=this.value.split("."),c;$("#"+a.fieldFilterId).val("");2==b.length?(c=b[0],b=b[1]):(c=a.treePath.schema,b=b[0]);a.changeTable(new DataTreePath({nodekey:a.dataTreePath.nodekey,schema:c,table:b}))})}},setDataTreePath:{value:function(a){this.dataTreePath=a;$("#"+this.fieldListId).html("");
$("#"+this.tableselectid).html("");this.joinedTableLoaded=!1;this.addTableOption(this.dataTreePath);this.changeTable(this.dataTreePath)}},addTableOption:{value:function(a){$("#"+this.tableselectid).append("<option>"+a.schema+"."+a.table+"</option>")}},changeTable:{value:function(a){this.dataTreePath=a;this.displayFields()}},getAttributeTitle:{value:function(a){return a.nameorg+" - node; "+this.dataTreePath.nodekey+" - schema; "+this.dataTreePath.schema+" - table; "+this.dataTreePath.table+" - description: "+
a.description+(a.ucd?" - UCD: "+a.ucd:"")+(a.unit?" - Unit: "+a.unit:"")+(a.type?" - Type: "+a.type:"")+(a.range?" - Range: "+JSON.stringify(a.range.values).replace(/'/g,"&#39;"):"")}},displayFields:{value:function(){var a=this;this.attributesHandlers=[];MetadataSource.getTableAtt(this.dataTreePath,function(b){a.resetPosKeywords();var c=b.hamap,d="<table id="+a.fieldTableId+" style='width: 100%; border-spacing: 0px; border-collapse:collapse' class='table'></table>";$("#"+a.fieldListId).html(d);a.attributesHandlers=
[];for(d=0;d<c.length;d++){var e=c[d];a.attributesHandlers[e.nameattr]=e;a.displayField(e)}if(!a.joinedTableLoaded){b=b.targets;for(d=0;d<b.length;d++)a.addTableOption(b[d].target_datatreepath);a.joinedTableLoaded=!0}a.lookForAlphaKeyword();a.lookForDeltaKeyword()})}},lookForAlphaKeyword:{value:function(a){}},lookForDeltaKeyword:{value:function(a){}},resetPosKeywords:{value:function(a){}}});
function TapFieldList_mVc(a,b,c,d,e){TapColList_mVc.call(this,a,b,c,d,e);this.raFieldId=a+"_rafield";this.decFieldId=a+"_decfield";this.deltakw=this.alphakw=null;this.radec=c.radec;this.getTableAttUrl=d;this.radec?this.raHandler=function(a){this.setAlphaKeyword(a)}:void 0!=c.raHandler&&(this.raHandler=function(a){this.setAlphaKeyword(a);c.raHandler(a)});this.radec?this.decHandler=function(a){this.setDeltaKeyword(a)}:void 0!=c.decHandler&&(this.decHandler=function(a){this.setDeltaKeyword(a);c.decHandler(a)})}
TapFieldList_mVc.prototype=Object.create(TapColList_mVc.prototype,{draw:{value:function(){var a=this;this.attributesHandlers=[];var b="";this.radec&&(b+='<div id="div-'+this.raFieldId.substring(0,this.raFieldId.length-8)+'"> <div>    <span class="help" style="margin-left:5px;">ra&nbsp;&nbsp;</span>    <div id="'+this.raFieldId+'"  style="display:inline-block;"/> </div> <div>    <span class="help"  style="margin-left:5px;">dec&nbsp;</span>    <div id="'+this.decFieldId+'"  style="display:inline-block;"/> </div> </div>');
this.parentDiv.html('<div class=fielddiv> <div class="fieldlist" id="'+this.fieldListId+'" style="height: 175px"></div> <div class="form-group" style="width:347px; margin-bottom:8px; margin-top: 8px;"><div class="input-group"><div class="input-group-addon input-sm"><span class="glyphicon glyphicon-search"></span></div> <input id="'+this.fieldFilterId+'" class="form-control input-sm" type="text" placeholder="Search"/></div></div>  <div  style="width: 350px; margin: 3px;">\t\t   <div class="form-group form-inline"><label for="tapColEditor_tableSelect">Join with table:</label>        <select id="'+
this.tableselectid+'"  class="table_filter form-control input-sm"  style="width: 250px">        </select></div>  </div>'+b+"  </div>");$("#"+this.fieldFilterId).keyup(function(){a.filterPattern=RegExp($(this).val(),"i");a.fireFilter()});$("#"+this.fieldFilterId).one("click",function(){$(this).css("color","black");$(this).css("font-style","");$(this).attr("value","")});this.setChangeTableHandler()}},setTreePath:{value:function(a){this.dataTreePath=a;$("#"+this.fieldListId).html("");$("#"+this.tableselectid).html("");
$("#"+this.raFieldId).html("");this.alphakw=null;$("#"+this.decFieldId).html("");this.deltakw=null;this.addTableOption(this.dataTreePath);this.changeTable(this.dataTreePath);this.joinedTableLoaded=!1}},changeTable:{value:function(a){this.dataTreePath=a;this.displayFields()}},resetPosKeywords:{value:function(a){$("#"+this.raFieldId).html("");this.alphakw=null;$("#"+this.decFieldId).html("");this.deltakw=null}},lookForAlphaKeyword:{value:function(a){for(var b in this.attributesHandlers)if(a=this.attributesHandlers[b],
"pos.eq.ra;meta.main"==a.ucd){this.setAlphaKeyword(b);return}for(b in this.attributesHandlers)if(a=this.attributesHandlers[b],"pos.eq.ra"==a.ucd||a.ucd.match(/POS_EQ_RA/i)){this.setAlphaKeyword(b);return}for(b in this.attributesHandlers)if(a=this.attributesHandlers[b],"s_ra"==a.nameattr||"pos_ra_csa"==a.nameattr||"_sc_ra"==a.nameattr||"RA"==a.nameattr.toUpperCase()||"RAJ2000"==a.nameattr.toUpperCase()){this.setAlphaKeyword(b);break}}},setAlphaKeyword:{value:function(a){$("#"+this.raFieldId).html("");
this.alphakw=new TapKWSimpleConstraint_mVc({divId:this.raFieldId,constListId:this.raFieldId,isFirst:!0,attributeHandler:this.attributesHandlers[a],editorModel:null,defValue:"",treePath:jQuery.extend({},this.dataTreePath)});this.alphakw.fireInit()}},getRaKeyword:{value:function(a){return $("#"+this.raFieldId+" span").text()}},lookForDeltaKeyword:{value:function(a){for(var b in this.attributesHandlers)if(a=this.attributesHandlers[b],"pos.eq.dec;meta.main"==a.ucd){this.setDeltaKeyword(b);return}for(b in this.attributesHandlers)if(a=
this.attributesHandlers[b],"pos.eq.dec"==a.ucd||a.ucd.match(/POS_EQ_DEC/i)){this.setDeltaKeyword(b);return}for(b in this.attributesHandlers)if(a=this.attributesHandlers[b],"s_dec"==a.nameattr||"pos_dec_csa"==a.nameattr||"_sc_dec"==a.nameattr||"DEC"==a.nameattr.toUpperCase()||"DECJ2000"==a.nameattr.toUpperCase()){this.setDeltaKeyword(b);break}}},setDeltaKeyword:{value:function(a){$("#"+this.decFieldId).html("");this.deltakw=new TapKWSimpleConstraint_mVc({divId:this.decFieldId,constListId:this.decFieldId,
isFirst:!0,attributeHandler:this.attributesHandlers[a],editorModel:null,defValue:"",treePath:jQuery.extend({},this.dataTreePath)});this.deltakw.fireInit()}},getDeltaKeyword:{value:function(a){return $("#"+this.decFieldId+" span").text()}}});console.log("=============== >  FieldList_v.js ");
function Sorter_mVc(a,b,c,d,e){this.container=a;this.scrollPaneSelector=null;this.scrollLeft=0;this.parentContainer=b;this.fieldAh=c;this.handler=null==d?function(a,b){alert("Sort command: "+a+" "+b)}:d;this.scrollHandler=e}
Sorter_mVc.prototype={draw:function(){var a=this;this.container.html("<div style='display: inline;'><div class=sorter><a class=sort_asc_disabled href='#'></a><a class=sort_desc_disabled href='#'></a></div><span class=sorter>"+this.fieldAh.nameorg+"</span></div>");this.container.find("a").click(function(){var b=$(this);a.enableDisable(b);b=b.attr("class");"sort_asc"==b?a.handler(a.fieldAh.nameattr,"asc"):"sort_desc"==b?a.handler(a.fieldAh.nameattr,"desc"):a.handler(a.fieldAh.nameattr,null);null!=a.scrollPaneSelector&&
null!=a.scrollHandler&&(b=$(a.scrollPaneSelector).scrollLeft(),a.scrollHandler(b))})},setScrollPaneSelector:function(a){this.scrollPaneSelector=a},enableDisable:function(a){var b=a.attr("class");this.parentContainer.find("a").each(function(){var a=$(this),b=a.attr("class");"sort_asc"==b?a.attr("class","sort_asc_disabled"):"sort_desc"==b&&a.attr("class","sort_desc_disabled")});a.attr("class","sort_asc_disabled"==b?"sort_asc":"sort_asc"==b?"sort_asc_disabled":"sort_desc_disabled"==b?"sort_desc":"sort_desc_disabled")},
activeArrow:function(a){this.container.find("a").each(function(){var b=$(this),c=b.attr("class");"sort_asc_disabled"==c&&a?b.attr("class","sort_asc"):"sort_desc_disabled"!=c||a||b.attr("class","sort_desc")})}};console.log("=============== >  Sorter_v.js ");function DataLink_Mvc(){this.formEntries=[];this.listener=null}
DataLink_Mvc.prototype={addListener:function(a){this.listener=a},storeWebService:function(a,b){this.formEntries[a]={url:b,loaded:!1}},getUrl:function(a){return null==this.formEntries[a]?null:this.formEntries[a].url},webServiceLoaded:function(a){null!=this.formEntries[a]&&(this.formEntries[a].loaded=!0)},isWebServiceLoaded:function(a){return null==this.formEntries[a]?!1:this.formEntries[a].loaded}};console.log("=============== >  DataLink_m.js ");var linkVocabulary=[];linkVocabulary["#this"]="the primary (as opposed to related) data of the identified resource";
linkVocabulary["#progenitor"]="data resources that were used to create this dataset (e.g. input raw data)";linkVocabulary["#derivation"]="data resources that are derived from this dataset (e.g. output data products)";linkVocabulary["#auxiliary"]="auxiliary resources";linkVocabulary["#weight"]="Weight map: resource with array(s) containing weighting values";linkVocabulary["#error"]="Error map: resource with array(s) containing error values";linkVocabulary["#noise"]="Noise map: resource with array(s) containing noise values";
linkVocabulary["#calibration"]="Calibration data\tresource used to calibrate the primary data";linkVocabulary["#bias"]="Bias calibration data used to subtract the detector offset level";linkVocabulary["#dark"]="Dark calibration data used to subtract the accumulated detector dark current";linkVocabulary["#flat"]="Flat field calibration data\tused to calibrate variations in detector sensitivity";linkVocabulary["#preview"]="low fidelity but easily viewed representation of the data";
linkVocabulary["#preview-image"]="preview of the data as a 2-dimensional image";linkVocabulary["#preview-plot"]="preview of the data as a plot (e.g. spectrum or light-curve)";linkVocabulary["#proc"]="Processing server-side data processing result";linkVocabulary["#cutout"]="Cutout a subsection of the primary data";function DataLink_mVc(a){this.parentDiv=$("#"+a.parentDivId);this.baseurl=a.baseurl;this.forwardurl=a.forwardurl;this.textareaid=a.parentDivId+"_text";this.listener=null}
DataLink_mVc.prototype={addListener:function(a){this.listener=a},draw:function(){var a=this,b=null!=this.forwardurl?this.forwardurl+"?target="+encodeURIComponent(this.baseurl):this.baseurl;Processing.show("Fetching Datalink Description at "+b);$.ajax({type:"GET",url:b,dataType:"xml",error:function(a,d,e){Processing.hide();Modalinfo.error(b+"\n"+a.responseText+"\n"+e)},success:function(b){Processing.hide();0!=$(b).find("VOTABLE").length?a.processVOTABLEResponse(b):a.processXMLResponse(b)}})},processVOTABLEResponse:function(a){var b=
"",c=!1;$(a).find("TR").each(function(){var a=0,e="",f="",g="",h="",l="",m="";$(this).find("TD").each(function(){c=!0;switch(a){case 0:e=$(this).text();break;case 1:f=$(this).text();break;case 2:h=$(this).text();break;case 3:g=$(this).text();break;case 4:l=$(this).text();break;case 5:m=$(this).text()}a++});b+="<fieldset>";b+="  <legend style='border-bottom: 0px; border-top: 1px solid #e5e5e5;'><span style='fontweight: bold;'>Link <i>"+h+"</i> <span></legend>";b+="    <a class='dlinfo' title='Get info about' href='#' onclick='LinkProcessor.fireGetProductInfo(\""+
this.linkInstance.access_url+"\"); return false;'></a>";b+="    <a class=dldownload href='#' onclick='PageLocation.changeLocation(&quot;"+f+"&quot);' title='Download link target'></a>";b+="    <span class=help>"+g+"</span><br>";b+="    <span class=help><b>Product URI:</b> "+e+"</span><br>";b+="    <span class=help><b>Content:</b> "+l+" "+(0==m?"":m+"b")+"</span>";b+="</fieldset>"});c?(Modalcommand.commandPanel("Link Browser",b),$("div.datalinkform").toggle(),Modalcommand.setDivToggling(function(){that.buildWebserviceForm($(this).attr("id"))})):
Modalinfo.info("No link available","Datalink Info")},processXMLResponse:function(a){var b=this,c="";$(a).find("endpoint").each(function(){var a=$(this).attr("type"),e=$(this).attr("datatype");c+="<fieldset>";c+="  <legend><span>Link <i>"+$(this).attr("name")+"</i> ("+e+")<span></legend>";"download"==a?c+=b.buildDownloadForm($(this),e):"webservice"==a?c+=b.buildWebserviceEntry($(this)):Modalinfo.error("Unknown link type "+a);c+="</fieldset>"});Modalcommand.commandPanel("Link Browser",c);$("div.datalinkform").toggle();
Modalcommand.setDivToggling(function(){b.buildWebserviceForm($(this).attr("id"))})},buildDownloadForm:function(a,b){var c=null!=this.forwardurl?this.forwardurl+encodeURIComponent(a.find("url").text()):a.find("url").text(),c=a.find("url").text(),c="<div>"+("    <a class=dldownload href='#' onclick='"+("preview"==b?"Modalinfo.openIframePanel(&quot;"+c+"&quot);":"PageLocation.changeLocation(&quot;"+c+"&quot);")+"' title='Download link target'></a>")+("    <span class=help>"+a.find("description").text()+
"</span>");return c+="</div>"},buildWebserviceEntry:function(a){var b=a.find("url").text(),c=null!=this.forwardurl?this.forwardurl+encodeURIComponent(b):b,d=a.attr("name");this.fireStoreWebService(d,b);b=a.find("description").text();return"<div id="+d+" class=datalinkform >    <ul>      <li>Decription "+b+"</li>      <li>type "+a.attr("type")+"</li>      <li>URL <a href='#' onclick='Modalinfo.openIframePanel(&quot;"+c+"&quot, &quot;"+b+"&quot);'>click</a></li>    </ul></div>"},buildWebserviceForm:function(a){if(null!=
a&&!this.fireIsWebServiceLoaded(a)){var b=null!=this.forwardurl?this.forwardurl+"?target="+encodeURIComponent(this.fireGetUrl(a)):this.fireGetUrl(a),c=this,d=[],e=[];Processing.show("Build form for webservice "+a);$.ajax({type:"GET",url:b,dataType:"xml",error:function(a,c,d){Processing.hide();Modalinfo.error(b+"\n"+a.responseText+"\n"+d)},success:function(b){Processing.hide();$("#"+a).html("");var g=$(b).find("baseurl").text(),h="",h=h+("    <a class=dldownload href='#' id='"+a+"_submit' title='Submit the query'></a>"),
h=h+("    <span class=help>"+$(b).find("description").first().text()+"</span><br>");$("#"+a).append(h);$(b).find("parameter").each(function(){var b=$(this).attr("name"),f=a+"_"+$(this).attr("name");h="    <span><b>"+b+"</b></span>";h+="    <span class=help>"+$(this).find("description").text()+"</span><br>";var g=$(this).find("range"),p=g.attr("type");if("enum"==p)h+="&nbsp;&nbsp;<span>Value</span>&nbsp;",h+="<select id="+f+"_input>",$(g).find("value").each(function(){var a="default"==$(this).attr("type")?
"selected":"";h+="<option "+a+">"+$(this).text()+"</option>"}),h+="</select><br>",e.push(b);else if("range"==p){var u=0,n=0,q=0;$(g).find("value").each(function(){var a=$(this).attr("type");"default"==a?q=$(this).text():"min"==a?u=$(this).text():"max"==a&&(n=$(this).text())});var g=parseFloat(u),p=parseFloat(n),v=parseFloat(q);g>=p||v<g||v>p?Modalinfo.error("Unconsistant range (min="+u+" max="+n+" def="+q+") no input for this parameter"):(h+='&nbsp;&nbsp;<label for="amount">Value</label> <input type="text" id="'+
f+'_input" style="width: 50px; border: 0;font-weight: bold;" value="'+q+'"/><div style="display: inline-block;width: 300px" id="'+f+'"></div><br>',d[f]={id:f,min:g,max:p,def:v},e.push(b))}else Modalinfo.error("Unconsistant range type "+p+" no input for this parameter");$("#"+a).append(h);for(var w in d)b=d[w],$("#"+b.id).slider({range:"min",value:b.def,min:b.min,max:b.max,step:(b.max-b.min)/20,slide:function(a,b){$("#"+$(this).attr("id")+"_input").val(b.value)}});c.fireWebServiceLoaded(a)});$("#"+
a+"_submit").click(function(){for(var b=g,c=0;c<e.length;c++)b+="&"+e[c]+"="+$("#"+a+"_"+e[c]+"_input").val();Modalinfo.openIframePanel(b,a)})}})}},fireGetQuery:function(){return $("#"+this.textareaid).val()},fireStoreWebService:function(a,b){this.listener.controlStoreWebService(a,b)},fireGetUrl:function(a){return this.listener.controlGetUrl(a)},fireWebServiceLoaded:function(a){this.listener.controlWebServiceLoaded(a)},fireIsWebServiceLoaded:function(a){return this.listener.controlIsWebServiceLoaded(a)}};
function CompliantDataLink_mVc(a){DataLink_mVc.call(this,a);this.dataObject="dataobject"in a?a.dataobject:{};this.linkMap=[]}
CompliantDataLink_mVc.prototype=Object.create(DataLink_mVc.prototype,{draw:{value:function(){var a=this,b=null!=this.forwardurl?this.forwardurl+"?target="+encodeURIComponent(this.baseurl):this.baseurl;Processing.show("Fetching Compliant Datalink Description at "+b);$.ajax({type:"GET",url:b,dataType:"xml",error:function(a,d,e){Processing.hide();Modalinfo.error(b+"\n"+a.responseText+"\n"+e)},success:function(c){Processing.hide();0!=$(c).find("VOTABLE").length?a.processVOTABLEResponse(c):Modalinfo.error(b+
"\n doesn't look like a VOTable")}})}},processVOTABLEResponse:{value:function(a){var b=this;$(a).find('RESOURCE[type="results"]').each(function(){var c=[];$(this).find("FIELD").each(function(){var a=$(this).attr("ID");void 0!=a?c.push(a):c.push($(this).attr("name"))});$(this).find("TR").each(function(d){var e=0,l={};$(this).find("TD").each(function(){l[c[e]]=$(this).text().trim();e++});b.linkMap.push(new Link_mVc(l,a,d))})});for(var c="<span class='help'> (click on titles to expand links)</span><br>",
d=0;d<this.linkMap.length;d++)console.log(this.linkMap[d].async),this.linkMap[d].async||(c+=this.linkMap[d].getHtml());Modalcommand.commandPanel("Link Browser",c);Modalcommand.setDivToggling();Modalcommand.collapseDiv();for(var e in this.linkMap)this.linkMap[e].async||(this.linkMap[e].buildSliders(),this.linkMap[e].buildRegionEditors(this.dataObject))}},setCutoutRegion:{value:function(a){str="POLYGON ICRS ";a=a.region.points;for(var b=0;b<a.length;b++)str+=a[b][0]+" "+a[b][1]+" ";$("textarea[name=cutout]").text(str)}}});
function Link_mVc(a,b,c){this.linkInstance=a;this.params=[];this.index=c;this.sliders=[];this.aladins=[];this.xml=b;this.async=!1;this.setParams()}
Link_mVc.prototype={setParams:function(){var a=this;"#"!=a.linkInstance.service_def&&$(this.xml).find('RESOURCE[ID="'+a.linkInstance.service_def+'"]').each(function(){$(this).find('PARAM[name="accessURL"]').each(function(){a.linkInstance.access_url=$(this).attr("value")});$(this).find('PARAM[name="standardID"]').each(function(){$(this).attr("value").match(/.*async.*/)&&(a.async=!0)});$(this).find('GROUP[name="inputParams"]').each(function(){$(this).find("PARAM").each(function(){var b={xml:$(this),
value:""},c=$(this),d=c.find("VALUES");null!=c.attr("ref")?(c=c.attr("ref"),b.value=a.getFieldValueByRef(c)):null!=c.attr("value")?b.value=c.attr("value"):0==d.length&&(c=c.attr("name"),b.value=a.getFieldValueByName(c));a.params.push(b)})})})},getFieldValueByRef:function(a){var b=this,c=-1,d=null;$(this.xml).find("FIELD").each(function(b){$(this).attr("ID")==a&&(c=b)});$(this.xml).find("TR").each(function(a){a==b.index&&$(this).find("TD").each(function(a){a==c&&(d=$(this).text())})});return d},getFieldValueByName:function(a){var b=
this,c=-1,d=null;$(this.xml).find("FIELD").each(function(b){$(this).attr("name")==a&&(c=b)});$(this.xml).find("TR").each(function(a){a==b.index&&$(this).find("TD").each(function(a){a==c&&(d=$(this).text())})});return d},getSimpleLinkAction:function(){return"application/x-votable+xml;content=datalink"==this.linkInstance.content_type?"<a class='dlinfo' title='Get info about' href='#' onclick='LinkProcessor.fireGetProductInfo(\""+this.linkInstance.access_url+"\"); return false;'></a><a class=dldownload href='#' onclick='DataLinkBrowser.startCompliantBrowser(&quot;"+
this.linkInstance.access_url+"&quot)' title='Download link target'></a>":this.linkInstance.semantics.endsWith("#preview")?"<a class='dlinfo' title='Get info about' href='#' onclick='LinkProcessor.fireGetProductInfo(\""+this.linkInstance.access_url+"\"); return false;'></a><a class=dldownload href='#' onclick='Modalinfo.openIframePanel(&quot;"+this.linkInstance.access_url+"&quot)' title='Download link target'></a>":this.linkInstance.semantics.endsWith("#proc")||this.linkInstance.semantics.endsWith("#this")?
"<a class='dlinfo' title='Get info about' href='#' onclick='LinkProcessor.fireGetProductInfo(\""+this.linkInstance.access_url+"\"); return false;'></a><a class=dldownload href='#' onclick='PageLocation.changeLocation(&quot;"+this.linkInstance.access_url+"&quot)' title='Download link target'></a><a class='dlivoalogo'  href='#' onclick='LinkProcessor.processToSampWithParams(\""+this.linkInstance.access_url+'", "'+this.linkInstance.semantics+"\");' title='broadcast to SAMP'></a>":"<a class='dlinfo' title='Get info about' href='#' onclick='LinkProcessor.fireGetProductInfo(\""+
this.linkInstance.access_url+"\"); return false;'></a><a class=dldownload href='#' onclick='Modalinfo.openIframePanel(&quot;"+this.linkInstance.access_url+"&quot)' title='Download link target'></a>"},getHtml:function(){if(0==this.params.length)var a="",a=a+"<fieldset>",a=a+("  <legend style='margin-bottom: 5px;border-top: 1px solid #e5e5e5;'><span style='font-weight: bold;'>Link <i style='font-weight: normal;'>"+this.linkInstance.semantics+"</i> <span></legend><div class=datalinkform>"),a=a+this.getDescriptionSpan(),
a=a+this.getSimpleLinkAction();else{for(var a="",a=a+("<fieldset name='"+this.linkInstance.semantics+"'>"),a=a+("  <legend style='margin-bottom: 5px;border-top: 1px solid #e5e5e5;'><span style='font-weight: bold;' title='Click on the link name to toggle'>Link <i style='font-weight: normal;'>"+this.linkInstance.semantics+"</i></legend><div class=datalinkform>"),a=a+this.getDescriptionSpan(),b=0;b<this.params.length;b++){var c=this.params[b],d=c.xml.attr("name"),e=c.xml.attr("datatype"),f=d+"_"+this.index,
g=f+"_input",h=f+"_input_slider",l=!1,m,r,p;r=0!=(p=$(c.xml).find("DESCRIPTION")).length?$(p[0]).html():"no description provided";if(null!=c.value&&""!=c.value)a+="<div id='param_"+d+"'>   <span><b>"+d+"</b></span>&nbsp;<span class=help>"+r+"</span><br><input id='"+g+"' readonly style='width: 100%;' type='text' value='"+c.value+"' name='"+c.xml.attr("name")+"'></div>";else if("stc:AstroCoordArea"==c.xml.attr("xtype")&&"circle"!=c.xml.attr("xtype")||"polygon"==c.xml.attr("xtype")){var l=f+"_aladin",
a=a+("<div id='param_"+d+"'><input type='checkbox' name='takeit' value='takeit' title='uncheck to ignore the parameter' checked><span id='cutoutParam'>&nbsp;<b>"+d+"</b></span>&nbsp;<span class=help> "+r+"</b></span><br><textarea id='"+g+"' style='width:100%;' rows='3' name='"+d+"'></textarea><br><div id='"+l+"' style='width: 400px; height: 470px'></div></div>"),u,d="";0!=(m=$(c.xml).find("VALUES")).length&&(u=$(m).find("MAX"))&&(d=$(u).attr("value"));this.aladins.push({div:l,envelope:d});l=!0}else if(0!=
(m=$(c.xml).find("VALUES")).length)if(0!=(c=$(m).find("MIN")).length&&0!=(u=$(m).find("MAX")).length){$(c).attr("value");$(u).attr("value");var c=parseFloat(c.attr("value")),n=parseFloat(u.attr("value")),f=this.getScaleFactor(c),n=this.getScaleFactor(n),c=f.normValue,n=n.normValue,q=d.endsWith("MIN")?c:d.endsWith("MAX")?n:(c+n)/2,q="int"==e?Math.round(q):q,a=a+("<div id='param_"+d+"'> <input type='checkbox' name='"+d+"' value='takeit' title='uncheck to ignore the parameter' checked>&nbsp;<span><b>"+
d+"</b></span>&nbsp;<span class=help>"+r+(1!=f.factor?" (* "+1/f.factor+")":"")+"</span><br>"),a=a+('&nbsp;&nbsp;<label for="amount">Value</label> <input type="text" name="'+d+'" id="'+g+'" size=10 style="border: 0;font-weight: bold;" value="'+Math.round(1E3*q)/1E3+'"/> <input  type="hidden" value="'+f.factor+'" id="'+d+'_input_factor"/><div style="display: inline-block;width: 300px" id="'+h+'"></div></div>');this.sliders[h]={id:g,type:e,min:c,max:n,def:q,scaleFactor:f.factor}}else 0!=(e=$(m).find("OPTION")).length?
(a+="<div id='param_"+d+"'> <input type='checkbox' name='"+d+"' value='takeit' title='uncheck to ignore the parameter' checked>&nbsp;<span><b>"+d+"</b></span>&nbsp;<span class=help>"+r+"</span><br>",a+=' <select type="text" name="'+d+'" id="'+g+'">',e.each(function(){var b=$(this).attr("name"),c=$(this).attr("value");""!=b&&(b="("+b+")");a+="  <option value='"+c+"'>"+c+" "+b+")</option>"}),a+=" </select></div>"):a=0!=(u=$(m).find("MAX")).length?a+("<div id='param_"+d+"'> <input type='checkbox' name='"+
d+"' value='takeit' title='uncheck to ignore the parameter' >&nbsp;<span class=help><b>"+d+"</b>&nbsp; "+r+'</span><br><input type="text" name="'+d+'" id="'+g+'" style="width: 100%;" value="'+u.attr("value")+'"/></div>'):a+(" <div id='param_"+d+"'> <input type='checkbox' name='takeit' value='takeit' title='uncheck to ignore the parameter' checked>&nbsp;<span class=help>"+d+"&nbsp;"+r+"</span><br>FREE</div>")}a+="    <a class='dlinfo' title='Get info about' href='#' onclick='LinkProcessor.infoWithParams(\""+
this.linkInstance.access_url+'", "'+this.linkInstance.semantics+"\"); return false;'></a>";a+="    <a class=dldownload    href='#' onclick='LinkProcessor.processWithParams(\""+this.linkInstance.access_url+'", "'+this.linkInstance.semantics+"\");' title='Download link target'></a>";a+="    <a class='dlivoalogo'  href='#' onclick='LinkProcessor.processToSampWithParams(\""+this.linkInstance.access_url+'", "'+this.linkInstance.semantics+"\");' title='broadcast to SAMP'></a><BR>";l&&(a+="    <span class='help'>Draw counter-clockwise please</span>\n")}return a+=
"</div></fieldset>"},buildSliders:function(){for(sliderId in this.sliders){var a=this.sliders[sliderId],b;b="int"!=a.type?function(a,b){$("#"+$(this).attr("id").replace("_slider","_factor")).attr("value");var e=Math.round(1E3*b.value)/1E3;$("#"+$(this).attr("id").replace("_slider","")).val(e)}:function(a,b){$("#"+$(this).attr("id").replace("_slider","_factor")).attr("value");var e=Math.round(b.value);$("#"+$(this).attr("id").replace("_slider","")).val(e)};$("#"+sliderId).slider({range:"min",value:a.def,
min:a.min,max:a.max,step:(a.max-a.min)/20,slide:b})}},buildRegionEditors:function(a){for(var b=0;b<this.aladins.length;b++){var c=this.aladins[b].div,d=this.aladins[b].envelope;if(0!=c.length){var e=new RegionEditor_mVc(c,function(a){str="";a=a.region.points;for(var b=0;b<a.length-1;b++)str+=parseFloat(a[b][0]).toFixed(6)+" "+parseFloat(a[b][1]).toFixed(6)+" ";$("#"+c.replace("aladin","input")).text(str)},[a.s_ra,a.s_dec]);e.init();if(d){var d=d.split(/\\s+/),f=d.length-1;d[0]==d[f-1]&&d[1]==d[f]&&
(d.pop(),d.pop());e.setEditionFrame({type:"soda",value:"POLYGON "+d.join(" ")});$("#"+c.replace("aladin","input")).text(d.join(" "))}}}},getScaleFactor:function(a){var b=a,c=1;if(-1<a&&1>a)a=10;else return{normValue:b,factor:1};for(;10==a&&-1<b&&1>b||0.1==a&&(10<b||-10>b);)b*=a,c*=a;return{normValue:b,factor:c}},getDescriptionSpan:function(){var a="",b=linkVocabulary[this.linkInstance.semantics];void 0!=b&&(a+="    <span class=help>"+b);0<this.linkInstance.description.length&&(a=0<a.length?a+"<br>":
a+"    <span class=help>",a+=this.linkInstance.description);0<a.length&&(a+="</span><br>");return a}};
LinkProcessor=function(){var a=function(a,c){var d=[];$("fieldset[name='"+c+"']").find("div[id^=param_]").each(function(){var a=$(this).children("input[type=checkbox]"),b=$(this).attr("id").replace("param_","");if(void 0!=b&&null!=b&&""!=b&&(0==a.length||a.prop("checked"))){$(this).attr("id");var a=$(this).find("#"+b+"_input_factor").first(),c=$(this).children('input[type="text"], textarea').val();c?(0!=a.length&&(c/=a.attr("value")),d.push(b+"="+encodeURIComponent(c))):$(this).find("select").each(function(){var a=
$(this).val();d.push(b+"="+encodeURIComponent(a))})}});console.log(d);console.log(d.join("&"));return a+"?"+d.join("&")};return{processWithParams:function(b,c){PageLocation.download(a(b,c))},infoWithParams:function(b,c){Modalinfo.info(a(b,c),"Service Info")},processToSampWithParams:function(a,c){var d=$("fieldset[name="+c+"]"),e=[];d.find("input[type='text']").each(function(){var a=$(this).attr("id"),a=$("#"+a+"_factor"),a=0==a.length?$(this).val():$(this).val()/a.attr("value");e.push($(this).attr("name")+
"="+encodeURIComponent(a))});d.find("select").each(function(){$(this).attr("id");var a=$(this).val();e.push($(this).attr("name")+"="+encodeURIComponent(a))});d=a+"?"+e.join("&");WebSamp_mVc.fireSendVoreport(d,null,null)},fileDownload:function(a){$.fileDownload($(this).prop(a),{preparingMessageHtml:"We are preparing your report, please wait...",failMessageHtml:"There was a problem generating your report, please try again."})},fireGetProductInfo:function(a){Processing.show("Waiting on product info");
$.getJSON("getproductinfo",{jsessionid:"",url:a},function(c){Processing.hide();Processing.jsonError(c,"Cannot get product info")||(retour="url: "+a+"\n",$.each(c,function(a,b){retour+=a+": "+b+"\n"}),Modalinfo.info(retour,"Product Info"))})}}}();console.log("=============== >  DataLink_v.js ");
DataLink_mvC=function(a,b){a.addListener({controlStoreWebService:function(a,d){return b.storeWebService(a,d)},controlGetUrl:function(a){return b.getUrl(a)},controlWebServiceLoaded:function(a){b.webServiceLoaded(a)},controlIsWebServiceLoaded:function(a){return b.isWebServiceLoaded(a)}});b.addListener({})};console.log("=============== >  DataLink_c.js ");
function ConstQEditor_Mvc(){this.listener={};this.const_key=1;this.attributeHandlers=[];this.attributeHandlersSearch=[];this.editors={};this.constEditorRootId="kwconsteditor_"}
ConstQEditor_Mvc.prototype={addListener:function(a){this.listener=a},loadFields:function(a){var b=this;this.attributesHandlers={};a&&MetadataSource.getTableAtt(a,function(){var c=MetadataSource.ahMap(a);b.attributeHandlersSearch=[];for(var d=0;d<c.length;d++){var e=c[d];b.attributeHandlersSearch.push(e);b.attributeHandlers[e.nameattr]=e}})},addPresetValues:function(){},clearAllConst:function(){this.const_key=1;this.editors={};this.notifyTypoMsg(!1,"");this.updateQuery()},clearConst:function(a){this.notifyTypoMsg(!1,
"");for(var b in this.editors)b.match(a)&&(delete this.editors[b],this.const_key--);this.updateQuery()},edit:function(){return this.editors},processAttributeEvent:function(a,b){this.processAttributeHandlerEvent(this.attributeHandlers[a],b)},processAttributeHandlerEvent:function(a,b){var c=!0;for(k in this.editors){c=!1;break}var d=this.constEditorRootId+a.nameattr+this.const_key;Out.debug("mv constraint "+a.nameattr+" to #"+b);c=new KWConstraint_mVc({divId:d,constListId:b,isFirst:c,attributeHandler:a,
editorModel:this,defValue:""});this.editors[d]=c;c.fireInit();this.const_key++},processRemoveFirstAndOr:function(a){delete this.editors[a];for(var b in this.editors){this.editors[b].fireRemoveAndOr();break}},notifyNextListener:function(a){this.listener.nextListener(a)},updateQuery:function(){var a="    ",b;for(b in this.editors){var c=this.editors[b].fireGetADQL();96<a.length&&(a+="\n    ");null!=c&&(a+=" "+$.trim(this.editors[b].fireGetADQL()))}this.listener.controlUpdateQuery(a)},getNumberOfEditor:function(){var a=
0,b;for(b in this.editors)a++;return a},notifyRunQuery:function(){this.listener.controlRunQuery()},notifyTypoMsg:function(a,b){this.listener.controlTypoMsg(a,b)},notifyFieldsStored:function(){this.listener.controlFieldsStored(this.attributeHandlersSearch)},getAttributeHandlers:function(){return this.attributeHandlers},getDefaultValue:function(){return null}};function UcdQEditor_Mvc(){ConstQEditor_Mvc.call(this)}
UcdQEditor_Mvc.prototype=Object.create(ConstQEditor_Mvc.prototype,{processAttributeEvent:{value:function(a,b){var c=this.attributeHandlers[a];if(null==c)Out.info("No AH referenced by "+a);else{var d=!0;for(k in this.editors){d=!1;break}Out.debug("mv UCD constraint "+a+" to #"+b);var e=this.constEditorRootId+a+this.const_key,c=new UCDConstraint_mVc({divId:e,constListId:b,isFirst:d,attributeHandler:c,editorModel:this,defValue:""});this.editors[e]=c;c.fireInit();this.const_key++}}},loadFields:{value:function(a){var b=
this;this.attributesHandlers={};a&&MetadataSource.getTableAtt(a,function(){var c=MetadataSource.ahMap(a);b.attributeHandlersSearch=[];for(var d=0;d<c.length;d++){var e=c[d];b.attributeHandlersSearch.push(e);b.attributeHandlers[e.ucd]=e}})}},updateQuery:{value:function(){var a="",b="",c;for(c in this.editors){var d=this.editors[c].fireGetADQL();null!=d&&(a+=b+d,""==b&&(b="\n        AND "))}this.listener.controlUpdateQuery(a)}}});
function UcdPatternEditor_Mvc(a){UcdQEditor_Mvc.call(this);this.relationName=a}UcdPatternEditor_Mvc.prototype=Object.create(UcdQEditor_Mvc.prototype,{updateQuery:{value:function(){var a="",b="",c;for(c in this.editors){var d=this.editors[c].fireGetADQL();null!=d&&(a+=b+d,""==b&&(b="\n        AND "))}""!=a&&(a="  matchPattern {"+this.relationName+",\n    AssUCD{"+a+"}\n  }");this.listener.controlUpdateQuery(a)}}});function PosQEditor_Mvc(){ConstQEditor_Mvc.call(this,null)}
PosQEditor_Mvc.prototype=Object.create(ConstQEditor_Mvc.prototype,{processAttributeEvent:{value:function(a,b){if(null!=a){var c={nameorg:a.position,nameattr:"region"==a.type?"region":a.position.replace(/[^0-9a-zA-Z_]+/g,"_"),ucd:"",unit:"",comment:"cone search",radius:a.radius,frame:a.frame,value:a.position},d=this.constEditorRootId+c.nameattr;null!=this.editors[d]&&this.editors[d].drop();var e=!0;for(k in this.editors){e=!1;break}c=new PosConstraint_mVc({divId:d,constListId:b,isFirst:e,attributeHandler:c,
editorModel:this,defValue:""});this.editors[d]=c;c.fireInit()}}},storeFields:{value:function(a){this.attributeHandlers=[];this.attributeHandlersSearch=[];for(var b=0;b<a.attributes.length;b++)this.attributeHandlers[a.attributes[b].ucd]=a.attributes[b],this.attributeHandlersSearch[this.attributeHandlersSearch.length]=a.attributes[b];this.notifyFieldsStored()}},updateQuery:{value:function(){var a="",b;for(b in this.editors)null!=this.editors[b].fireGetADQL()&&(""!=a&&(a+=",\n"),a+="    "+this.editors[b].fireGetADQL());
this.listener.controlUpdateQuery(a)}},getDefaultValue:{value:function(){for(var a in this.editors)return{type:"saadaql",value:this.editors[a].fireGetADQL()};return null}}});function CatalogueQEditor_Mvc(a){ConstQEditor_Mvc.call(this,a);this.relationName=a.relationName;this.qualifier=a.distanceQualifer;this.getMetaUrl=a.getMetaUrl}
CatalogueQEditor_Mvc.prototype=Object.create(ConstQEditor_Mvc.prototype,{loadFields:{value:function(){var a=this;null!=this.getMetaUrl?$.getJSON(this.getMetaUrl,function(b){a.storeFields(b)}):this.storeFields({attributes:[{ACDS_CATACRO:"ACDS_CATACRO",ACDS_CATCDSTB:"ACDS_CATCDSTB",ACDS_CATCONF:"ACDS_CATCONF",ACDS_CATINTNB:"ACDS_CATINTNB",ACDS_CATINTNB:"ACDS_CATINTNB",ACDS_CATNAME:"ACDS_CATNAME",ACDS_CDSCAT:"ACDS_CDSCAT",VIZIER_KW:"VIZIER_KW",CLASSNAME:"CLASSNAME"},{ACDS_CATACRO:"ACDS_CATACRO",ACDS_CATCDSTB:"ACDS_CATCDSTB",
ACDS_CATCONF:"ACDS_CATCONF",ACDS_CATINTNB:"ACDS_CATINTNB",ACDS_CATINTNB:"ACDS_CATINTNB",ACDS_CATNAME:"ACDS_CATNAME",ACDS_CDSCAT:"ACDS_CDSCAT",VIZIER_KW:"VIZIER_KW",CLASSNAME:"CLASSNAME2"}]})}},processAttributeEvent:{value:function(a,b){var c=this.attributeHandlers[a];if(null==c){Modalinfo.error("Internal error: No constraint referenced by the key '"+a+"' (see console)");var d=[];$.each(this.attributeHandlers,function(a,b){d.push(a)})}else{var e=!0;for(k in this.editors){e=!1;break}Out.debug("mv catalogue constraint "+
a+" to #"+b);var f=this.constEditorRootId+a;null!=this.editors[f]?Modalinfo.error("Constraint on "+a+" already active: cannot be duplicated"):(c=new CatalogueConstraint_mVc({divId:f,constListId:b,isFirst:e,attributeHandler:c,editorModel:this,defValue:"",qualifier:this.qualifier}),this.editors[f]=c,c.fireInit(),this.const_key++)}}},storeFields:{value:function(a){this.attributeHandlers=[];this.attributeHandlersSearch=[];for(var b=0;b<a.attributes.length;b++)this.attributeHandlers[a.attributes[b].CLASSNAME]=
a.attributes[b],this.attributeHandlersSearch[this.attributeHandlersSearch.length]=a.attributes[b];this.notifyFieldsStored()}},updateQuery:{value:function(){var a="",b;for(b in this.editors){var c=this.editors[b].fireGetADQL();null!=c&&""!=c&&(""!=a&&(a+="\n"),a+="    matchPattern { "+this.relationName+","+c+"}")}this.listener.controlUpdateQuery(a)}}});function CrossidQEditor_Mvc(a){CatalogueQEditor_Mvc.call(this,a)}
CrossidQEditor_Mvc.prototype=Object.create(CatalogueQEditor_Mvc.prototype,{processAttributeEvent:{value:function(a,b){var c=this.attributeHandlers[a];if(null==c){Modalinfo.error("Internal error: No constraint referenced by the key '"+a+"' (see console)");var d=[];$.each(this.attributeHandlers,function(a,b){d.push(a)})}else{var e=!0;for(k in this.editors){e=!1;break}Out.debug("mv catalogue constraint "+a+" to #"+b);var f=this.constEditorRootId+a;null!=this.editors[f]?Modalinfo.error("Constraint on "+
a+" already active: canot be duplicated"):(c=new CrossidConstraint_mVc({divId:f,constListId:b,isFirst:e,attributeHandler:c,editorModel:this,defValue:"",qualifier:this.qualifier}),this.editors[f]=c,c.fireInit(),this.const_key++)}}}});function tapColSelector_Mvc(){ConstQEditor_Mvc.call(this);this.dataTreePath=this.joinKeys=null;this.joinedTableLoaded=!1;this.orderBy=""}
tapColSelector_Mvc.prototype=Object.create(ConstQEditor_Mvc.prototype,{loadFields:{value:function(a,b){var c=this;a?(this.dataTreePath=jQuery.extend({},a),MetadataSource.getTableAtt(this.dataTreePath,function(a){c.notifyAddTableOption(c.dataTreePath);var e=a.hamap;c.attributeHandlers=[];c.attributeHandlersSearch=[];for(var f=0;f<e.length;f++){var g=e[f];c.attributeHandlers[g.nameattr]=g;c.attributeHandlersSearch[c.attributeHandlersSearch.length]=g}if(!c.joinedTableLoaded)for(c.joinKeys=[],a=a.targets,
f=0;f<a.length;f++)c.joinKeys.push(a[f]);b&&b()})):(this.attributeHandlers=[],this.attributeHandlersSearch=[],this.joinKeys=[],this.dataTreePath=null)}},notifyAddTableOption:{value:function(a){this.listener.controlAddTableOption(a)}},processAttributeHandlerEvent:{value:function(a,b){var c=!0,d=null;for(k in this.editors){c=!1;break}var d=this.listener.controlCurrentTreePath(),e=this.constEditorRootId+a.nameattr+this.const_key;Out.debug("mv constraint "+a.nameattr+" to #"+this.constListId);c=new TapKWSimpleConstraint_mVc({divId:e,
constListId:b,isFirst:c,attributeHandler:a,editorModel:this,defValue:"",treePath:jQuery.extend({},d)});this.editors[e]=c;c.fireInit();this.const_key++}},processOrderBy:{value:function(a){this.orderBy="OrderBy"!=a?a:"";this.updateQuery()}},updateQuery:{value:function(){var a=this.dataTreePath.schema+"."+this.dataTreePath.table,b=[],c=[],d;for(d in this.editors){var e=this.editors[d],f=e.treePath.schema+"."+e.treePath.table;c.push(e.fireGetADQL());if(f!=a)for(e=0;e<this.joinKeys.length;e++){var g=this.joinKeys[e].target_datatreepath.schema+
"."+this.joinKeys[e].target_datatreepath.table;g==f&&(b[f]=this.joinKeys[e])}}if(""!=this.orderBy&&(d=this.orderBy.split("."),f=d[0]+"."+d[1],f!=a))for(e=0;e<this.joinKeys.length;e++)g=this.joinKeys[e].target_datatreepath.schema+"."+this.joinKeys[e].target_datatreepath.table,g==f&&(b[f]=this.joinKeys[e]);0==c.length&&(c=["*"]);this.listener.controlUpdateQuery(c,b)}}});function tapQEditor_Mvc(){tapColSelector_Mvc.call(this)}
tapQEditor_Mvc.prototype=Object.create(tapColSelector_Mvc.prototype,{processAttributeHandlerEvent:{value:function(a,b){var c=!0,d=null;for(k in this.editors){c=!1;break}var d=this.listener.controlCurrentTreePath(),e=this.constEditorRootId+a.nameattr+this.const_key;Out.debug("mv constraint "+a.nameattr+" to #"+this.constListId);c=new TapKWConstraint_mVc({divId:e,constListId:b,isFirst:c,attributeHandler:a,editorModel:this,defValue:"",treePath:jQuery.extend({},d)});this.editors[e]=c;c.fireInit();this.const_key++}},
processInputCoord:{value:function(a,b,c,d,e,f,g){d=!0;var h=null;for(k in this.editors){d=!1;break}var h=this.listener.controlCurrentTreePath(),l="",m="";a.startsWith("poslist:")?(l="list params,"+c,m="POSLIST:"+a.replace("poslist:","")):(l=a+","+b+","+c,m="POSITION");a=this.constEditorRootId+"ADQLPos"+this.const_key;e=new TapKWConstraint_mVc({divId:a,constListId:g,isFirst:d,editorModel:this,attributeHandler:{nameattr:m,nameorg:m,type:"ADQLPos",ucd:"adql.coor.columns",utype:"",unit:"deg",description:e+
" "+f},defValue:l,treePath:jQuery.extend({},h)});this.editors[a]=e;e.fireInit();this.const_key++}},updateQuery:{value:function(){var a="    ",b=this.dataTreePath.schema+"."+this.dataTreePath.table,c=[],d;for(d in this.editors){var e=this.editors[d],f=e.fireGetADQL();96<a.length&&(a+="\n    ");if(null!=f)if(a+=this.editors[d].fireGetADQL()+" ",f=e.treePath.schema+"."+e.treePath.table,f!=b)for(e=0;e<this.joinKeys.length;e++){var g=this.joinKeys[e].target_datatreepath.schema+"."+this.joinKeys[e].target_datatreepath.table;
g==f&&(c[f]=this.joinKeys[e])}else e.fieldName.startsWith("POSLIST")&&(c[f]={target_table:"TAP_UPLOAD."+e.fieldName.replace("POSLIST:",""),target_column:"",source_column:""})}if(""!=this.orderBy&&(d=this.orderBy.split("."),f=d[0]+"."+d[1],f!=b))for(e=0;e<this.joinKeys.length;e++)g=this.joinKeys[e].target_datatreepath.schema+"."+this.joinKeys[e].target_datatreepath.table,g==f&&(c[f]=this.joinKeys[e]);this.listener.controlUpdateQuery(a,c)}}});
function tapPosQEditor_Mvc(){tapColSelector_Mvc.call(this)}
tapPosQEditor_Mvc.prototype=Object.create(tapColSelector_Mvc.prototype,{processAttributeHandlerEvent:{value:function(a,b){var c=!0,d=null;for(k in this.editors){c=!1;break}var d=this.listener.controlCurrentTreePath(),e=this.constEditorRootId+a.nameattr+this.const_key;Out.debug("mv constraint "+a.nameattr+" to #"+this.constListId);c=new TapKWConstraint_mVc({divId:e,constListId:b,isFirst:c,attributeHandler:a,editorModel:this,defValue:"",treePath:jQuery.extend({},d)});this.editors[e]=c;c.fireInit();
this.const_key++}},processInputCoord:{value:function(a,b,c,d,e,f,g){d=!0;var h=null;for(k in this.editors){d=!1;break}var h=this.listener.controlCurrentTreePath(),l="",m="";a.startsWith("poslist:")?(l="list params,"+c,m="POSLIST:"+a.replace("poslist:","")):(l=a+","+b+","+c,m="POSITION");a=this.constEditorRootId+"ADQLPos"+this.const_key;e=new TapKWConstraint_mVc({divId:a,constListId:g,isFirst:d,editorModel:this,attributeHandler:{nameattr:m,nameorg:m,type:"ADQLPos",ucd:"adql.coor.columns",utype:"",
unit:"deg",description:e+" "+f},defValue:l,treePath:jQuery.extend({},h)});this.editors[a]=e;e.fireInit();this.const_key++}},updateQuery:{value:function(){var a="    ",b=this.dataTreePath.schema+"."+this.dataTreePath.table,c=[],d;for(d in this.editors){var e=this.editors[d],f=e.fireGetADQL();96<a.length&&(a+="\n    ");if(null!=f)if(a+=this.editors[d].fireGetADQL()+" ",f=e.treePath.schema+"."+e.treePath.table,f!=b)for(e=0;e<this.joinKeys.length;e++){var g=this.joinKeys[e].target_datatreepath.schema+
"."+this.joinKeys[e].target_datatreepath.table;g==f&&(c[f]=this.joinKeys[e])}else e.fieldName.startsWith("POSLIST")&&(c[f]={target_table:"TAP_UPLOAD."+e.fieldName.replace("POSLIST:",""),target_column:"",source_column:""})}if(""!=this.orderBy&&(d=this.orderBy.split("."),f=d[0]+"."+d[1],f!=b))for(e=0;e<this.joinKeys.length;e++)g=this.joinKeys[e].target_datatreepath.schema+"."+this.joinKeys[e].target_datatreepath.table,g==f&&(c[f]=this.joinKeys[e]);this.listener.controlUpdateQuery(a,c)}}});console.log("=============== >  ConstQEditor_m.js ");
function ConstQEditor_mVc(a){var b=this;this.fieldsLoaded=!1;this.dataTreePath=null;this.listener={};this.queryView=a.queryView;this.parentDiv=$("#"+a.parentDivId);this.constContainerId=a.parentDivId+"_constcont";this.constListId="";this.formName=a.formName;this.orderById=a.parentDivId+"_orderby";this.fieldListView=new FieldList_mVc(a.parentDivId,this.formName,{stackHandler:function(a){b.fireAttributeEvent(a)},orderByHandler:function(a){b.fireOrderBy(a)}});this.constListView=new ConstList_mVc(a.parentDivId,
this.formName,this.constContainerId,function(a){b.fireClearAllConst()});this.orderByView=new OrderBy_mVc(a.parentDivId,this.formName,this.constContainerId,function(a){b.fireOrderBy(a)})}
ConstQEditor_mVc.prototype={addListener:function(a){this.listener=a},draw:function(){this.fieldListView.draw();this.parentDiv.append("<div id="+this.constContainerId+' style="width: 450px;float: left;background: transparent; display: inline;"></div>');this.constListId=this.constListView.draw({fieldset:"130px",div:"102px"});this.orderByView.draw()},fireSetTreepath:function(a){this.fieldListView.setStackTooltip("Click to select this field");this.dataTreePath=a;this.fieldListView.setDataTreePath(this.dataTreePath);
this.listener.controlLoadFields(this.dataTreePath)},fireOrderBy:function(a){"OrderBy"!=a?(this.orderByView.setOrderBy(a),this.orderByView.isDesc()&&(a+=" desc"),null!=this.queryView?this.queryView.fireAddConstraint(this.formName,"orderby",[a]):Out.info("No Query View OB:"+a)):this.queryView.fireDelConstraint(this.formName,"orderby")},fireAttributeEvent:function(a){this.listener.controlAttributeEvent(a,this.constListId);$("#"+this.constListId+" span.help").attr("style","display:none;")},fireClearAllConst:function(){this.constListView.fireClearAllConst();
this.orderByView.fireClearAllConst();this.fireOrderBy("OrderBy");this.listener.controlClearAllConst()},fireClearConst:function(a){this.constListView.fireClearConst(a);this.listener.controlClearConst(a)},fireGetNumberOfEditor:function(){var a=0;return a=this.listener.controlGetNumberOfEditor()},printTypoMsg:function(a,b){this.constListView.printTypoMsg(a,b)},isTypoGreen:function(){return constListView.printTypoMsg(fault,msg)},updateQuery:function(a){null!=this.queryView?this.queryView.fireAddConstraint(this.formName,
"column",a):Out.info("No Query View:"+JSON.stringify(a))},runQuery:function(){null!=this.queryView?this.queryView.runQuery():Out.info("No Query View")},getAttributeHandlers:function(){var a=0;return a=this.listener.controlGetAttributeHandlers()},getDefaultValue:function(){var a=0;return a=this.listener.controlGetDefaultValue()},fieldsStored:function(a){this.fieldListView.displayFields(a)}};
function UcdQEditor_mVc(a){ConstQEditor_mVc.call(this,a);var b=this;this.help=a.help;this.fieldListView=new UcdFieldList_mVc(a.parentDivId,this.formName,{stackHandler:function(a){b.fireAttributeEvent(a)},orderByHandler:function(a){b.fireOrderBy(a)}})}
UcdQEditor_mVc.prototype=Object.create(ConstQEditor_mVc.prototype,{draw:{value:function(){this.fieldListView.draw();this.parentDiv.append("<div id="+this.constContainerId+' style="background: transparent; width:450px;float: left;"></div>');this.constListId=this.constListView.draw({fieldset:"130px",div:"102px"});void 0!=this.help&&$("#"+this.constContainerId).append('<div style="width: 100%;"><span class=spanhelp>'+this.help+"</span></div>")}},updateQuery:{value:function(a){null!=this.queryView?this.queryView.fireAddConstraint(this.formName,
"ucd",a):Out.info("No Query View:"+JSON.stringify(a))}}});function UcdPatternEditor_mVc(a){UcdQEditor_mVc.call(this,a)}UcdPatternEditor_mVc.prototype=Object.create(UcdQEditor_mVc.prototype,{updateQuery:{value:function(a){null!=this.queryView?this.queryView.fireAddConstraint(this.formName,"relation",a):Out.info("No Query View:"+JSON.stringify(a))}}});function PosQEditor_mVc(a){ConstQEditor_mVc.call(this,a);a.editor=this;this.fieldListView=new ConeSearch_mVc(a)}
PosQEditor_mVc.prototype=Object.create(ConstQEditor_mVc.prototype,{draw:{value:function(){var a=this;this.fieldListView.draw();this.parentDiv.append("<div id="+this.constContainerId+' style="float: left;background: transparent; display: inline;"></div>');$("#"+this.constContainerId).append('<input  title="Click to add a search cone" class="bigarrowbutton" type="button">');this.constListId=this.constListView.draw({fieldset:"105px",div:"80px"});this.parentDiv.find("input.bigarrowbutton").click(function(){a.fireAttributeEvent()});
this.fieldListView.setRegionForm(function(b){b.userAction&&(5<b.region.size.x||5<b.region.size.y?Modalinfo.error("The region size can't exceeded 5 deg. \nIts actual size is "+JSON.stringify(b.region.size)):(a.fireRegionEvent(b),Modalinfo.closeRegion()))})}},displayFields:{value:function(){}},setTestForm:function(){var a=$("#"+this.cooFieldId),b=null!=this.sesameURL?function(){Processing.show("Waiting on SESAME response");$.getJSON("sesame",{object:a.val()},function(b){Processing.hide();Processing.jsonError(b,
"Sesame failure")||a.val(b.alpha+" "+b.delta)})}:function(){Modalinfo.info("name resolver not implemented yet")};$("#poscolumns_CSsesame").parents("#posConstEditor").find("#posConstEditor_constcont").find("input:first").click(b);$("#"+this.sesameId).click(b)},updateQuery:{value:function(a){null!=this.queryView?this.queryView.fireAddConstraint(this.formName,"position",a):Out.info("No Query View:"+JSON.stringify(a))}},fireClearAllConst:{value:function(){this.constListView.fireClearAllConst();this.listener.controlClearAllConst();
this.fieldListView.fireClearAllConst()}},fireRegionEvent:{value:function(a){if(a&&a.userAction&&a.isReady){var b="";if("array2dim"==a.region.format)for(var b="",c=0;c<a.region.points.length-1;c++)0<c&&(b+=" "),b+=a.region.points[c][0]+" "+a.region.points[c][1];else if("array"==a.region.format)for(b="",c=0;c<a.region.points.length;c++)0<c&&(b+=" "),b+=a.region.points[c];else{Modalinfo.error(a.region.format+" not supported region format");return}this.fireClearAllConst();""!=b&&(this.listener.controlAttributeEvent({type:"region",
frame:"ICRS",position:b,radius:0},this.constListId),$("#"+this.constListId+" span.help").attr("style","display:none;"));this.fieldListView.resetPosition()}}},fireAttributeEvent:{value:function(){var a=this,b=this.parentDiv.find("input[id$='CScoofield']");this.parentDiv.find("input.bigarrowbutton").click(function(c,d,e){Processing.show("Waiting on SESAME response");$.getJSON("sesame",{object:b.val()},function(f){Processing.hide();Processing.jsonError(f,"Sesame failure","Name "+b.val()+" cannot be resolved")||
(b.val(f.alpha+" "+f.delta),c.controlClearConst(".*region.*"),c.controlAttributeEvent(a.fieldListView.getSearchParameters(),a.constListId),$("#"+d+" span.help").attr("style","display:none;"),e.resetPosition())})}(this.listener,this.constListId,this.fieldListView))}},fireAttributeAutoEvent:{value:function(){1>=this.fireGetNumberOfEditor()&&this.fieldListView.hasSearchParameters()&&($("#"+this.constListId+" span.help").attr("style","display:none;"),this.listener.controlAttributeEvent(this.fieldListView.getSearchParameters(),
this.constListId))}},firePoslistUpload:{value:function(a,b){this.constListView.fireRemoveAllHandler();this.listener.controlAttributeEvent({position:"poslist:"+a,radius:b,frame:"ICRS"},this.constListId);$("#"+this.constListId+" span.help").attr("style","display:none;")}}});function CatalogueQEditor_mVc(a){ConstQEditor_mVc.call(this,a);var b=this;this.help=a.help;this.fieldListView=new CatalogueList_mVc(a.parentDivId,this.formName,{stackHandler:function(a){b.fireAttributeEvent(a)}})}
CatalogueQEditor_mVc.prototype=Object.create(ConstQEditor_mVc.prototype,{draw:{value:function(){this.fieldListView.draw();this.parentDiv.append("<div id="+this.constContainerId+' style="width:450px;float: left;background: transparent; display: inline;"></div>');this.constListId=this.constListView.draw({fieldset:"131px",div:"102px"});$("#"+this.constContainerId).append('<div style="width: 100%;"><span class=spanhelp>'+this.help+"</span></div>");this.fieldsLoaded||(this.listener.controlLoadFields(),
this.fieldsLoaded=!0)}},updateQuery:{value:function(a){null!=this.queryView?this.queryView.fireAddConstraint(this.formName,"relation",a):Out.info("No Query View:"+JSON.stringify(a))}}});
function tapColSelector_mVc(a){ConstQEditor_mVc.call(this,a);var b=this;this.help=a.help;this.constPosContainer=a.parentDivId+"_constposcont";this.fieldListView=new TapColList_mVc(a.parentDivId,this.formName,{stackHandler:function(a){b.fireAttributeEvent(a)},orderByHandler:function(a){b.fireOrderBy(a)}},a.sessionID);this.fieldListView.setStackTooltip("Click to select this field")}
tapColSelector_mVc.prototype=Object.create(ConstQEditor_mVc.prototype,{draw:{value:function(){this.fieldListView.draw();this.parentDiv.append("<div ><div id="+this.constContainerId+"></div></div>");this.constListId=this.constListView.draw(null,!0);this.orderByView.draw()}},fireSetTreepath:{value:function(a,b){null!=this.dataTreePath&&(this.fireClearAllConst(),this.queryView.fireDelConstraint(this.formName,"orderby"));this.dataTreePath=a;this.queryView.fireSetTreePath(this.dataTreePath);this.queryView.fireAddConstraint(this.formName,
"select",["*"]);this.orderByView.fireClearAllConst();this.listener.controlLoadFields(this.dataTreePath,b);this.fieldListView.setDataTreePath(this.dataTreePath)}},addTableOption:{value:function(a){this.fieldListView.addTableOption(a)}},fireAttributeEvent:{value:function(a){this.listener.controlAttributeHandlerEvent(this.fieldListView.getAttributeHandler(a),this.constListId);$("#"+this.constListId+" span.help").attr("style","display:none;")}},fireOrderBy:{value:function(a){var b="";if("OrderBy"!=a){var b=
this.fieldListView.dataTreePath.schema+"."+this.fieldListView.dataTreePath.table+"."+a,c=b.quotedTableName().tableName;this.orderByView.setOrderBy(b);this.orderByView.isDesc()&&(c+=" desc");null!=this.queryView?this.queryView.fireAddConstraint(this.formName,"orderby",[c]):Out.info("No Query View OB:"+a)}else this.queryView.fireDelConstraint(this.formName,"orderby");this.listener.controlOrderBy(b)}},updateQuery:{value:function(a,b){null!=this.queryView?this.queryView.fireAddConstraint(this.formName,
"select",a,b):Out.info("No Query View:"+JSON.stringify(a))}},getCurrentTreePath:{value:function(){return this.fieldListView.dataTreePath}}});
function tapQEditor_mVc(a){tapColSelector_mVc.call(this,a);var b=this;this.fieldListView=new TapFieldList_mVc(a.parentDivId,this.formName,{stackHandler:function(a){b.fireAttributeEvent(a)},radec:!1},a.sessionID);this.fieldListView.setStackTooltip("Click to constrain this field");this.posEditor=new TapSimplePos_mVc({editor:this,parentDivId:this.constPosContainer,formName:this.formName,frames:null,urls:{sesameURL:a.sesameUrl,uploadURL:a.upload.url},postUploadHandler:a.upload.postHandler})}
tapQEditor_mVc.prototype=Object.create(tapColSelector_mVc.prototype,{draw:{value:function(){this.fieldListView.draw();this.parentDiv.append("<div ><div id="+this.constPosContainer+"></div><div id="+this.constContainerId+"></div></div>");this.constListId=this.constListView.draw(null,!0)}},displayFields:{value:function(a){this.fieldListView.displayFields(a);this.fieldListView.lookForAlphaKeyword();this.fieldListView.lookForDeltaKeyword()}},fireGoodyremoved:{value:function(a){this.posEditor.fireClearAllConst()}},
fireAttributeEvent:{value:function(a){this.listener.controlAttributeHandlerEvent(this.fieldListView.getAttributeHandler(a),this.constListId);$("#"+this.constListId+" span.help").attr("style","display:none;")}},fireInputCoordEvent:{value:function(a,b,c,d){var e=this.fieldListView.getRaKeyword();if(""==e.length)Modalinfo.error("RA field not set");else{var f=this.fieldListView.getDeltaKeyword();""==f.length?Modalinfo.error("DEC field not set"):(this.listener.controlInputCoord(a,b,c,d,e,f,this.constListId),
$("#"+this.constListId+" span.help").attr("style","display:none;"))}}},updateQuery:{value:function(a,b){null!=this.queryView?this.queryView.fireAddConstraint(this.formName,"column",a,b):Out.info("No Query View:"+JSON.stringify(a))}},isReadyToUpload:{value:function(a,b){return""==this.fieldListView.getRaKeyword().length||""==this.fieldListView.getDeltaKeyword()?(Modalinfo.error("Both RA and DEC fields must be set"),!1):!0}},getUploadedFile:{value:function(){return this.posEditor.uploadedFile}}});
function tapPosQEditor_mVc(a){tapColSelector_mVc.call(this,a);this.fieldListView=new TapFieldList_mVc(a.parentDivId,this.formName,{stackHandler:null,orderByHandler:null,raHandler:null,decHandler:null,radec:!0},a.sessionID);this.fieldListView.setStackTooltip("Click to constrain this field");this.posEditor=new TapSimplePos_mVc({editor:this,parentDivId:this.constPosContainer,formName:this.formName,frames:null,urls:{sesameURL:a.sesameUrl,uploadURL:a.upload.url},postUploadHandler:a.upload.postHandler,
preloadedGetter:a.upload.preloadedGetter})}
tapPosQEditor_mVc.prototype=Object.create(tapColSelector_mVc.prototype,{draw:{value:function(){this.fieldListView.draw();this.parentDiv.append("<div><div id="+this.constPosContainer+"></div><div id="+this.constContainerId+"></div></div>");this.posEditor.draw();this.constListId=this.constListView.draw({fieldset:"inherit",div:"102px"},!0)}},fireSetTreepath:{value:function(a,b){null!=this.dataTreePath&&(this.fireClearAllConst(),this.queryView.fireDelConstraint(this.formName,"orderby"));this.dataTreePath=
a;this.queryView.fireSetTreePath(this.dataTreePath);this.queryView.fireAddConstraint(this.formName,"select",["*"]);this.orderByView.fireClearAllConst();this.listener.controlLoadFields(this.dataTreePath,b);this.fieldListView.setDataTreePath(this.dataTreePath);this.posEditor.uploadedFile=""}},displayFields:{value:function(a){this.fieldListView.displayFields(a);this.fieldListView.lookForAlphaKeyword();this.fieldListView.lookForDeltaKeyword()}},fireAttributeEvent:{value:function(a){this.listener.controlAttributeHandlerEvent(this.fieldListView.getAttributeHandler(a),
this.constListId);$("#"+this.constListId+" span.help").attr("style","display:none;")}},fireGoodyRemoved:{value:function(a){this.fireClearAllConst()}},fireInputCoordEvent:{value:function(a,b,c,d){var e=this.fieldListView.getRaKeyword();if(""==e.length)Modalinfo.error("RA field not set");else{var f=this.fieldListView.getDeltaKeyword();""==f.length?Modalinfo.error("DEC field not set"):(this.listener.controlInputCoord(a,b,c,d,e,f,this.constListId),$("#"+this.constListId+" span.help").attr("style","display:none;"))}}},
updateQuery:{value:function(a,b){null!=this.queryView?this.queryView.fireAddConstraint(this.formName,"column",a,b):Out.info("No Query View:"+JSON.stringify(a))}},isReadyToUpload:{value:function(a,b){return""==this.fieldListView.getRaKeyword().length||""==this.fieldListView.getDeltaKeyword()?(Modalinfo.error("Both RA and DEC fields must be set"),!1):!0}},getUploadedFile:{value:function(){return this.posEditor.uploadedFile}},fireSupportUpload:{value:function(a){this.posEditor.supportUpload(a)}}});
function tapCrossMatchQEditor_mVc(a){tapPosQEditor_mVc.call(this,a);this.xParentDivId="X"+this.parentDiv.attr("id");this.xfieldListView;this.sessionId=a.sessionID}
tapCrossMatchQEditor_mVc.prototype=Object.create(tapPosQEditor_mVc.prototype,{draw:{value:function(){this.fieldListView.draw();this.parentDiv.css("width","");this.parentDiv.wrap("<div id='tapCrossMatchParent'></div>");$("#tapCrossMatchParent").css("display","flex");$("#tapCrossMatchParent").append("<div  style='width: 100px;'></div><div style='width: 100%;' id='"+this.xParentDivId+"'></div>");$("#tapCrossMatchParent").css("border","1px solid red");$("#"+this.xParentDivId).css("border","1px solid green");
this.xfieldListView=new TapFieldList_mVc(this.xParentDivId,this.formName,{stackHandler:null,orderByHandler:null,raHandler:null,decHandler:null,radec:!0},this.sessionID);this.xfieldListView.draw();this.xfieldListView.setStackTooltip("Click to constrain this field");$("#XtapCrossMatchSelector_tableSelect").parent().parent().remove();$("#tapCrossMatchSelector_tableSelect").parent().parent().remove();this.xfieldListView.setDataTreePath(new DataTreePath({nodekey:"node",schema:"schema",table:"table",tableorg:"schema.table"}));
$("#"+this.xParentDivId).append("<div><div id="+this.constContainerId+"></div></div>");$("#"+this.constContainerId).css({height:"100px","margin-top":"270px",border:"1px solid pink"})}}});console.log("=============== >  ConstQEditor_v.js ");
ConstQEditor_mvC=function(a,b){a.addListener({controlLoadFields:function(a,d){b.loadFields(a,d)},controlAttributeEvent:function(a,d){b.processAttributeEvent(a,d)},controlAttributeHandlerEvent:function(a,d){b.processAttributeHandlerEvent(a,d)},controlClearAllConst:function(){b.clearAllConst()},controlClearConst:function(a){b.clearConst(a)},controlGetNumberOfEditor:function(){return b.getNumberOfEditor()},controlInputCoord:function(a,d,e,f,g,h,l){b.processInputCoord(a,d,e,f,g,h,l)},controlOrderBy:function(a){b.processOrderBy(a)},
controlGetAttributeHandlers:function(){return b.getAttributeHandlers()},controlGetDefaultValue:function(){return b.getDefaultValue()}});b.addListener({nextListener:function(){a.nextListener()},controlTypoMsg:function(b,d){a.printTypoMsg(b,d)},controlTypoGreen:function(){return a.isTypoGreen()},controlUpdateQuery:function(b,d){a.updateQuery(b,d)},controlRunQuery:function(b){a.runQuery(b)},controlAddTableOption:function(b){a.addTableOption(b)},controlCurrentTreePath:function(){return a.getCurrentTreePath()},
controlFieldsStored:function(b){a.fieldsStored(b)}})};console.log("=============== >  ConstQEditor_c.js ");function QueryTextEditor_Mvc(){this.colConst=[];this.obConst=[];this.ucdConst=[];this.posConst=[];this.relConst=[];this.kwConst=[];this.fitConst=[];this.query=this.limConst="";this.listener=this.treePath=null}
QueryTextEditor_Mvc.prototype={addListener:function(a){this.listener=a},getQuery:function(){return this.query},reset:function(){this.colConst=[];this.obConst=[];this.ucdConst=[];this.posConst=[];this.relConst=[];this.kwConst=[];this.fitConst=[];this.query=this.limConst="";this.treePath=null},processAddConstraint:function(a,b,c){Out.debug("add constraint of type "+b+" from form "+a);"column"==b?(this.delConst(a,this.colConst),this.addConstraintToArray(a,c,this.colConst)):"orderby"==b&&0<c.length?this.obConst=
c[0]:"ucd"==b?(this.delConst(a,this.ucdConst),this.addConstraintToArray(a,c,this.ucdConst)):"position"==b?(this.delConst(a,this.posConst),this.addConstraintToArray(a,c,this.posConst)):"relation"==b?(this.delConst(a,this.relConst),this.addConstraintToArray(a,c,this.relConst)):"kwconst"==b?(this.delConst(a,this.kwConst),this.addConstraintToArray(a,c,this.kwConst)):"fitconst"==b?(this.delConst(a,this.fitConst),this.addConstraintToArray(a,c,this.fitConst)):"limit"==b&&0<c.length?this.limConst=c[0]:Modalinfo.error("QueryTextEditor do not know what to do with a constraint typed as "+
b);this.buildQuery();this.notifyDisplayQuery()},addConstraintToArray:function(a,b,c){null!=b&&""!=$.trim(b)&&c.push({label:a,constraints:b})},processDelConstraint:function(a,b){Out.debug("Del constraint of type "+b+" from form "+a);"column"==b?this.delConst(a,this.colConst):"orderby"==b?this.obConst="":"ucd"==b?this.delConst(a,this.ucdConst):"position"==b?this.delConst(a,this.posConst):"relation"==b?this.delConst(a,this.relConst):"kwconst"==b?this.delConst(a,this.kwConst):"fitconst"==b?this.delConst(a,
this.fitConst):"limit"==b?this.limConst="":Modalinfo.error("QueryTextEditor do not know what to do with a constraint typed as "+b);this.buildQuery();this.notifyDisplayQuery()},delConst:function(a,b){for(var c=0;c<b.length;c++)if(b[c].label==a){b.splice(c,1);break}},buildQuery:function(){this.query=this.buildWhereConstraint("\nWherePosition",",",this.posConst)+this.buildWhereConstraint("\nWhereAttributeSaada","AND",this.colConst)+this.buildWhereConstraint("\nWhereUCD","AND",this.ucdConst)+this.buildWhereConstraint("\nWhereRelation",
" ",this.relConst)+this.buildWhereConstraint("\nHavingCounterpartsWith",",",this.kwConst)+this.buildWhereConstraint("\nWhereModel"," ",this.fitConst);""!=this.obConst&&(this.query+="\nOrder By "+this.obConst+"\n");""==this.limConst||isNaN(this.limConst)||(this.query+="\nLimit "+this.limConst+"\n")},buildWhereConstraint:function(a,b,c){var d="",e="",f="";"AND"==b&&(e="(",f=")");for(var g=0;g<c.length;g++){0<g&&(d+=""==b.trim()?"\n":"\n    "+b+"\n");var h=$.trim(c[g].constraints),d=d+(1<c.length?"    "+
e+h+f:c[g].constraints)}return""==d?"":a+" {\n"+d+"\n}"},notifyDisplayQuery:function(){this.listener.controlDisplayQuery(this.query)},setTreePath:function(a){this.treePath=$.extend({},a)}};function ADQLTextEditor_Mvc(){QueryTextEditor_Mvc.call(this);this.selectConst=[];this.joinedTables=new JoinKeyMap;this.flatJoined=[];this.tableConst=[]}
ADQLTextEditor_Mvc.prototype=Object.create(QueryTextEditor_Mvc.prototype,{processAddConstraint:{value:function(a,b,c,d){Out.debug("add constraint of type "+b+" from form "+a);if("select"==b)this.selectConst=[{label:a,constraints:c}];else if("column"==b)this.delConst(a,this.colConst),this.addConstraintToArray(a,c,this.colConst);else if("orderby"==b&&0<c.length)this.obConst=[{label:a,constraints:c[0]}];else if("position"==b)this.delConst(a,this.posConst),this.addConstraintToArray(a,c,this.posConst);
else if("kwconst"==b)this.delConst(a,this.kwConst),this.addConstraintToArray(a,c,this.kwConst);else if("fitconst"==b)this.delConst(a,this.fitConst),this.addConstraintToArray(a,c,this.fitConst);else if("limit"==b&&0<c.length)this.limConst={label:a,constraints:c[0]};else{Modalinfo.error("QueryTextEditor does not know what to do with a constraint typed as "+b);return}this.joinedTables.removeFromOrigin(a);this.flatJoined=[];if(null!=d)for(var e in d)b=d[e],""==b.target_column?this.flatJoined.push(b.target_table):
this.joinedTables.addJoinKey(e,b,a);this.buildQuery();this.notifyDisplayQuery()}},getJoin:{value:function(){for(var a="",b=this.joinedTables.getJoinKeys(),c=b.length,d=0;d<c;d++)var e=b[d],f=(e.target_datatreepath.schema+"."+e.target_datatreepath.table).quotedTableName().qualifiedName,a=a+("JOIN "+f+" ON "+this.getCurrentTableName().quotedTableName().qualifiedName+"."+e.source_column.quotedTableName().qualifiedName+" = "+f+"."+e.target_column.quotedTableName().qualifiedName+"\n");return a}},buildQuery:{value:function(){var a=
this.getCurrentTableName().quotedTableName().qualifiedName,b=this.limConst.constraints;this.query="";this.query+=this.buildWhereConstraint("SELECT "+(void 0!=b?" TOP "+b+" ":""),",",this.selectConst);this.query+="FROM "+a;if(null!=this.flatJoined)for(var c in this.flatJoined)this.query+=", "+this.flatJoined[c];this.query+="\n";this.query+=this.getJoin();this.query+=this.buildWhereConstraint("WHERE","AND",this.colConst);this.query+=this.buildWhereConstraint("ORDER BY",",",this.obConst)}},buildWhereConstraint:{value:function(a,
b,c){var d="",e="",f="";"AND"==b&&(e="(",f=")");for(var g=0;g<c.length;g++){0<g&&(d+=""==b.trim()?"\n":"\n    "+b+"\n");var h=$.trim(c[g].constraints),d=d+(1<c.length?"    "+e+h+f:c[g].constraints)}return""==d?"":a+" "+d+"\n"}},getCurrentTableName:{value:function(){return this.treePath.schema+"."+this.treePath.table}}});function JoinKeyMap(){this.keyMap=[]}
JoinKeyMap.prototype={addJoinKey:function(a,b,c){var d=this.keyMap[a];null==d?this.keyMap[a]={joinKey:b,origins:[c]}:-1==d.origins.indexOf(c)&&d.origins.push(c)},removeFromOrigin:function(a){for(var b in this.keyMap){var c=this.keyMap[b].origins;if(1==c.length&&c[0]==a)delete this.keyMap[b];else{var d=c.indexOf(a);-1<d&&c.splice(d,1)}}},getJoinKeys:function(){var a=[],b;for(b in this.keyMap)a.push(this.keyMap[b].joinKey);return a}};console.log("=============== >  QueryTextEditor_m.js ");
function QueryTextEditor_mVc(a){this.parentDiv=$("#"+a.parentDivId);this.textareaid=a.parentDivId+"_text";this.defaultQuery=a.defaultQuery.endsWith("\n")?a.defaultQuery:a.defaultQuery+"";this.listener=null}
QueryTextEditor_mVc.prototype={addListener:function(a){this.listener=a},draw:function(){this.parentDiv.html('<textarea id="'+this.textareaid+'" class="querytext" id="Catalogue"></textarea><p class="help">Widgets do not reflect the query anymore after you modified it directly</p>');this.displayQuery("")},fireGetQuery:function(){return $("#"+this.textareaid).val()},fireAddConstraint:function(a,b,c,d){this.listener.controlAddConstraint(a,b,c,d)},fireDelConstraint:function(a,b){this.listener.controlDelConstraint(a,
b)},fireSetTreePath:function(a){this.listener.controlSetTreePath(a)},reset:function(a){this.defaultQuery=a;this.displayQuery("");this.listener.controlReset()},displayQuery:function(a){$("#"+this.textareaid).val(this.defaultQuery+a)},getQuery:function(a){return $("#"+this.textareaid).val()},toggle:function(){this.parentDiv.toggle()}};console.log("=============== >  QueryTextEditor_v.js ");
QueryTextEditor_mvC=function(a,b){a.addListener({controlGetQuery:function(){return b.getQuery()},controlAddConstraint:function(a,d,e,f){b.processAddConstraint(a,d,e,f)},controlDelConstraint:function(a,d){b.processDelConstraint(a,d)},controlSetTreePath:function(a){b.setTreePath(a)},controlReset:function(a){b.reset(a)}});b.addListener({controlDisplayQuery:function(b){a.displayQuery(b)}})};console.log("=============== >  QueryTextEditor_c.js ");
function Segment(a){function b(a,b,c){var d;d=parseInt(b);d=Math.abs(a.xA-d);d=1>=d&&0<=d?d:-1;if(-1!=d)return{flag:"vertical",segmento:a};var e;e=parseInt(c);e=Math.abs(a.yA-e);e=1>=e&&0<=e?e:-1;return-1!=e?{flag:"horizontal",segmento:a}:-1==d&&-1==e&&(d=f=-((a.yB-a.yA)/(a.xB-a.xA)),e=g=-(f*a.xA)-a.yA,b=Math.abs(d*parseInt(b)+parseInt(c)+e),b/=Math.sqrt(d*d+1),2>=b&&0<=b)?{flag:"distancia",segmento:a,alfa:d,beta:e}:-1}function c(a){var b=[],c,d,e;for(e in a)void 0==c?c=e:void 0==d&&(d=e),void 0!=
c&&void 0!=d&&(b.push({A:c,B:d}),c=d,d=void 0),parseInt(h.length-1)==e&&b.push({A:h.length-1,B:0});return b}function d(a,b,c,d,e,f,g,h){a=(a-c)*(f-h)-(b-d)*(e-g);return 0==a?-1:a}function e(a,b,c,d,e,f,g,h,l,x){return x<Math.min(b,d)||x>Math.max(b,d)||x<Math.min(f,h)||x>Math.max(f,h)||l<Math.min(a,c)||l>Math.max(a,c)||l<Math.min(e,g)||l>Math.max(e,g)?-1:2}var f,g,h=[],h=a,l;this.IsCursorOn=function(a,d){var e;l=c(h);a:{e=parseInt(a);var f=parseInt(d),g,q,v,w,s;for(s in l){var x,C,D,y;g=h[l[s].A].cx;
v=h[l[s].A].cy;q=h[l[s].B].cx;w=h[l[s].B].cy;x=parseInt(g)>parseInt(q)?q:g;C=parseInt(g)>parseInt(q)?g:q;D=parseInt(v)>parseInt(w)?w:v;y=parseInt(v)>parseInt(w)?v:w;if(e>=x&&e<=C&&f>=D&&f<=y&&(seg={xA:g,yA:v,xB:q,yB:w,segmento:s},-1!=(dis=b(seg,e,f)))){e={xA:g,yA:v,xB:q,yB:w,segmento:s};break a}if(C===x&&f>=D&&f<=y&&(seg={xA:g,yA:v,xB:q,yB:w,segmento:s},-1!=(dis=b(seg,e,f)))){e={xA:g,yA:v,xB:q,yB:w,segmento:s};break a}if(D===y&&e>x&&e<C&&(seg={xA:g,yA:v,xB:q,yB:w,segmento:s},-1!=(dis=b(seg,e,f)))){e=
{xA:g,yA:v,xB:q,yB:w,segmento:s};break a}}e=void 0}if(seg=e)return e=b(seg,a,d)};this.Itersection=function(a,b){var f=c(h),g=f.length-2,l,q;q=-1;a=parseInt(a);if(!1===b){if(3<f.length)if(0!=a){xa1=h[f[g].A].cx;ya1=h[f[g].A].cy;xb2=h[f[g].B].cx;yb2=h[f[g].B].cy;var v=parseInt(f[g].A),w=parseInt(f[g].B),s;for(s in f)if(xa3=h[f[s].A].cx,ya3=h[f[s].A].cy,xb4=h[f[s].B].cx,yb4=h[f[s].B].cy,q=d(xa1,ya1,xb2,yb2,xa3,ya3,xb4,yb4),-1!=q&&(l=((xa3-xb4)*(xa1*yb2-ya1*xb2)-(xa1-xb2)*(xa3*yb4-ya3*xb4))/q,q=((ya3-
yb4)*(xa1*yb2-ya1*xb2)-(ya1-yb2)*(xa3*yb4-ya3*xb4))/q,l=e(xa1,ya1,xb2,yb2,xa3,ya3,xb4,yb4,l,q),-1!=l&&s!=f.length-1&&xb4!=xa1&&yb4!=ya1))return{x1:xa1,y1:ya1,x2:xb2,y2:yb2,seginit:g,segfin:s,nA:v,nB:w}}else if(0===a)for(s in xa1=h[f[0].A].cx,ya1=h[f[0].A].cy,xb2=h[f[0].B].cx,yb2=h[f[0].B].cy,v=parseInt(f[0].A),w=parseInt(f[0].B),f.reverse(),f)if(0!=s&&(xa3=h[f[s].A].cx,ya3=h[f[s].A].cy,xb4=h[f[s].B].cx,yb4=h[f[s].B].cy,q=d(xa1,ya1,xb2,yb2,xa3,ya3,xb4,yb4),-1!=q&&(l=((xa3-xb4)*(xa1*yb2-ya1*xb2)-(xa1-
xb2)*(xa3*yb4-ya3*xb4))/q,q=((ya3-yb4)*(xa1*yb2-ya1*xb2)-(ya1-yb2)*(xa3*yb4-ya3*xb4))/q,l=e(xa1,ya1,xb2,yb2,xa3,ya3,xb4,yb4,l,q),-1!=l&&s!=f.length-1&&xb2!=xa3&&yb2!=ya3)))return{x1:xa1,y1:ya1,x2:xb2,y2:yb2,seginit:g,segfin:s,nA:v,nB:w}}else if(b){var x,C=[];if(3<f.length)for(s in 0===a?(g=h.length-1,w=v=a,x=a+1):a===h.length-1?(g=a-1,w=v=a,x=0):(g=a-1,w=v=a,x=a+1),f)if(parseInt(f[s].A)!==g||parseInt(f[s].B)!=v)if(parseInt(f[s].A)!==w||parseInt(f[s].B)!=x)if(xa1=h[g].cx,ya1=h[g].cy,xb2=h[v].cx,yb2=
h[v].cy,xa3=h[f[s].A].cx,ya3=h[f[s].A].cy,xb4=h[f[s].B].cx,yb4=h[f[s].B].cy,q=d(xa1,ya1,xb2,yb2,xa3,ya3,xb4,yb4),-1!=q&&(l=((xa3-xb4)*(xa1*yb2-ya1*xb2)-(xa1-xb2)*(xa3*yb4-ya3*xb4))/q,q=((ya3-yb4)*(xa1*yb2-ya1*xb2)-(ya1-yb2)*(xa3*yb4-ya3*xb4))/q,l=e(xa1,ya1,xb2,yb2,xa3,ya3,xb4,yb4,l,q),-1!=l&&xa1!=xb4&&ya1!=yb4&&C.push({x1:xa1,y1:ya1,x2:xb2,y2:yb2})),xa1=h[w].cx,ya1=h[w].cy,xb2=h[x].cx,yb2=h[x].cy,q=d(xa1,ya1,xb2,yb2,xa3,ya3,xb4,yb4),-1!=q&&(l=((xa3-xb4)*(xa1*yb2-ya1*xb2)-(xa1-xb2)*(xa3*yb4-ya3*xb4))/
q,q=((ya3-yb4)*(xa1*yb2-ya1*xb2)-(ya1-yb2)*(xa3*yb4-ya3*xb4))/q,l=e(xa1,ya1,xb2,yb2,xa3,ya3,xb4,yb4,l,q),-1!=l&&xa1!=xb4&&ya1!=yb4&&C.push({x1:xa1,y1:ya1,x2:xb2,y2:yb2})),1<C.length)return C}return-1}}console.log("=============== >  Segment.js ");
ploter=function(){var a=null;$.fn.UseTooltipeHf=function(){$(this).bind("plothover",function(e,f,g){if(g){if(a!=g.dataIndex){a=g.dataIndex;$("#flottooltip").remove();e=g.datapoint[0];f=g.datapoint[1];var h=g.datapoint[2],u=g.series.bars.barWidth,n=g.series.color;!1===g.series.bars.horizontal?b(g.pageX,g.pageY,'<h5 style="text-align:center;color:'+n+' "><strong>'+g.series.label+"</strong></h5>Value = <strong>"+d(f)+"</strong> <br/>Error Value = <strong>"+d(h)+"</strong> <br/>MJD = <strong>"+d(e)+"</strong> <br/>Date = <strong>"+
c(e)+"</strong>",n):b(g.pageX,g.pageY,'<h5 style="text-align:center;color:'+n+' "><strong>'+g.series.label+"</strong></h5> Value = <strong>"+d(f)+"</strong> <br/>Error Value = <strong>"+d(u)+"</strong>",n)}}else $("#flottooltip").remove(),a=null})};$.fn.UseTooltipRadec=function(){$(this).bind("plothover",function(e,f,g){if(g){if(a!=g.dataIndex){a=g.dataIndex;$("#flottooltip").remove();e=g.datapoint[0];f=g.datapoint[1];var h=g.datapoint[2],u=g.series.color;2==g.seriesIndex?b(g.pageX,g.pageY,'<h5 style="text-align:center;color:'+
u+' "><strong>'+g.series.label+"</strong></h5>Ra = <strong>"+d(e)+"</strong> <br/> Dec = <strong>"+d(f)+"</strong> (arcsec) <br/>Error = <strong>"+d(3600*h)+"</strong> (sec) ",u):b(g.pageX,g.pageY,'<h5 style="text-align:center;color:'+u+' "><strong>'+g.series.label+"</strong></h5>Ra = <strong>"+d(e)+"</strong> <br/> Dec = <strong>"+d(f)+"</strong> (arcsec) <br/>Error =<strong>"+d(3600*h)+"</strong> (sec) <br/> Date = <strong>"+c(g.series.data[g.dataIndex][4])+"</strong> ",u)}}else $("#flottooltip").remove(),
a=null})};var b=function(a,b,c,d){$('<div id="flottooltip">'+c+"</div>").css({position:"absolute",display:"none",top:b+15,left:a,border:"2px solid #4572A7",padding:"2px",size:"10","border-radius":"6px 6px 6px 6px","border-color":d,"background-color":"#fff",opacity:1,"z-index":1E4}).appendTo("body").fadeIn(200)},c=function(a){var b,c,d,e;a=Math.floor(a)+2400000.5;b=Math.floor(a);1<=a-b+0.5&&(b+=1);d=b+68569;e=Math.floor(4*d/146097);d=Math.floor(d)-Math.floor((146097*e+3)/4);a=Math.floor(4E3*(d+1)/
1461001);d=d-Math.floor(1461*a/4)+31;b=Math.floor(80*d/2447);c=d-Math.floor(2447*b/80);d=Math.floor(b/11);b=Math.floor(b+2-12*d);a=Math.floor(100*(e-49)+a+d);10>b&&(b="0"+b);10>c&&(c="0"+c);return c+"/"+b+"/"+a},d=function(a){var b=a.toString();a=b.split("e");/\./.test(a[0])&&(b=1<a.length?"e"+a[1]:"",t=parseFloat(a[0]).toFixed(5).toString().split("."),t0=t[0],t1=1<t.length?"."+t[1]:"",/0+$/.test(t1)&&(t1=t1.replace(/0+$/,"")),b=1<t1.length?t0+t1+b:t0+b);return b},e=function(a,b){return c(a)},f=function(a,
b){return d(a)},g=[];togglePlot=function(a,b,c,d){for($("#"+d+a).hasClass("change")?$("#"+d+a).removeAttr("class"):$("#"+d+a).attr("class","change");b<=c;b++){if(g[b])var e=g[b].getData();for(var f in e)e[f].idcurve==a&&(5!=a?(6!=a&&(e[f].lines.show=!e[f].lines.show),e[f].points.show=!e[f].points.show,e[f].points.yerr.show=!e[f].points.yerr.show,5<a&&(e[f].points.xerr.show=!e[f].points.xerr.show)):(e[f].bars.show=!e[f].bars.show,e[f].hoverable=!e[f].hoverable),g[b].setData(e),g[b].draw())}};var h=
{plothf:function(a,b,c,d,f,h,q,v){c.xaxis.tickFormatter=e;c.xaxis.ticks=0;var w=[],s;if(1<d.length){c.points.fillColor||(c.points.radius=0,c.points.fillColor="#ffffff");for(var x=0;x<d.length-1;x++){for(s=x+1;s<d.length;s++)w.push(d[s]-d[x]);s=Math.max.apply(Math,w)<15*Math.min.apply(Math,w)?Math.min.apply(Math,w):172}}else s=172,c.points.radius=3,c.points.fillColor=null;c.xaxis.max=Math.max.apply(Math,d)+s;c.xaxis.min=Math.min.apply(Math,d)-s;c.yaxis.max=f+q;c.yaxis.min=h-q;1<Math.abs(f)?c.yaxis.zoomRange=
[1E10*Math.abs(f),0]:c.yaxis.zoomRange=[1/Math.abs(f)*1E10,0];c.xaxis.panRange=[c.xaxis.min-s,c.xaxis.max+s];c.xaxis.axisLabel=v;g.push($.plot($("#"+a),b,c));$("#"+a).UseTooltipeHf()},plotradec:function(a,b,c,d,e,h,q,v,w){c.points.fillColor||(c.points.radius=0,c.points.fillColor="#ffffff");c.xaxis.ticks=null;c.xaxis.tickFormatter=null;c.xaxis.tickFormatter=f;c.xaxis.max=h+w;c.xaxis.min=q-w;c.yaxis.tickFormatter=f;c.yaxis.max=d+v;c.yaxis.min=e-v;c.xaxis.tickLength=null;c.yaxis.zoomRange=null;c.xaxis.panRange=
[c.xaxis.min-w,c.xaxis.max+w];c.xaxis.axisLabel="Ra";g.push($.plot($("#"+a),b,c));$("#"+a).UseTooltipRadec()},alphasc:function(a,b){return a.label==b.label?0:a.label>b.label?1:-1}};h.formaty=f;h.insertLegend=function(a,b,c){b=parseInt(b);c=parseInt(c);var d=!1;$("."+a).html("");for(var e=[],f=[],h,v,w=[],s=b;s<=c;s++)for(var x=0;x<g[s].getData().length;x++)h=g[s].getData()[x],v=h.label,"Proper Motion"==v&&(d=!0),-1==w.indexOf(v)&&(w.push(v),f.push({label:v,color:h.color,idcurve:h.idcurve}));for(x=
0;x<f.length;x++)h=f[x],e.push('<td class="legendColorBox"><div style="border:1px solid #ccc; padding:1px"><div style="width:4px;height:0;border:5px solid '+h.color+';overflow:hidden"></div></div></td><td class="legendLabel"><a id="'+a+h.idcurve+'" href="#" onClick="togglePlot('+h.idcurve+","+b+","+c+",'"+a+"'); return false;\">"+h.label+"</a></td>");0!=e.length&&(b=""+(d?'<table class="leg" style="font-size:smaller;color:#545454;display: inline-table">'+e.join("")+'</table><p class="spanhelp" style="display:inline;font-size:smaller;margin: 0 auto;">Click on label to hide/show plots. The blue label joins first with last detection.</p>':
'<table class="leg" style="font-size:smaller;color:#545454;display: inline-table">'+e.join("")+'</table><p class="spanhelp" style="display:inline;font-size:smaller;margin: 0 auto;">Click on label to hide/show plots</p>'),b+='<p class="spanhelp" style="display:inline;color: darkorange;font-size:smaller;margin: 0 auto;">The detections used for the plots have not been filtered. Please check their validity by yourself.</p>',$("."+a).html(b))};h.inittabPlot=function(){g=[]};return h}();
function PlotSuccess(){this.options={canvas:!0,zoom:{interactive:!0},pan:{interactive:!0},lines:{show:!0},xaxis:{reserveSpace:!1,show:!0},yaxis:{tickFormatter:ploter.formaty},legend:{show:!1},grid:{hoverable:!0,borderWidth:1,backgroundColor:{colors:["#fff","#fff"]},borderColor:"black"},points:{show:!1,radius:0},shadowSize:0}}
PlotSuccess.prototype.plotAll=function(a,b){ploter.inittabPlot();var c=$($('<div id="ongletsgraphs" style="border:none"><ul></ul></div>').appendTo($("#"+a)));c.width("100%");c.height("100%");for(c=0;c<b.data.length;c++){var d=0,e=b.data[c].label.replace(/_/g," ");$('<li><a href="#plotarea'+b.data[c].label+'"><span>'+e+"</span> </a></li>").appendTo($('div[id="ongletsgraphs"] ul'));e=$($("<div></div>").appendTo($('div[id="ongletsgraphs"]')));e.attr("id","plotarea"+b.data[c].label);e.width("100%");e.height("90%");
$('<br clear="both" />').appendTo("#plotarea"+b.data[c].label);$($('<div class="legaa'+c+'"></div>').appendTo($("#plotarea"+b.data[c].label))).attr("id","legendContainerhr"+b.data[c].data[0].label);for(e=0;e<b.data[c].data.length;e++){d++;var f;f=b.data[c].data[e].label.replace(/_/g," ");/[\.\s\)\(]/.test(b.data[c].data[e].label)&&(b.data[c].data[e].label=b.data[c].data[e].label.replace(/[\.\s\)\(]/g,""));var g=$($('<div class="bb"></div>').appendTo($("#plotarea"+b.data[c].label)));g.attr("id","divplotgraph"+
b.data[c].data[e].label);for($($('<div class="aa"></div>').appendTo($("#divplotgraph"+b.data[c].data[e].label))).attr("id","plotgraph"+b.data[c].data[e].label);0==d%2;){g.css("margin-left","2%");break}var h=[],l=[],m=[],r=[],g=[],p=[],u=[];if(2>c)for(var n=0;n<b.data[c].data[e].data.length-1;n++){for(var q=0;q<b.data[c].data[e].data[n].data.length;q++)m.push(b.data[c].data[e].data[n].data[q][1]+b.data[c].data[e].data[n].data[q][2]),r.push(b.data[c].data[e].data[n].data[q][1]-b.data[c].data[e].data[n].data[q][2]),
p.push(b.data[c].data[e].data[n].data[q][2]);g.push(b.data[c].data[e].data[n].data.length)}else for(n=0;n<b.data[c].data[e].data.length;n++)for(q=0;q<b.data[c].data[e].data[n].data.length;q++)h.push(b.data[c].data[e].data[n].data[q][0]+b.data[c].data[e].data[n].data[q][3]),l.push(b.data[c].data[e].data[n].data[q][0]-b.data[c].data[e].data[n].data[q][3]),m.push(b.data[c].data[e].data[n].data[q][1]+b.data[c].data[e].data[n].data[q][2]),r.push(b.data[c].data[e].data[n].data[q][1]-b.data[c].data[e].data[n].data[q][2]),
u.push(b.data[c].data[e].data[n].data[q][3]),p.push(b.data[c].data[e].data[n].data[q][2]);h=Math.max.apply(Math,h);l=Math.min.apply(Math,l);m=Math.max.apply(Math,m);r=Math.min.apply(Math,r);u=Math.min.apply(Math,u);p=Math.min.apply(Math,p);n=[];if(b.data[c].data[e].data[g.indexOf(Math.max.apply(Math,g))]&&2>c)for(q=0;q<b.data[c].data[e].data[g.indexOf(Math.max.apply(Math,g))].data.length;q++)n.push(b.data[c].data[e].data[g.indexOf(Math.max.apply(Math,g))].data[q][0]);this.options.yaxis.panRange=[r-
2*p,m+2*p];4==b.data[c].data.length||6==b.data[c].data.length?(b.data[c].data[e].data[g.indexOf(Math.max.apply(Math,g))]&&b.data[c].data[e].data[b.data[c].data[e].data.length-1].data[0]&&(b.data[c].data[e].data[b.data[c].data[e].data.length-1].data[0][0]=1<n.length?Math.max.apply(Math,n):Math.max.apply(Math,n)+150,b.data[c].data[e].data[b.data[c].data[e].data.length-1].data[0][2]=1<n.length?Math.min.apply(Math,n):Math.min.apply(Math,n)-150),4==b.data[c].data.length?$("#divplotgraph"+b.data[c].data[e].label).height("50%"):
$("#divplotgraph"+b.data[c].data[e].label).height("33.3333%"),$("#divplotgraph"+b.data[c].data[e].label).width("49%"),$(".aa").height("97%"),$(".aa").width("100%"),ploter.plothf("plotgraph"+b.data[c].data[e].label,b.data[c].data[e].data,this.options,n,m,r,p,f),0==c&&3==e&&ploter.insertLegend("legaa0",0,3),1==c&&5==e&&ploter.insertLegend("legaa1",4,9)):($("#divplotgraph"+b.data[c].data[e].label).height("100%"),$("#divplotgraph"+b.data[c].data[e].label).width("100%"),$(".aa").height("95%"),$(".aa").width("100%"),
ploter.plotradec("plotgraph"+b.data[c].data[e].label,b.data[c].data[e].data,this.options,m,r,h,l,p,u),ploter.insertLegend("legaa2",10,10))}}};console.log("=============== >  flotmosaic.js ");function FitFieldList_mVc(a,b,c){FieldList_mVc.call(this,a,b,c)}
FitFieldList_mVc.prototype=Object.create(FieldList_mVc.prototype,{displayField:{value:function(a){var b=this,c="stack_"+(this.formName+"_"+a.fitparam),d="<tr class=attlist id='"+a.fitparam+"'><td class=attlist><span title='"+(a.fitparam+" - database name: "+a.databaseName+" - description: "+a.description+(void 0!=a.unit?" - unit: "+a.unit:"")+" - type: "+a.type+(void 0!=a.range?2==a.range.values.length&&"boolean"!=a.type?" - range: ["+a.range.values+"]":" - range: {"+a.range.values+"}":""))+"'>"+
a.fitparam+"</span></td><td class='attlist help'>"+a.type+"</td>";null!=this.stackHandler&&(d+="<td class='attlist attlistcmd'><input id="+c+' title="Click to constrain fields with this FITPARAM"  class="stackconstbutton" type="button"></input></td>');d+="</tr>";$("#"+this.fieldTableId).append(d);null!=this.stackHandler&&$("#"+this.fieldTableId+' input[id="'+c+'"]').click(function(){b.stackHandler($(this).closest("tr").attr("id"))});$("#"+this.fieldTableId+' tr[id="'+a.fitparam+'"] span').tooltip({track:!0,
delay:0,showURL:!1,opacity:1,fixPNG:!0,showBody:" - ",top:-15,left:5})}},displayFields:{value:function(){var a=this;this.attributesHandlers=[];MetadataSource.getTableAtt(this.dataTreePath,function(){var b=MetadataSource.ahMap(a.dataTreePath),c="<table id="+a.fieldTableId+" style='width: 100%; border-spacing: 0px; border-collapse:collapse' class='table'></table>";$("#"+a.fieldListId).html(c);for(c=0;c<b.length;c++){var d=b[c];a.attributesHandlers[d.fitparam]=d;a.displayField(d)}})}}});console.log("=============== >  FitFieldList_mVc.js ");
function FitQEditor_Mvc(){ConstQEditor_Mvc.call(this)}
FitQEditor_Mvc.prototype=Object.create(ConstQEditor_Mvc.prototype,{processAttributeEvent:{value:function(a,b){var c=this.attributeHandlers[a];if(null==c)Out.info("No AH referenced by "+a);else{var d=!0;for(k in this.editors){d=!1;break}Out.debug("mv FIT constraint "+a+" to #"+b);var e=this.constEditorRootId+a+this.const_key,c=new FitConstraint_mVc({divId:e,constListId:b,isFirst:d,attributeHandler:c,editorModel:this,defValue:""});this.editors[e]=c;c.fireInit();this.const_key++}}},loadFields:{value:function(a){var b=
this;this.attributesHandlers={};a&&MetadataSource.getTableAtt(a,function(){var c=MetadataSource.ahMap(a);b.attributeHandlersSearch=[];for(var d=0;d<c.length;d++){var e=c[d];b.attributeHandlersSearch.push(e);b.attributeHandlers[e.fitparam]=e}})}},updateQuery:{value:function(){var a="",b="",c;for(c in this.editors){var d=this.editors[c].fireGetADQL();null!=d&&(a+=b+d,""==b&&(b="\n        AND "))}this.listener.controlUpdateQuery(a)}}});console.log("=============== >  FitQEditor_m.js ");
function FitQEditor_mVc(a){ConstQEditor_mVc.call(this,a);var b=this;this.help=a.help;this.fieldListView=new FitFieldList_mVc(a.parentDivId,this.formName,{stackHandler:function(a){b.fireAttributeEvent(a)},orderByHandler:function(a){b.fireOrderBy(a)}})}
FitQEditor_mVc.prototype=Object.create(ConstQEditor_mVc.prototype,{draw:{value:function(){this.fieldListView.draw();this.parentDiv.append("<div id="+this.constContainerId+' style="background: transparent; width:450px;float: left;"></div>');this.constListId=this.constListView.draw({fieldset:"130px",div:"102px"});void 0!=this.help&&$("#"+this.constContainerId).append('<div style="width: 100%;"><span class=spanhelp>'+this.help+"</span></div>")}},updateQuery:{value:function(a){null!=this.queryView?this.queryView.fireAddConstraint(this.formName,
"relation",a):Out.info("No Query View:"+JSON.stringify(a))}}});console.log("=============== >  FitQEditor_v.js ");function FitPatternEditor_mVc(a){FitQEditor_mVc.call(this,a)}FitPatternEditor_mVc.prototype=Object.create(FitQEditor_mVc.prototype,{updateQuery:{value:function(a){null!=this.queryView?this.queryView.fireAddConstraint(this.formName,"relation",a):Out.info("No Query View:"+JSON.stringify(a))}}});console.log("=============== >  FitPatternQEditor_v.js ");
function FitPatternEditor_Mvc(a,b){FitQEditor_Mvc.call(this);this.relationName=a;this.className=b}FitPatternEditor_Mvc.prototype=Object.create(FitQEditor_Mvc.prototype,{updateQuery:{value:function(){var a="",b="",c;for(c in this.editors){var d=this.editors[c].fireGetADQL();null!=d&&(a+=b+d,""==b&&(b="\n        AND "))}""!=a&&(a="  matchPattern { "+this.relationName+",\n     AssObjClass{"+this.className+"},\n     AssObjAttSaada{"+a+"}}");this.listener.controlUpdateQuery(a)}}});console.log("=============== >  FitPatternQEditor_m.js ");
function FitConstraint_Mvc(a){KWConstraint_Mvc.call(this,a);this.operators="String"==this.attributeHandler.type?["=","!=","LIKE","NOT LIKE"]:"boolean"==this.attributeHandler.type?["="]:["=","!=",">","<","BETWEEN"]}
FitConstraint_Mvc.prototype=Object.create(KWConstraint_Mvc.prototype,{getADQL:{value:function(a){return this.fault?null:" "+this.attributeHandler.databaseName+" "+this.operator+" "+this.operand+" "}},processEnterEvent:{value:function(a,b,c){this.andor="AND";if(/^\s*$/.test(c))this.operand="",this.operator="IS NOT NULL",this.notifyTypoMsg(0,"IS NOT NULL");else{if("BETWEEN"!=b||/String|boolean/.test(this.attributeHandler.type)){if(isNaN(c)&&!/String|boolean/.test(this.attributeHandler.type)){this.notifyTypoMsg(1,
'Single numeric operand required with operator "'+b+'"');this.editorModel.updateQuery();return}if("boolean"!=this.attributeHandler.type||/^\s*[Tt][Rr][Uu][Ee]\s*$|^\s*[Ff][Aa][Ll][Ss][Ee]\s*$/.test(c)){if(/String|boolean/.test(this.attributeHandler.type)||void 0==this.attributeHandler.range)this.operator=b,"String"==this.attributeHandler.type&&(c="'"+c+"'"),"boolean"==this.attributeHandler.type&&(/\s*[Tt][Rr][Uu][Ee]\s*/.test(c)?c="T":/\s*[Ff][Aa][Ll][Ss][Ee]\s*/.test(c)&&(c="F"));else{if("="==b&&
(parseFloat(c)<parseFloat(this.attributeHandler.range.values[0])||parseFloat(c)>parseFloat(this.attributeHandler.range.values[this.attributeHandler.range.values.length-1]))||2==this.attributeHandler.range.values.length&&("<"==b&&parseFloat(c)<=parseFloat(this.attributeHandler.range.values[0])||">"==b&&parseFloat(c)>=parseFloat(this.attributeHandler.range.values[1]))||2!=this.attributeHandler.range.values.length&&("<"==b&&parseFloat(c)<=parseFloat(this.attributeHandler.range.values[0])||">"==b&&parseFloat(c)>=
parseFloat(this.attributeHandler.range.values[this.attributeHandler.range.values.length-1])||"="==b&&-1==this.attributeHandler.range.values.indexOf(c))){this.notifyTypoMsg(1,"Respect the range");this.editorModel.updateQuery();return}this.operator=b}this.operand=c}else{this.notifyTypoMsg(1,"Boolean operand required");this.editorModel.updateQuery();return}}else if(this.operator=b,a=c.match(/^((?:[^\s]+)|(?:'.*'))\s+and\s+((?:[^\s]+)|(?:'.*'))$/),null!=a&&!isNaN(a[1])&&!isNaN(a[2])&&a[1]<a[2]){b=a[1];
a=a[2];if(void 0!=this.attributeHandler.range&&(a<parseFloat(this.attributeHandler.range.values[0])||b>parseFloat(this.attributeHandler.range.values[this.attributeHandler.range.values.length-1]))){this.notifyTypoMsg(1,"Respect the range");this.editorModel.updateQuery();return}this.operand=b+" AND "+a}else{this.notifyTypoMsg(1,"The operator "+b+' requires an operand like "num1 and num2" where num1 < num2');this.editorModel.updateQuery();return}this.notifyTypoMsg(0," "+this.operator+" "+this.operand);
0==this.andors.length&&this.processRemoveFirstAndOr()}this.editorModel.updateQuery()}}});console.log("=============== >  FitKWConstraint_m.js ");function FitConstraint_mVc(a){KWConstraint_mVc.call(this,a);new KWConstraint_mvC(new FitConstraint_Mvc(a),this)}
FitConstraint_mVc.prototype=Object.create(KWConstraint_mVc.prototype,{initForm:{value:function(a,b,c,d,e){if(null==a)Modalinfo.error("Attempt to init a FitConstraint with a attribute handler null");else{var f=this;$("#"+this.constListId).append("<div class='kwConstraint' id='"+this.rootId+"' style='float: none;'>");var g="#"+this.constListId+' div[id="'+this.rootId+'"]';c="#"+this.constListId+' input[id="'+this.rootId+'_val"]';var h=$(g);h.append('&nbsp;<a id="'+this.rootId+'_close" href="javascript:void(0);" class=closekw title="Remove this Constraint"></a>&nbsp;');
h.append("<span id="+this.rootId+"_name>"+a.fitparam+"</span><br>");a='<select id="'+this.rootId+'_op" style="font-size: small;font-family: courier;">';for(var l=0;l<b.length;l++){var m=b[l];">"==m?m="&gt;":"<"==m&&(m="&lt;");a+='<option value="'+m+'" >'+m+"</option>"}h.append(a+"</select>");h.append('<input type=text id="'+this.rootId+'_val" class="inputvalue form-control input-sm" style="width:140px; display: inline-block; height: 21px; font-size: small;font-family: courier;" value="'+e+'">');void 0!=
d&&0<d.values.length&&this.loadRange(c,d);var r="#"+this.constListId+' select[id="'+this.rootId+'_op"] option:selected';b=$("#"+this.constListId+' select[id="'+this.rootId+'_op"]');d=$("#"+this.constListId+' a[id="'+this.rootId+'_close"]');var p=$(c);$("#"+this.constListId).append("</div>");d.click(function(){$(g).remove();f.fireRemoveFirstAndOr(this.rootId);f.fireEnterEvent();f.fireTypoMsg(!1,"")});b.change(function(){var a=/=\s+(.+)/.exec(this.value);a&&($("#"+f.constListId+' select[id="'+f.rootId+
'_op"] option[value="="]').prop("selected",!0),p.val(a[1]));f.fireEnterEvent("AND",this.value,p.val())});p.keyup(function(a){"13"==a.which?f.isConstraintOK()?f.fireRunQuery():Modalinfo.error("Current contraint is not valid: can not run the query"):f.fireEnterEvent("AND",$(r).text(),this.value)});p.click(function(a){f.fireEnterEvent("AND",$(r).text(),this.value)});p.on("input",function(a){f.fireEnterEvent("AND",$(r).text(),this.value)});this.fireEnterEvent("AND",$(r).text(),p.val())}}}});console.log("=============== >  FitKWConstraint_v.js ");
function FitAttachedPatterns_mVc(a){AttachedPattern_mVc.call(this,a);this.patterns={};this.relationName=a.relationName;this.className=a.className;for(var b=0;b<a.products.length;b++){var c=this.products[b].label.replace(/ /g,"_");this.patterns[c]={model:a.products[b].model}}}
FitAttachedPatterns_mVc.prototype=Object.create(AttachedPattern_mVc.prototype,{draw:{value:function(){var a=this,b='<fieldset style="display inline-block; width: 100%" >\n  <legend>'+this.title+'</legend>\n    <div id="'+this.productListId+'" style="display: inline; float: left; width: 50% ;height:124px;overflow:auto">\n\t   </div>\n\t   <div style="display: inline; float: left; margin-left: 30px;"class="spanhelp">\n\t\tone click on the check button for acceptable fit,<br> two click on the\n\t\tcheck button for not acceptable fit,<br> three click on the check button\n\t\tfor no specified condition.\n\t   </div>\n</fieldset>\n';
$("#"+this.parentDivId).html(b);this.drawItems();$("#"+this.productListId+" input").click(function(b){b=$(this).val();var d=$(this).attr("id");0==b?($(this).attr("class","withdata").attr("value",1),$(this).next(".ttm").text("Spectral fit for the model"),$("<span id="+d+' class="tttm">is performed, goodness < 50%, acceptable fit</span>').appendTo($("div [id=m"+d+"]"))):1==b?($(this).attr("class","withoutdata").attr("value",2),$(".tttm#"+d).text("is performed, goodness > 50%")):2==b&&($(this).attr("class",
"anydata").attr("value",0),$(this).next(".ttm").text("No condition is specified for the model"),$(".tttm#"+d).remove());a.updateQuery()})}},drawItems:{value:function(){var a=0,b;for(b in this.patterns){a++;var c="<div id=m"+b+' style="width: 100%;display: block; float: left">\n  <input id='+b+' class="anydata" type="button" value="0" />\n  <span id='+b+' class="ttm">No condition is specified for the model</span>\n  <span class="ttm" style="font-weight:bold">'+b+"</span>\n</div><br>\n";$("#"+this.productListId).append(c)}}},
updateQuery:{value:function(a){var b=this,c="   matchPattern{ "+this.relationName+",\n      AssObjClass{"+this.className+"},\n      AssObjAttSaada{ ",d=!1,e="_";$("#"+this.productListId+" input").each(function(){var a=$(this).attr("class"),g=$(this).attr("id");"withdata"==a?(d&&(e="\n        AND _"),c+=e+b.patterns[g].model+"_fit = 0",d=!0):"withoutdata"==a&&(d&&(e="\n        AND _"),c+=e+b.patterns[g].model+"_fit = 1 ",d=!0)});c+="}}";d||(c="");null!=this.queryView?this.queryView.fireAddConstraint(this.formName,
"relation",c):Out.info("Add pattern "+c+" no query view")}},fireClearAllConst:{value:function(){$("#"+this.productListId+" input").attr("class","anydata").attr("value",0);$("#"+this.productListId+" .ttm[id]").text("No condition is specified for the model");$("#"+this.productListId+" .tttm[id]").remove();this.updateQuery()}}});console.log("=============== >  FitAttachedPatterns_v.js ");
function FitBestModelAttachedPattern_mVc(a){AttachedPattern_mVc.call(this,a);this.patterns={};for(var b=0;b<a.products.length;b++){var c=this.products[b].label.replace(/ /g,"_");this.patterns[c]={model:a.products[b].label}}}
FitBestModelAttachedPattern_mVc.prototype=Object.create(AttachedPattern_mVc.prototype,{draw:{value:function(){var a=this,b='<fieldset style="display inline-block; width: 100%" >\n  <legend>'+this.title+'</legend>\n    <div id="'+this.productListId+'" style="display: inline; float: left; width: 50% ;height:124px;overflow:auto">\n\t   </div>\n\t   <div style="display: inline; float: left; margin-left: 30px;"class="spanhelp">\n\t\tone click on the check button for best model,<br> two click on the\n\t\tcheck button for no specified condition.\t   </div>\n</fieldset>\n';$("#"+
this.parentDivId).html(b);this.drawItems();$("#"+this.productListId+" input").click(function(b){var d=$(this).val(),e=$(this).attr("id");0==d?($(this).attr("class","withdata").attr("value",1),$(".ttb#"+e).text("The model"),$("<span id="+e+' class="tttb">is the best fit</span>').appendTo($("div [id=b"+e+"]"))):1==d&&$(this).attr("class","anydata").attr("value",0);a.updateQuery(b)})}},drawItems:{value:function(){var a=0,b;for(b in this.patterns){a++;var c="<div id=b"+b+' style="width: 100%;display: block; float: left">\n  <input id='+
b+' class="anydata" type="button" value="0" />\n  <span id='+b+' class="ttb">No condition is specified for the model</span>\n  <span class="ttb" style="font-weight:bold">'+b+"</span>\n</div><br>\n";$("#"+this.productListId).append(c)}}},updateQuery:{value:function(a){var b=this,c="     BestIs ",d=!1;$("#"+this.productListId+" input").each(function(){var e=$(this).attr("class"),f=$(this).attr("id");a&&a.currentTarget.id==f&&"withdata"==e?(c+=b.patterns[f].model,d=!0):($(this).attr("class","anydata").attr("value",
0),$(".ttb#"+f).text("No condition is specified for the model"),$(".tttb#"+f)&&$(".tttb#"+f).remove())});d||(c="");null!=this.queryView?this.queryView.fireAddConstraint(this.formName,"fitconst",c):Out.info("Add pattern "+c+" no query view")}},fireClearAllConst:{value:function(){$("#"+this.productListId+" input").attr("class","anydata").attr("value",0);this.updateQuery()}}});console.log("=============== >  FitBestModelAttachedPattern_v.js ");
function FitBetterModelAttachedPattern_mVc(a){AttachedPattern_mVc.call(this,a);this.patterns={};for(var b=0;b<a.products.length;b++){var c=this.products[b].label.replace(/ /g,"_");this.patterns[c]={model:a.products[b].model}}this.numbercheked=function(){var a=0;$("#"+this.productListId+" input").each(function(){"anydata"!=$(this).attr("class")&&a++});return a}}
FitBetterModelAttachedPattern_mVc.prototype=Object.create(AttachedPattern_mVc.prototype,{draw:{value:function(){var a=this,b='<fieldset style="display inline-block; width: 100%" >\n  <legend>'+this.title+'</legend>\n    <div id="'+this.productListId+'" style="display: inline; float: left; width: 50% ;height:124px;overflow:auto">\n\t   </div>\n\t   <div style="display: inline; float: left; margin-left: 30px;"class="spanhelp">\n\t\tone click on the check button to compare model,<br> two click on the\n\t\tcheck button for no specified condition.\t   </div>\n</fieldset>\n';
$("#"+this.parentDivId).html(b);this.drawItems();$("#"+this.productListId+" input").click(function(b){var d=$(this).val();$(this).attr("id");0==d?1==a.numbercheked()?$(this).attr("class","withoutdata").attr("value",1):$(this).attr("class","withdata").attr("value",1):1==d&&$(this).attr("class","anydata").attr("value",0);a.updateQuery(b)})}},drawItems:{value:function(){var a=0,b;for(b in this.patterns){a++;var c="<div id=bt"+b+' style="width: 100%;display: block; float: left">\n  <input id='+b+' class="anydata" type="button" value="0" />\n  <span id='+
b+' class="ttbt">No condition is specified for the model</span>\n  <span class="ttbt" style="font-weight:bold">'+b+"</span>\n</div><br>\n";$("#"+this.productListId).append(c)}}},updateQuery:{value:function(a){var b=this,c="",d=!1,e="",f="";1==b.numbercheked()?$("#"+this.productListId+" input").each(function(){var a=$(this).attr("class"),b=$(this).attr("id");"anydata"==a?($(".ttbt#"+b).text("No condition is specified for the model"),$(".tttbt#"+b)&&$(".tttbt#"+b).remove()):("withoutdata"==a&&$(this).attr("class",
"withdata"),$(".ttbt#"+$(this).attr("id")).text("The model"),$(".tttbt#"+b)&&$(".tttbt#"+b).remove(),$("<span id="+b+' class="tttbt">is fitted <strong> better </strong> than ...</span>').appendTo($("div [id=bt"+b+"]")))}):2==b.numbercheked()?($("#"+this.productListId+" input").each(function(){var a=$(this).attr("class"),c=$(this).attr("id");"withdata"==a?e=b.patterns[c].model.toUpperCase():"withoutdata"==a&&(f=b.patterns[c].model.toUpperCase())}),$("#"+this.productListId+" input").each(function(){var a=
$(this).attr("class"),b=$(this).attr("id");"withoutdata"==a?($(".ttbt#"+$(this).attr("id")).text("The model"),$("<span id="+b+' class="tttbt">is fitted <strong> worse </strong> than <strong>'+e+"</strong></span>").appendTo($("div [id=bt"+b+"]"))):"withdata"==a&&($(".tttbt#"+b).remove(),$("<span id="+b+' class="tttbt">is fitted <strong> better </strong> than  <strong>'+f+"</strong></span>").appendTo($("div [id=bt"+b+"]")))}),d=!0,c=e+" BetterThan "+f):$("#"+this.productListId+" input").each(function(){var b=
$(this).attr("class"),c=$(this).attr("id");a&&a.currentTarget.id==c&&"withdata"==b?($(".ttbt#"+$(this).attr("id")).text("The model"),$("<span id="+c+' class="tttbt">is fitted <strong> better </strong> than ...</span>').appendTo($("div [id=bt"+c+"]"))):($(this).attr("class","anydata").attr("value",0),$(".ttbt#"+c).text("No condition is specified for the model"),$(".tttbt#"+c)&&$(".tttbt#"+c).remove())});d||(c="");null!=this.queryView?this.queryView.fireAddConstraint(this.formName,"fitconst",c):Out.info("Add pattern "+
c+" no query view")}},fireClearAllConst:{value:function(){$("#"+this.productListId+" input").attr("class","anydata").attr("value",0);this.updateQuery()}}});console.log("=============== >  FitBetterModelAttachedPattern_v.js ");function FitOrderModelAttachedPattern_mVc(a){AttachedPattern_mVc.call(this,a);this.patterns={};for(var b=0;b<a.products.length;b++){var c=this.products[b].label.replace(/ /g,"_");this.patterns[c]={model:a.products[b].label}}}
FitOrderModelAttachedPattern_mVc.prototype=Object.create(AttachedPattern_mVc.prototype,{draw:{value:function(){var a=this,b='<fieldset style="display inline-block; width: 100%" >\n  <legend>'+this.title+'</legend>\n    <div id="'+this.productListId+'" style="display: inline; float: left; width: 50% ;height:124px;overflow:auto">\n\t   </div>\n\t   <div style="display: inline; float: left; margin-left: 30px;"class="spanhelp">\n\t\tone click on the check button for ascending order,<br> two click on the\n\t\tcheck button for descending order,<br> three click on the check button\n\t\tfor no specified condition.\n\t   </div>\n</fieldset>\n';
$("#"+this.parentDivId).html(b);this.drawItems();$("#"+this.productListId+" input").click(function(b){b=$(this).val();var d=$(this).attr("id");0==b?($(this).attr("class","withdata").attr("value",1),$(this).next(".tto").text(""),$("<span id="+d+' class="ttto">in ascending order</span>').appendTo($("div [id=o"+d+"]"))):1==b?($(this).attr("class","withoutdata").attr("value",2),$(".ttto#"+d).text("in descending order")):2==b&&($(this).attr("class","anydata").attr("value",0),$(this).next(".tto").text("No condition is specified for the model"),
$(".ttto#"+d).remove());a.updateQuery()})}},drawItems:{value:function(){var a=0,b;for(b in this.patterns){a++;var c="<div id=o"+b+' style="width: 100%;display: block; float: left">\n  <input id='+b+' class="anydata" type="button" value="0" />\n  <span id='+b+' class="tto">No condition is specified for the model</span>\n  <span class="tto" style="font-weight:bold">'+b+"</span>\n</div><br>\n";$("#"+this.productListId).append(c)}}},updateQuery:{value:function(a){var b=this,c=" OrderByGoodn",d=!1,e=" ";
$("#"+this.productListId+" input").each(function(){var a=$(this).attr("class"),g=$(this).attr("id");"withdata"==a?(d&&(e=",\n                           "),c+=e+b.patterns[g].model+" ASC",d=!0):"withoutdata"==a&&(d&&(e=",\n                           "),c+=e+b.patterns[g].model+" DESC",d=!0)});d||(c="");null!=this.queryView?this.queryView.fireAddConstraint(this.formName,"fitconst",c):Out.info("Add pattern "+c+" no query view")}},fireClearAllConst:{value:function(){$("#"+this.productListId+" input").attr("class",
"anydata").attr("value",0);$("#"+this.productListId+" .tto[id]").text("No condition is specified for the model");$("#"+this.productListId+" .ttto[id]").remove();this.updateQuery()}}});console.log("=============== >  FitOrderModelAttachedPattern_v.js ");
